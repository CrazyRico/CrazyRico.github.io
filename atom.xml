<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>疯狂的企鹅</title>
  
  <subtitle>Crazy.Rico&#39;s Blog</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://crazyrico.com/"/>
  <updated>2020-05-06T09:07:50.060Z</updated>
  <id>https://crazyrico.com/</id>
  
  <author>
    <name>Crazy Rico</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Python学习笔记二Hello Python</title>
    <link href="https://crazyrico.com/posts/2020/04/25/bd822cee.html"/>
    <id>https://crazyrico.com/posts/2020/04/25/bd822cee.html</id>
    <published>2020-04-25T10:20:21.000Z</published>
    <updated>2020-05-06T09:07:50.060Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Python的开发工具"><a href="#Python的开发工具" class="headerlink" title="Python的开发工具"></a>Python的开发工具</h2><p>之前我们已经安装好了Python，在正式编写Python代码之前，我们需要挑选一款好用的Python开发工具，这里介绍几款常用的工具</p><p><img src="http://static.nsoft.vip/20200506103534.png" alt=""></p><a id="more"></a><h3 id="Python-shell-、-Python-IDLE"><a href="#Python-shell-、-Python-IDLE" class="headerlink" title="Python shell 、 Python IDLE"></a>Python shell 、 Python IDLE</h3><p>这两个工具是我们安装完Python自带的工具</p><p><img src="http://static.nsoft.vip/20200506111543.png" alt=""></p><p>点击打开，可以在弹出窗口中直接书写Python代码，这里我们打印一行 hello python：</p><p><img src="http://static.nsoft.vip/20200506111827.png" alt=""></p><h3 id="Sublime-Text"><a href="#Sublime-Text" class="headerlink" title="Sublime Text"></a>Sublime Text</h3><p><a href="http://www.sublimetext.com/3" target="_blank" rel="noopener">Sublime Text</a> 是一个文本编辑器（收费软件，可以无限期试用，但是会有激活提示弹窗），同时也是一个先进的代码编辑器。Sublime Text是由程序员Jon Skinner于2008年1月份所开发出来，它最初被设计为一个具有丰富扩展功能的Vim。</p><p>打开Sublime Text，新建一个hello.py文件，输入print(‘hello python’)保存，通过快捷键ctrl + B 可以直接运行也是十分的方便<br><img src="http://static.nsoft.vip/20200506112550.png" alt=""></p><h3 id="Pycharm"><a href="#Pycharm" class="headerlink" title="Pycharm"></a>Pycharm</h3><p><a href="https://www.jetbrains.com/pycharm/download/" target="_blank" rel="noopener">PyCharm</a> 是由<a href="https://www.jetbrains.com/" target="_blank" rel="noopener">JetBrains</a>打造的一款Python IDE，带有一整套可以帮助用户在使用Python语言开发时提高其效率的工具，比如调试、语法高亮、Project管理、代码跳转、智能提示、自动完成、单元测试、版本控制。此外，该IDE提供了一些高级功能，以用于支持Django框架下的专业Web开发。在开发Python大型应用时推荐使用此工具，PyCharm 有Professional和Community版</p><p><img src="http://static.nsoft.vip/20200506113807.png" alt=""><br>同样的，在PyCharm新建hello.py 文件输入打印代码，点击文件上的小三角或者右键Run即可执行</p><p><img src="http://static.nsoft.vip/20200506114208.png" alt=""></p><h3 id="Eclipse-Pydev插件"><a href="#Eclipse-Pydev插件" class="headerlink" title="Eclipse Pydev插件"></a>Eclipse Pydev插件</h3><h4 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a>安装插件</h4><p>运行Eclipse之后，选择help–&gt;Install new Software，点击Add，添加pydev的安装地址：<a href="http://pydev.org/updates/" target="_blank" rel="noopener">http://pydev.org/updates/</a><br><img src="http://static.nsoft.vip/20200506134615.jpg" alt=""> 安装完成重启Eclipse</p><h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p>重启Eclipse 在 Window –&gt; Preferences –&gt; PyDev –&gt; Interpreters –&gt; Python Interpreter 添加python.exe<br><img src="http://static.nsoft.vip/20200506143937.png" alt=""></p><h4 id="新建PyDev-Project"><a href="#新建PyDev-Project" class="headerlink" title="新建PyDev Project"></a>新建PyDev Project</h4><p>在File –&gt; New –&gt; Project –&gt; PyDev –&gt; PyDev Project<br><img src="http://static.nsoft.vip/20200506144409.png" alt=""><br>新建 hello python 项目<br><img src="http://static.nsoft.vip/20200506144530.png" alt=""><br>右键hello python 工程，添加python module<br><img src="http://static.nsoft.vip/20200506144656.png" alt=""><br>编写我们的hello python代码运行<br><img src="http://static.nsoft.vip/20200506145227.png" alt=""></p><h3 id="Visual-Studio-Code"><a href="#Visual-Studio-Code" class="headerlink" title="Visual Studio Code"></a>Visual Studio Code</h3><p>VScode是一个相当优秀的IDE，具备开源、跨平台、模块化、插件丰富、启动时间快、颜值高、可高度定制等等优秀的特质，不愧是微软爸爸的私生子。<br>所以用VScode来编写Python，也是相当的好用的。</p><h4 id="安装第三方的包"><a href="#安装第三方的包" class="headerlink" title="安装第三方的包"></a>安装第三方的包</h4><p>通过python自带的pip工具，安装两个一会儿配置VScode需要的包</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install flake8</span><br><span class="line">pip3 install yapf</span><br></pre></td></tr></tbody></table></figure><h4 id="配置VScode"><a href="#配置VScode" class="headerlink" title="配置VScode"></a>配置VScode</h4><p>打开VScode 左侧菜单Extensions 或按下快捷键Ctrl+Shift+X，进入插件管理页面，输入python，找到python插件安装<br><img src="http://static.nsoft.vip/20200506140402.png" alt=""></p><p>新建工作区hello python，在settings.json中添加如下配置</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    <span class="string">"python.linting.flake8Enabled"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"python.formatting.provider"</span>: <span class="string">"yapf"</span>,</span><br><span class="line">    <span class="string">"python.linting.flake8Args"</span>: [<span class="string">"--max-line-length=248"</span>],</span><br><span class="line">    <span class="string">"python.linting.pylintEnabled"</span>: <span class="literal">false</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><img src="http://static.nsoft.vip/20200506143051.png" alt=""></p><h4 id="运行python代码"><a href="#运行python代码" class="headerlink" title="运行python代码"></a>运行python代码</h4><p>点击右上角运行小图标即可运行python程序<br><img src="http://static.nsoft.vip/20200506143128.png" alt=""></p><h3 id="Ipython、-Spyder、-Jupyter-Notebook"><a href="#Ipython、-Spyder、-Jupyter-Notebook" class="headerlink" title="Ipython、 Spyder、 Jupyter Notebook"></a>Ipython、 Spyder、 Jupyter Notebook</h3><p>Ipython、 Spyder、 Jupyter Notebook 这三款工具是我们安装完<a href="https://www.anaconda.com/" target="_blank" rel="noopener">Anaconda</a>自带的</p><h4 id="Ipython"><a href="#Ipython" class="headerlink" title="Ipython"></a>Ipython</h4><p>点击开始菜单选择Anaconda –&gt; Anaconda Powershell<br><img src="http://static.nsoft.vip/20200506162243.png" alt=""></p><p>在弹出窗口中输入ipython 回车<br><img src="http://static.nsoft.vip/20200506162521.png" alt=""></p><p>接着我们打印下hello python ,运行ok<br><img src="http://static.nsoft.vip/20200506162611.png" alt=""></p><h4 id="Jupyter-Notebook"><a href="#Jupyter-Notebook" class="headerlink" title="Jupyter Notebook"></a>Jupyter Notebook</h4><p>Jupyter Notebook是基于网页的用于交互计算的应用程序。其可被应用于全过程计算：开发、文档编写、运行代码和展示结果。——Jupyter Notebook官方介绍<br>点击开始菜单选择Anaconda –&gt; Jupyter Notebook<br><img src="http://static.nsoft.vip/20200506162930.png" alt=""></p><p>或者在Anaconda Navigator中启动 Jupyter Notebook<br><img src="http://static.nsoft.vip/20200506163040.png" alt=""></p><p>点击运行后，会打开浏览器，点击多次打开多个会浏览器，分别以不同的端口访问jupyter,在右侧点击New –&gt; Python3<br><img src="http://static.nsoft.vip/20200506163329.png" alt=""></p><p>在弹出的页面输入打印代码点击运行，也一样可以运行<br><img src="http://static.nsoft.vip/20200506163540.png" alt=""></p><h4 id="Spyder"><a href="#Spyder" class="headerlink" title="Spyder"></a>Spyder</h4><p>同样的点击开始菜单选择Anaconda –&gt; Spyder<br>Spyder 提供了分段运行的注释功能，对于我们初学的，尤为方便</p><p>比如我们只想打印一行hello world  通过 # %% 将光标放在当前代码块内，点击上方的运行当前，确实很方便<br><img src="http://static.nsoft.vip/20200506164712.png" alt=""></p><p>另外，代码可视化，比如我们创建一个数组a, 运行之后在右侧类型，我们可以查看数组元素类型，双击打开，更可以已图形化的形式展示<br><img src="http://static.nsoft.vip/20200506165410.png" alt=""></p><p>好了以上就是我们编写python代码常用的一些工具，以及在这些工具中编写我们的第一个hello python程序，推荐使用Spyder，对于初学者更友好。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://blog.csdn.net/qq_23090489/article/details/91378551" target="_blank" rel="noopener">https://blog.csdn.net/qq_23090489/article/details/91378551</a><br><a href="https://www.cnblogs.com/xiaojwang/p/11331202.html" target="_blank" rel="noopener">https://www.cnblogs.com/xiaojwang/p/11331202.html</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Python的开发工具&quot;&gt;&lt;a href=&quot;#Python的开发工具&quot; class=&quot;headerlink&quot; title=&quot;Python的开发工具&quot;&gt;&lt;/a&gt;Python的开发工具&lt;/h2&gt;&lt;p&gt;之前我们已经安装好了Python，在正式编写Python代码之前，我们需要挑选一款好用的Python开发工具，这里介绍几款常用的工具&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://static.nsoft.vip/20200506103534.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Python" scheme="https://crazyrico.com/categories/Python/"/>
    
    
      <category term="centos7" scheme="https://crazyrico.com/tags/centos7/"/>
    
      <category term="Python" scheme="https://crazyrico.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Centos7编译安装gcc8.3.0</title>
    <link href="https://crazyrico.com/posts/2020/04/23/7c0492b6.html"/>
    <id>https://crazyrico.com/posts/2020/04/23/7c0492b6.html</id>
    <published>2020-04-23T10:20:21.000Z</published>
    <updated>2020-05-06T02:11:44.113Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><a href="https://gcc.gnu.org/" target="_blank" rel="noopener">GCC</a>（GNU Compiler Collection，GNU编译器套件）是由GNU开发的编程语言译器。GNU编译器套件包括C、C++、 Objective-C、 Fortran、Java、Ada和Go语言前端，也包括了这些语言的库（如libstdc++，libgcj等。）</p><p><img src="http://static.nsoft.vip/20200429164538.jpg" alt=""></p><a id="more"></a><p>之前我们在Centos7中编译安装<a href="/posts/2020/04/13/a4afec94.html">Python</a>时， 添加[–enable-optimizations] 参数，由于GCC版本较低会报错安装失败</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">gcc -pthread     -Xlinker -<span class="built_in">export</span>-dynamic -o python Programs/python.o libpython3.8.a -lcrypt -lpthread -ldl  -lutil -lm   -lm </span><br><span class="line">./python -E -S -m sysconfig --generate-posix-vars ;\</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> $? -ne 0 ; <span class="keyword">then</span> \</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"generate-posix-vars failed"</span> ; \</span><br><span class="line">rm -f ./pybuilddir.txt ; \</span><br><span class="line"><span class="built_in">exit</span> 1 ; \</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">Could not import runpy module</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"/opt/Python-3.8.2/Lib/runpy.py"</span>, line 15, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    import importlib.util</span><br><span class="line">  File <span class="string">"/opt/Python-3.8.2/Lib/importlib/util.py"</span>, line 14, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    from contextlib import contextmanager</span><br><span class="line">  File <span class="string">"/opt/Python-3.8.2/Lib/contextlib.py"</span>, line 4, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    import _collections_abc</span><br><span class="line">SystemError: &lt;built-in <span class="keyword">function</span> compile&gt; returned NULL without setting an error</span><br><span class="line">generate-posix-vars failed</span><br><span class="line">make[1]: *** [pybuilddir.txt] Error 1</span><br><span class="line">make[1]: Leaving directory `/opt/Python-3.8.2<span class="string">'</span></span><br><span class="line"><span class="string">make: *** [profile-opt] Error 2</span></span><br></pre></td></tr></tbody></table></figure><p>查看本机gcc版本</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gcc --version</span></span><br><span class="line">gcc (GCC) 4.9.2 20150212 (Red Hat 4.9.2-6)</span><br><span class="line">Copyright (C) 2014 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copying conditions.  There is NO</span><br><span class="line">warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></tbody></table></figure><p>在gcc版本较低的情况下可以通过两种方式安装成功Python</p><ol><li>disable –enable-optimizations option. the software can be compile and install successful.</li><li>upgrade gcc version to 8.2.0. </li></ol><h2 id="安装gcc8-3"><a href="#安装gcc8-3" class="headerlink" title="安装gcc8.3"></a>安装gcc8.3</h2><p>这里我们通过升级gcc来解决上面的报错问题</p><h3 id="下载gcc源码包"><a href="#下载gcc源码包" class="headerlink" title="下载gcc源码包"></a>下载gcc源码包</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /usr/local/src</span></span><br><span class="line"><span class="comment"># wget http://ftp.tsukuba.wide.ad.jp/software/gcc/releases/gcc-8.3.0/gcc-8.3.0.tar.xz</span></span><br></pre></td></tr></tbody></table></figure><h3 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar -xvJf gcc-8.3.0.tar.xz</span></span><br></pre></td></tr></tbody></table></figure><h3 id="下载依赖包"><a href="#下载依赖包" class="headerlink" title="下载依赖包"></a>下载依赖包</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd gcc-8.3.0/</span></span><br><span class="line"><span class="comment"># ./contrib/download_prerequisites</span></span><br></pre></td></tr></tbody></table></figure><p>执行命令后它会自动下载mpfr、gmp、mpc isl这4个库</p><h3 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir build</span></span><br><span class="line"><span class="comment"># cd build</span></span><br><span class="line"><span class="comment"># ../configure --prefix=/usr/local/gcc --enable-languages=c,c++ --disable-multilib</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></tbody></table></figure><p>编译安装时间确实很长，可以去看部电影再回来O(∩_∩)O哈哈~</p><h3 id="修改软链接"><a href="#修改软链接" class="headerlink" title="修改软链接"></a>修改软链接</h3><p>备份下之前的版本，创建指向gcc8.3的软链接</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mv /usr/bin/gcc /usr/bin/gcc_old</span></span><br><span class="line"><span class="comment"># mv /usr/bin/g++ /usr/bin/g++_old</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ln -s /usr/local/gcc/bin/gcc /usr/bin/gcc</span></span><br><span class="line"><span class="comment"># ln -s /usr/local/gcc/bin/g++ /usr/bin/g++</span></span><br></pre></td></tr></tbody></table></figure><h3 id="查看gcc版本"><a href="#查看gcc版本" class="headerlink" title="查看gcc版本"></a>查看gcc版本</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gcc -v</span></span><br><span class="line">Using built-in specs.</span><br><span class="line">COLLECT_GCC=gcc</span><br><span class="line">COLLECT_LTO_WRAPPER=/usr/<span class="built_in">local</span>/gcc/libexec/gcc/x86_64-pc-linux-gnu/8.3.0/lto-wrapper</span><br><span class="line">Target: x86_64-pc-linux-gnu</span><br><span class="line">Configured with: ../configure --prefix=/usr/<span class="built_in">local</span>/gcc --<span class="built_in">enable</span>-languages=c,c++ --<span class="built_in">disable</span>-multilib</span><br><span class="line">Thread model: posix</span><br><span class="line">gcc version 8.3.0 (GCC)</span><br></pre></td></tr></tbody></table></figure><p>这时我们的gcc版本已经显示为8.3了，再次回到Python安装，就可以愉快的玩耍了</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd Python-3.8.2/</span></span><br><span class="line"><span class="comment"># ./configure --prefix=/usr/local/python3 --enable-optimizations --with-ssl</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></tbody></table></figure><p>使用参数 –enable-optimizations  安装Python会慢一些，确实通过升级gcc版本可以解决上面的Python安装失败的问题。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python3</span></span><br><span class="line">Python 3.8.2 (default, Apr 23 2020, 08:38:06) </span><br><span class="line">[GCC 8.3.0] on linux</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> or <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></tbody></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://bugs.python.org/issue35074" target="_blank" rel="noopener">https://bugs.python.org/issue35074</a><br><a href="https://www.jianshu.com/p/444169a3721a" target="_blank" rel="noopener">https://www.jianshu.com/p/444169a3721a</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://gcc.gnu.org/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;GCC&lt;/a&gt;（GNU Compiler Collection，GNU编译器套件）是由GNU开发的编程语言译器。GNU编译器套件包括C、C++、 Objective-C、 Fortran、Java、Ada和Go语言前端，也包括了这些语言的库（如libstdc++，libgcj等。）&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://static.nsoft.vip/20200429164538.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Python" scheme="https://crazyrico.com/categories/Python/"/>
    
    
      <category term="centos7" scheme="https://crazyrico.com/tags/centos7/"/>
    
      <category term="Python" scheme="https://crazyrico.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Anaconda简介</title>
    <link href="https://crazyrico.com/posts/2020/04/23/b44b6c7a.html"/>
    <id>https://crazyrico.com/posts/2020/04/23/b44b6c7a.html</id>
    <published>2020-04-23T10:20:21.000Z</published>
    <updated>2020-05-06T09:12:50.196Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><a href="https://www.anaconda.com/" target="_blank" rel="noopener">Anaconda</a>指的是一个开源的Python发行版本，其包含了conda、Python等180多个科学包及其依赖项,比如：numpy、pandas等。</p><p><img src="http://static.nsoft.vip/20200506150342.png" alt=""></p><a id="more"></a><p>Anaconda在英文中是“蟒蛇”，麻辣鸡（Nicki Minaj妮琪·米娜）有首歌就叫《Anaconda》，表示像蟒蛇一样性感妖娆的身体。<br><img src="http://static.nsoft.vip/20200506152320.png" alt=""></p><p>所有你看下面Anaconda的图标就像一个首尾互相咬住的“蟒蛇”。<br><img src="http://static.nsoft.vip/20200506152447.png" alt=""></p><p>你可能已经安装了 Python，那么为什么还需要 Anaconda？有以下3个原因：<br>1、Anaconda 附带了一大批常用数据科学包，它附带了 conda、Python 和 180 多个科学包及其依赖项。因此你可以立即开始处理数据。<br>2、管理包Anaconda 是在 conda（一个包管理器和环境管理器）上发展出来的。在数据分析中，你会用到很多第三方的包，而conda（包管理器）可以很好的帮助你在计算机上安装和管理这些包，包括安装、卸载和更新包。<br>3、管理环境为什么需要管理环境呢？比如你在A项目中用了 Python 2，而新的项目B老大要求使用Python 3，而同时安装两个Python版本可能会造成许多混乱和错误。这时候 conda就可以帮助你为不同的项目建立不同的运行环境。还有很多项目使用的包版本不同，比如不同的pandas版本，不可能同时安装两个 Numpy 版本，你要做的应该是，为每个 Numpy 版本创建一个环境，然后项目的对应环境中工作。这时候conda就可以帮你做到。</p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>进入Anaconda下载页面<a href="https://www.anaconda.com/products/individual" target="_blank" rel="noopener">https://www.anaconda.com/products/individual</a>根据我们自己的系统选择对应的安装包</p><p><img src="http://static.nsoft.vip/20200506150824.png" alt=""></p><p>Anaconda官网在国外，访问可能会比较慢，这里我们也可以通过<a href="https://mirrors.tuna.tsinghua.edu.cn/" target="_blank" rel="noopener">清华大学开源软件镜像站</a> 下载anaconda<br><img src="http://static.nsoft.vip/20200506155713.png" alt=""></p><p>下载完成后双击运行Anaconda3-2020.02-Windows-x86_64.exe Next.<br><img src="http://static.nsoft.vip/20200506150955.png" alt=""></p><p>Agree安装条款<br><img src="http://static.nsoft.vip/20200506151034.png" alt=""></p><p>选择安装目录<br><img src="http://static.nsoft.vip/20200506151130.png" alt=""></p><p>根据自己的系统环境勾选，如果已经安装了Python 官方解析器，并且不希望将Anaconda python 作为默认解析器则无需勾选<br><img src="http://static.nsoft.vip/20200506154219.png" alt=""></p><p>安装<br><img src="http://static.nsoft.vip/20200506154313.png" alt=""></p><p>安装完成我们的开始菜单中就可以找到Anaconda了<br><img src="http://static.nsoft.vip/20200506160003.png" alt=""></p><p>打开Anaconda 导航<br><img src="http://static.nsoft.vip/20200506160802.png" alt=""></p><p>好了，这样我们的Anaconda已经安装好了。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://www.anaconda.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Anaconda&lt;/a&gt;指的是一个开源的Python发行版本，其包含了conda、Python等180多个科学包及其依赖项,比如：numpy、pandas等。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://static.nsoft.vip/20200506150342.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Python" scheme="https://crazyrico.com/categories/Python/"/>
    
    
      <category term="centos7" scheme="https://crazyrico.com/tags/centos7/"/>
    
      <category term="Python" scheme="https://crazyrico.com/tags/Python/"/>
    
      <category term="Anaconda" scheme="https://crazyrico.com/tags/Anaconda/"/>
    
  </entry>
  
  <entry>
    <title>Python学习笔记之简介</title>
    <link href="https://crazyrico.com/posts/2020/04/22/a4afec94.html"/>
    <id>https://crazyrico.com/posts/2020/04/22/a4afec94.html</id>
    <published>2020-04-22T10:20:21.000Z</published>
    <updated>2020-04-29T08:17:33.174Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>「人生苦短，我学 Python」，今天开始Python的学习之旅，Python 是一种解释型、面向对象、动态数据类型的高级程序设计语言。首先我们先了解下Python这门语言的作者，<br>Python的作者，Guido von Rossum，荷兰人。1982年，Guido从阿姆斯特丹大学(University of Amsterdam)获得了数学和计算机硕士学位。然而，尽管他算得上是一位数学家，但他更加享受计算机带来的乐趣。用他的话说，尽管拥有数学和计算机双料资质，他总趋向于做计算机相关的工作，并热衷于做任何和编程相关的活儿<br><img src="http://static.nsoft.vip/20200428101543.jpeg" alt=""></p><a id="more"></a><p>Python程序员可以花更多的时间用于思考程序的逻辑，而不是具体的实现细节 (Guido有一件T恤，写着：人生苦短，我用Python)。这一特征吸引了广大的程序员。Python开始流行。</p><h2 id="Python的历史"><a href="#Python的历史" class="headerlink" title="Python的历史"></a>Python的历史</h2><ol><li>1989年圣诞节：为了打发圣诞节假期，Guido开始写Python语言的编译/解释器。</li><li>1991年2月：第一个Python解释器诞生，它是用C语言实现的，可以调用C语言的库函数(.so文件)。从一出生，Python已经具有了：类(class)，函数(function)，异常处理(exception)，包括表(list)和词典(dictionary)在内的核心数据类型，以及模块(module)为基础的拓展系统。<br><img src="http://static.nsoft.vip/20200428104428.png" alt=""><br>最初的Python logo: 由Guido的兄弟Just von Rossum设计</li><li>1994年1月：Python 1.0正式发布。</li><li>2000年10月：Python 2.0发布，Python的整个开发过程更加透明，生态圈开始慢慢形成。</li><li>2008年12月：Python 3.0发布，引入了诸多现代编程语言的新特性，但并不完全兼容之前的Python代码。</li></ol><h2 id="Python的优点"><a href="#Python的优点" class="headerlink" title="Python的优点"></a>Python的优点</h2><p>Python的优点很多，简单列出几点。</p><ol><li>简单明确，跟其他很多语言相比，Python更容易上手。</li><li>开放源代码，拥有强大的社区和生态圈。</li><li>能够在Windows、macOS、Linux等各种系统上运行。</li></ol><h2 id="Python应用领域"><a href="#Python应用领域" class="headerlink" title="Python应用领域"></a>Python应用领域</h2><p>目前Python在<strong>Web服务器应用开发</strong>、云基础设施开发、<strong>网络数据采集</strong>（爬虫）、<strong>数据分析</strong>、量化交易、<strong>机器学习</strong>、<strong>自动化测试</strong>、<strong>自动化运维</strong>等领域都有用武之地。</p><h2 id="Python环境安装"><a href="#Python环境安装" class="headerlink" title="Python环境安装"></a>Python环境安装</h2><h3 id="Windows环境"><a href="#Windows环境" class="headerlink" title="Windows环境"></a>Windows环境</h3><p>可以在<a href="https://www.python.org/downloads/windows/" target="_blank" rel="noopener">Python官方网站</a>找到<a href="https://www.python.org/ftp/python/3.8.2/python-3.8.2.exe" target="_blank" rel="noopener">下载链接</a>并下载Python 3.8的安装程序。<br><img src="http://static.nsoft.vip/20200428110355.png" alt=""></p><p>下载完成后，双击运行刚才下载的安装程序，会打开Python环境的安装向导。在执行安装向导的时候，记得勾选“Add Python 3.x to PATH”选项，这个选项会帮助我们将Python的解释器添加到PATH环境变量中（不理解没关系，照做就行）。<br><img src="http://static.nsoft.vip/20200428111120.png" alt=""></p><p>如果在安装时忘记勾选了，怎么办，也没关系，我们可以手动将Python添加进系统Path环境变量中<br><img src="http://static.nsoft.vip/20200428111434.png" alt=""></p><p>找到Path选项，如果没有新建一个<br><img src="http://static.nsoft.vip/20200428111509.png" alt=""><br>将Python的安装目录添加进Path<br><img src="http://static.nsoft.vip/20200428111653.png" alt=""></p><p>安装完成后可以打开Windows的“命令行提示符”工具并输入下面的命令来检查Python解释器是否安装成功。</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python --version</span><br></pre></td></tr></tbody></table></figure><p>执行上面的命令如果看了Python解释器对应的版本号（如：Python 3.8.2），说明你的安装已经成功了。</p><h3 id="macOS环境"><a href="#macOS环境" class="headerlink" title="macOS环境"></a>macOS环境</h3><p>macOS自带了Python 2，但是我们需要安装和使用的是Python 3。可以通过Python官方网站提供的<a href="https://www.python.org/downloads/release/python-382/" target="_blank" rel="noopener">下载链接</a>找到适合macOS的“macOS installer”来安装Python 3<br><img src="http://static.nsoft.vip/20200428112241.png" alt=""></p><p>安装过程基本不需要做任何勾选，直接点击“下一步”即可。安装完成后，可以在macOS的“终端”工具中输入<code>python3</code>命令来调用Python 3解释器，如果直接输入<code>python</code>，将会调用Python 2的解释器。</p><h3 id="Centos7环境"><a href="#Centos7环境" class="headerlink" title="Centos7环境"></a>Centos7环境</h3><p>在Linux环境下安装Python，需要通过源码编译安装，同样的通过Python官方网站提供的<a href="https://www.python.org/downloads/release/python-382/" target="_blank" rel="noopener">下载链接</a>找到Source release，复制下载链接<br><img src="http://static.nsoft.vip/20200428140307.png" alt=""></p><p>1、使用root账号进入Centos7系统，或者通过ssh进入系统，下载Python源码包</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># wget https://www.python.org/ftp/python/3.8.2/Python-3.8.2.tar.xz</span></span><br></pre></td></tr></tbody></table></figure><p>2、解压</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tar -xvJf  Python-3.8.2.tar.xz</span></span><br></pre></td></tr></tbody></table></figure><p>3、安装编译工具</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install -y zlib-devel \</span></span><br><span class="line">    bzip2-devel \</span><br><span class="line">    openssl-devel \</span><br><span class="line">    ncurses-devel \</span><br><span class="line">    sqlite-devel \</span><br><span class="line">    readline-devel \</span><br><span class="line">    tk-devel \</span><br><span class="line">    gdbm-devel \</span><br><span class="line">    db4-devel \</span><br><span class="line">    libpcap-devel \</span><br><span class="line">    xz-devel \</span><br><span class="line">    libffi-devel \</span><br><span class="line">    zlib1g-dev</span><br></pre></td></tr></tbody></table></figure><p>4、创建编译安装目录</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir /usr/local/python3</span></span><br></pre></td></tr></tbody></table></figure><p>5、安装</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd Python-3.8.2/</span></span><br><span class="line"><span class="comment"># ./configure --prefix=/usr/local/python3 --enable-optimizations --with-ssl</span></span><br><span class="line">--prefix  指定安装的路径</span><br><span class="line">--<span class="built_in">enable</span>-optimizations 提高python代码运行速度（GCC版本较低时，添加此参数安装会报错）</span><br><span class="line">--with-ssl 安装pip需要用到ssl</span><br><span class="line"></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></tbody></table></figure><p>6、建立软连接</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ln -s /usr/local/python3/bin/python3.8 /usr/bin/python3</span></span><br><span class="line"><span class="comment"># ln -s /usr/local/python3/bin/pip3.8 /usr/bin/pip3</span></span><br></pre></td></tr></tbody></table></figure><p>7、验证</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python3 </span></span><br><span class="line"><span class="comment"># pip3</span></span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;「人生苦短，我学 Python」，今天开始Python的学习之旅，Python 是一种解释型、面向对象、动态数据类型的高级程序设计语言。首先我们先了解下Python这门语言的作者，&lt;br&gt;Python的作者，Guido von Rossum，荷兰人。1982年，Guido从阿姆斯特丹大学(University of Amsterdam)获得了数学和计算机硕士学位。然而，尽管他算得上是一位数学家，但他更加享受计算机带来的乐趣。用他的话说，尽管拥有数学和计算机双料资质，他总趋向于做计算机相关的工作，并热衷于做任何和编程相关的活儿&lt;br&gt;&lt;img src=&quot;http://static.nsoft.vip/20200428101543.jpeg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Python" scheme="https://crazyrico.com/categories/Python/"/>
    
    
      <category term="Python" scheme="https://crazyrico.com/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>Mysql优化之慢查询</title>
    <link href="https://crazyrico.com/posts/2020/04/13/c82e733f.html"/>
    <id>https://crazyrico.com/posts/2020/04/13/c82e733f.html</id>
    <published>2020-04-13T10:20:21.000Z</published>
    <updated>2020-04-13T07:37:45.323Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://static.nsoft.vip/20200413135049.jpg" alt=""></p><a id="more"></a><h2 id="什么是慢查询"><a href="#什么是慢查询" class="headerlink" title="什么是慢查询"></a>什么是慢查询</h2><p>慢查询日志，顾名思义，就是查询慢的日志，是指mysql记录所有执行超过 long_query_time参数设定的时间阈值的SQL语句的日志。该日志能为SQL语句的优化带来很好的帮助。默认情况下，慢查询日志是关闭的，要使用慢查询日志功能，首先要开启慢查询日志功能。</p><h2 id="慢查询配置"><a href="#慢查询配置" class="headerlink" title="慢查询配置"></a>慢查询配置</h2><h3 id="配置文件修改"><a href="#配置文件修改" class="headerlink" title="配置文件修改"></a>配置文件修改</h3><p>通过修改Mysql配置文件开启慢查询日志，这里以Window 为例，找到Mysql的安装目录下的配置文件my.ini</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"><span class="comment"># The next three options are mutually exclusive to SERVER_PORT below.</span></span><br><span class="line"><span class="comment"># skip-networking</span></span><br><span class="line"><span class="comment"># enable-named-pipe</span></span><br><span class="line"><span class="comment"># shared-memory</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># shared-memory-base-name=MYSQL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The Pipe the MySQL Server will use</span></span><br><span class="line"><span class="comment"># socket=MYSQL</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The TCP/IP Port the MySQL Server will listen on</span></span><br><span class="line">port=3306</span><br><span class="line"></span><br><span class="line"><span class="comment"># Path to installation directory. All paths are usually resolved relative to this.</span></span><br><span class="line"><span class="comment"># basedir="C:/Program Files/MySQL/MySQL Server 5.6/"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Path to the database root</span></span><br><span class="line">datadir=C:/ProgramData/MySQL/MySQL Server 5.6/Data</span><br><span class="line"></span><br><span class="line"><span class="comment"># The default character set that will be used when a new schema or table is</span></span><br><span class="line"><span class="comment"># created and no character set is defined</span></span><br><span class="line"><span class="comment"># character-set-server=</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The default storage engine that will be used when create new tables when</span></span><br><span class="line">default-storage-engine=INNODB</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set the SQL mode to strict</span></span><br><span class="line">sql-mode=<span class="string">"STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># General and Slow logging.</span></span><br><span class="line"><span class="built_in">log</span>-output=FILE</span><br><span class="line">general-log=0</span><br><span class="line">general_log_file=<span class="string">"DESKTOP-MOP0GDT.log"</span></span><br><span class="line">slow-query-log=1</span><br><span class="line">slow_query_log_file=<span class="string">"DESKTOP-MOP0GDT-slow.log"</span></span><br><span class="line">long_query_time=0</span><br></pre></td></tr></tbody></table></figure><p>slow_query_log 是否开启慢查询日志，1表示开启，0表示关闭。<br>slow_query_log_file 指定慢查询日志得存储路径及文件（默认和数据文件放一起）<br>long_query_time 指定记录慢查询日志SQL执行时间伐值（单位：秒，默认10秒），为了测试方便我们修改为0<br>log_queries_not_using_indexes  是否记录未使用索引的SQL<br>log_output 日志存放的地方【TABLE】【FILE】【FILE,TABLE】</p><p>修改配置文件后，要使配置生效，需求重启Mysql服务，Win+R 输入 services.msc 回车打开服务<br><img src="http://static.nsoft.vip/20200413141020.png" alt=""><br>在服务列表中，找到mysql 右键重启服务<br><img src="http://static.nsoft.vip/20200413141353.png" alt=""></p><h3 id="通过SQL命令开启慢查询"><a href="#通过SQL命令开启慢查询" class="headerlink" title="通过SQL命令开启慢查询"></a>通过SQL命令开启慢查询</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> global slow_query_log = 1; --开启慢查询日志</span><br><span class="line"><span class="built_in">set</span> global long_query_time=0;</span><br><span class="line"><span class="built_in">set</span> global log_output=<span class="string">'FILE,TABLE'</span></span><br></pre></td></tr></tbody></table></figure><p>通过命令设置开启慢查询不需要重启Mysql服务可以使设置立即生效，如果重启Mysql服务设置的参数将被还原，查看设置后的参数</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">show VARIABLES like <span class="string">'%slow_query_log%'</span></span><br><span class="line"></span><br><span class="line">show VARIABLES like <span class="string">'%slow_query_log_file%'</span></span><br><span class="line"></span><br><span class="line">show VARIABLES like <span class="string">'%long_query_time%'</span></span><br><span class="line"></span><br><span class="line">show VARIABLES like <span class="string">'%log_queries_not_using_indexes%'</span></span><br><span class="line"></span><br><span class="line">show VARIABLES like <span class="string">'log_output'</span></span><br></pre></td></tr></tbody></table></figure><h3 id="慢查询解读"><a href="#慢查询解读" class="headerlink" title="慢查询解读"></a>慢查询解读</h3><p>当我们开启了慢查询，默认情况下，慢查询日志文件保存在与数据库数据文件同级目录中，这里我们找到生成的慢查询日志文件<br><img src="http://static.nsoft.vip/20200413143844.png" alt=""><br>从慢查询日志里面摘选一条慢查询日志，数据组成如下<br><img src="http://static.nsoft.vip/20200413144525.png" alt=""><br>把方便解读放，慢查询格式显示<br><img src="http://static.nsoft.vip/20200413144614.png" alt=""><br>第一行：用户名 、用户的IP信息、线程ID号<br>第二行：执行花费的时间【单位：毫秒】<br>第三行：执行获得锁的时间<br>第四行：获得的结果行数<br>第五行：扫描的数据行数<br>第六行：这SQL执行的具体时间<br>第七行：具体的SQL语句</p><h2 id="慢查询日志分析工具"><a href="#慢查询日志分析工具" class="headerlink" title="慢查询日志分析工具"></a>慢查询日志分析工具</h2><p>我们开启慢查询的目的就是通过慢查询日志来找出有问题的SQL语句，对其进行优化。随着mysql数据库服务器运行时间的增加，数据库表记录的增多，可能会有越来越多的SQL语句被记录到了慢查询日志文件中，慢查询的日志记录非常多，要从里面找寻一条查询慢的日志并不是很容易的事情，一般来说都需要一些工具辅助才能快速定位到需要优化的SQL语句。下面介绍两个慢查询辅助工具</p><p>ActivePerl一个perl脚本解释器，工具下载地址<a href="https://www.activestate.com/products/perl/downloads/" target="_blank" rel="noopener">https://www.activestate.com/products/perl/downloads/</a> 安装完成后，我们就可以在命令行中使用perl命令了</p><p>进入Mysql 安装目录bin路径下，使用mysql自带的mysqldumpslow.pl 执行perl命令如下</p><p>语法：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">perl mysqldumpslow.pl -s r -t 5 d:\DESKTOP-MOP0GDT-slow.log</span><br><span class="line"></span><br><span class="line">-s order (c,t,l,r,at,al,ar) </span><br><span class="line">         c:总次数</span><br><span class="line">         t:总时间</span><br><span class="line">         l:锁的时间</span><br><span class="line">         r:总数据行</span><br><span class="line">         at,al,ar  :t,l,r平均数  【例如：at = 总时间/总次数】</span><br><span class="line"></span><br><span class="line">  -t  top   指定取前面作为结果输出</span><br></pre></td></tr></tbody></table></figure><p>通过如上命令，我们能够方便的查找出top前5条需要待优化的记录如下。<br><img src="http://static.nsoft.vip/20200413152406.png" alt=""></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://static.nsoft.vip/20200413135049.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="高性能架构" scheme="https://crazyrico.com/categories/%E9%AB%98%E6%80%A7%E8%83%BD%E6%9E%B6%E6%9E%84/"/>
    
      <category term="Mysql" scheme="https://crazyrico.com/categories/%E9%AB%98%E6%80%A7%E8%83%BD%E6%9E%B6%E6%9E%84/Mysql/"/>
    
    
      <category term="Mysql" scheme="https://crazyrico.com/tags/Mysql/"/>
    
  </entry>
  
  <entry>
    <title>互联网推荐理财书籍整理（提供下载）</title>
    <link href="https://crazyrico.com/posts/2019/10/18/8ea59936.html"/>
    <id>https://crazyrico.com/posts/2019/10/18/8ea59936.html</id>
    <published>2019-10-18T02:20:21.000Z</published>
    <updated>2019-10-18T03:05:16.021Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://i.loli.net/2019/10/18/yEj2STdvOabGxnf.jpg" alt="理财.jpg"></p><a id="more"></a><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>你不理财，财不理你，理财对所有人来都是非常重要的，互联网推荐理财书籍收集于此，下面是知乎高赞回答关于入门理财的书籍，分享给大家。</p><h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>这里列出的是关于零基础的小伙伴入门理财的图书，不难都是通俗易懂，按照从上到下慢慢深入，大家可以跟我一样，从上到下一本本的读。</p><p>1.《小狗钱钱》<br>看起来，这是一本写给小朋友的童书，其实，这里面的故事，适合每一个想理财入门的人。<br>《小狗钱钱》最厉害的地方，就是用最生活化的故事讲理财，所有的理念、方法，都设计成了简单易学的操作技巧。即使你对理财毫无概念，也能全部读懂，并且，打了一波鸡血，跃跃欲试。<br><a href="https://pan.baidu.com/s/19JTIDGTXLOsNJG8AK5pZ3g&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/19JTIDGTXLOsNJG8AK5pZ3g&amp;shfl=sharepset</a></p><p>2.《富爸爸，穷爸爸》<br>这本书名气太大了，作者罗伯特•清崎简直是全世界人民的理财启蒙老师。中国人最早知道理财是怎么回事，也是从这本书开始。<br><a href="https://pan.baidu.com/s/1stxyUz8BAa_WkXZYYYlEjQ&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1stxyUz8BAa_WkXZYYYlEjQ&amp;shfl=sharepset</a></p><p>3.《财务自由之路》<br>是《小狗钱钱》的作者写的另外一本书，可以理解为升级版。它把前面两本书里，你没看懂的、有疑惑的内容全都解释清楚了。<br>链接：<a href="https://pan.baidu.com/s/1rrbwWoRZPe7trS494f0DvA&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1rrbwWoRZPe7trS494f0DvA&amp;shfl=sharepset</a><br>提取码：omz9</p><p>4.《富爸爸—财务自由之路》<br>　“为什么有的人可以用较少的劳动取得较多的收入？为什么有的人可以享受比别人更多的财务自由？明白何时从何种象限开始工作，这很重要。此书献给那些渴望提高收入，以及希望从工业时代跨入信息时代的人们。”此书旨在帮你选择新的项目、新的目标，以及一个新的财务前景。<br><a href="https://pan.baidu.com/s/1jqX9KCTjCBWl5sO4p1_eXg&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1jqX9KCTjCBWl5sO4p1_eXg&amp;shfl=sharepset</a></p><p>5.《邻家的百万富翁》<br>这是一本有所期待，而后放下期待，但也不至于失望的书。全书最为突出的是“节俭”，即“多入少出”，不因社会攀比而过度消费。全书涉及最多的三个关键词是：节俭、预算、目标。<br><a href="https://pan.baidu.com/s/1zgHDe62J4UxzVldBkTkpZg&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1zgHDe62J4UxzVldBkTkpZg&amp;shfl=sharepset</a></p><p>6.《巴比伦最富有的人》<br>假如你是个很不爱看书的人，看这本（或者看完《小狗钱钱》后看这本），里面全是故事，讲了很多道理，很有用，我个人很喜欢。<br><a href="https://pan.baidu.com/s/1T9BmRSuM9BPd6Trx36D-JA&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1T9BmRSuM9BPd6Trx36D-JA&amp;shfl=sharepset</a></p><p>7.《钱的外遇》<br>一个香港人写的，里面很多东西不适合大陆的国情，但它有个最大的优点是，看完之后你就能避开99%的投资陷阱。<br><a href="https://pan.baidu.com/s/1UXqeDnlv84HJ2FVPi3sxyA&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1UXqeDnlv84HJ2FVPi3sxyA&amp;shfl=sharepset</a></p><p>8.《有钱人和你想的不一样》<br>这本书的目标是，帮助你提高自己的意识。意识是观察你的思想和行动，让你现在可以从真实的选择中进行运作，而不是基于过去的程序而行动。它给予你力量，让你从更高级的自我而不是源于恐惧的、更低级的自我去做出反应。<br><a href="https://pan.baidu.com/s/1aOhe4SRctBpGiDXbvwiQew&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1aOhe4SRctBpGiDXbvwiQew&amp;shfl=sharepset</a></p><p>9.《学会花钱》<br>花钱怎样掌握分寸？投资如何把握时点？面对不确定性又该如何安排金钱？明智花钱不是把每一分钱都花在刀刃上，而是让花出去的每一分钱变成未来的财富。不用剁手，尽情买买买。轻松辨识有价值的资产，拒绝智商税。<br><a href="https://pan.baidu.com/s/1roq98gQtoAIAVGfxKDN-OQ&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1roq98gQtoAIAVGfxKDN-OQ&amp;shfl=sharepset</a></p><p>10.《买基金为自己加薪》<br>《买基金为自己加薪》所讲述的是定时定额投资基金的方法，作者指出只设停利，不设停损，赚够就走。看收益，更要看风险。<br><a href="https://pan.baidu.com/s/1mBCyM13wCroKvikn_QaNoQ&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1mBCyM13wCroKvikn_QaNoQ&amp;shfl=sharepset</a></p><p>11.《30年后，你拿什么养活自己》<br>要给你的未来加点危机感吗？没有比这本书更好的了。<br><a href="https://pan.baidu.com/s/1wHX5K7Fn5AjzyjFJEj7qAg&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1wHX5K7Fn5AjzyjFJEj7qAg&amp;shfl=sharepset</a></p><p>12.《生财有道》<br>在本书中，作者结合自己的失败和成功的亲身经历以及大量的实例来阐<br>明赚钱之道、理财之方，并且设计了大量的实际操作练习， 读者在阅读的<br>同时就可以借助于这位教练的指导进行实践。<br><a href="https://pan.baidu.com/s/1gH0jFcmKYHqR2qwDo2vr9w&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1gH0jFcmKYHqR2qwDo2vr9w&amp;shfl=sharepset</a></p><p>13.《拱出银行的小猪》<br>《拱出银行的小猪》是一本关于家庭、个人理财的知识的普及读本。与时 下充满专业术语的投资理财书不同，本书彩了讲故事的形式，通过善财童 子拜访财神的十二弟子之旅，逐篇介绍存款，债券、股票、基金信托、保 险、房地产、期货期权、外汇、贵金属、收藏品、实煨投资和健康等十二 投资品种，并分别提示了其不同的“财性”投资理财其实并不复杂，关键 在于扼其要领。<br><a href="https://pan.baidu.com/s/1kmnOGXXPMwoXEbufT-l0PQ&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1kmnOGXXPMwoXEbufT-l0PQ&amp;shfl=sharepset</a></p><p>14.《工作前5年，决定你一生的财富》<br>它最大的意义，不是教你高明的投资技巧，而是让你正确理解金钱、尊重金钱。这个只知道花钱的三公子，在坚持5年理财后，不但财富有了明显增长，人生态度也变得积极从容。<br><a href="https://pan.baidu.com/s/1mJE38Rh9-lAK2bT6bgv1QQ&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1mJE38Rh9-lAK2bT6bgv1QQ&amp;shfl=sharepset</a></p><p>15.《钱不要存银行》<br>如果早一年看到这本书，可以减少很多盲目投资带来的损失，也会轻松避免被各种蝇头小利吸引而走的弯路。书里学到最深刻的几点：1、分散投资 2、不对收益抱高期望 3、天下没有免费午餐 4、投资需成本与时间 5、只可掌控风险而非收益。<br><a href="https://pan.baidu.com/s/1-O0iJNGJb3EaM0GpdKzn7g&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1-O0iJNGJb3EaM0GpdKzn7g&amp;shfl=sharepset</a></p><p>16.《基金投资入门与技巧》<br>这本书全是干货，关于基金投资的，所有内容都说得很明白、浅显。无论你想投资余额宝，还是其他复杂的基金，都可以按图索骥。我在市面上没有找到任何跟它一样好的基金介绍书籍。作者是水湄物语。<br><a href="https://pan.baidu.com/s/1EEq_1XE8sPA55NtySZ9kZQ&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1EEq_1XE8sPA55NtySZ9kZQ&amp;shfl=sharepset</a></p><p>17.《管道的力量》<br>强烈推荐大家阅读这本书，简而易懂，并能够开启上班族财商的好书。告诉我们为什么要建立管道，如何建立管道，值得多次学习。<br><a href="https://pan.baidu.com/s/1BU1dbKaJa9A6RbTfB2qSiA&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1BU1dbKaJa9A6RbTfB2qSiA&amp;shfl=sharepset</a></p><p>18.《思考致富》<br>拿破仑·希尔（1883-1970年）被誉为“百万富翁的创造者”，美国成功学励志专家，成功学、创造学、人际学的世界顶尖培训大师。在美国，这个名字家喻户晓。由于他创造性地建立了全新的成功学，因此在人际学、创造学、成功学等领域比戴尔·卡耐基有着更高的地位。他创建的成功哲学和十七项成功原则，以及他永远如火如荼的热情，鼓舞了千百万人。<br><a href="https://pan.baidu.com/s/1ff3rP-s-DU4PEV-89BfjFw&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1ff3rP-s-DU4PEV-89BfjFw&amp;shfl=sharepset</a></p><p>19.《漫步华尔街》<br>《漫步华尔街》投资入门的经典之作，也是众多民间高手的启蒙书。散户想长期稳定盈利的方法只有一个：买入指数基金，并一直持有。全书主要就讲了这么一件事。<br><a href="https://pan.baidu.com/s/1s84AZPzo-DbWwXz8VjiHkg&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1s84AZPzo-DbWwXz8VjiHkg&amp;shfl=sharepset</a></p><p>20.《聪明的投资者》<br>这本书是巴菲特的老师格雷厄姆的心血之作，包含了格雷厄姆价值投资的精髓，也包含量化的精髓。<br><a href="https://pan.baidu.com/s/1bYzmSBkYisvUtB3YXc9QTw&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1bYzmSBkYisvUtB3YXc9QTw&amp;shfl=sharepset</a></p><p>21.《滚雪球》<br>巴菲特的传记。书中记录了他从孩童时期就开始的投资史，讲述他如何在平凡生活中发现投资良机，如何从错误中吸取教训，如何培养自己的商业嗅觉，如何找到“一条又长又湿的雪道”，把自己的资产雪球越滚越大。<br><a href="https://pan.baidu.com/s/1mreQ--TgUCE__oF1TzWhAQ&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1mreQ--TgUCE__oF1TzWhAQ&amp;shfl=sharepset</a></p><p>22.《穷查理宝典》<br>在公众眼中，沃伦·巴菲特是伯克希尔·哈撒韦的代表人物，是该公司多年来取得非凡成就的大功臣；但另有一人也对该公司传奇般的业绩作出了重要贡献，那就是查理·芒格。虽然他在普通人中的知名度远没有巴菲特那么高，但他同巴菲特一样，能引领你作出更好的投资和决策，让你对世界和生活有更深刻的理解。<br><a href="https://pan.baidu.com/s/13XHifUaxnNZ0MoiOLc_5gA&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/13XHifUaxnNZ0MoiOLc_5gA&amp;shfl=sharepset</a></p><p>23.《巴菲特给股东的信》<br>这本书其实才是巴菲特投资思想的精髓，当中很多的段落都值得我们反复的思考。建议看上十遍以上。<br><a href="https://pan.baidu.com/s/1te8mlrRD1lLixwlWXg29mg&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1te8mlrRD1lLixwlWXg29mg&amp;shfl=sharepset</a></p><p>24.《彼得·林奇的成功投资》<br>彼得·林奇一直以他的选股能力而著称，他又一句名言：只要用心对股票做一点点研究，普通投资者也能成为股票投资专家，并且在选股方面的成绩能像华尔街的专家一样出色。<br><a href="https://pan.baidu.com/s/1U_epvJzrpvmjM5YAC2cW8w&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1U_epvJzrpvmjM5YAC2cW8w&amp;shfl=sharepset</a></p><p>25.《黑天鹅》<br>生活中，随机性随处可见，在资本市场也是一样。人们总是以自己有限的生活经验和不堪一击的信念来解释不可预测的事件；即便是精于算计的专业人士，也难保不被随机性愚弄，其实我们应该做的是顺应这种不可知的未来。这本书会教你改变自己的思维方式，把握黑天鹅带来的机会，采取应对策略，从中受益。<br>链接：<a href="https://pan.baidu.com/s/1nW5Ff4cq-kiSxymH_G5jAg&amp;shfl=sharepset" target="_blank" rel="noopener">https://pan.baidu.com/s/1nW5Ff4cq-kiSxymH_G5jAg&amp;shfl=sharepset</a><br>提取码：hs6q<br>复制这段内容后打开百度网盘手机App，操作更方便哦</p><h2 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h2><p>若链接过期，关注下方公众号，回复【理财】批量获取！或加本人微信【alexyao2012】获取！<br>本文书籍均于收集于互联网，仅供学习交流使用，不构成商业目的。版权归原作者所有，如需请购买正版。<br>如果有侵犯到您的权利，请及时联系我们删除。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://i.loli.net/2019/10/18/yEj2STdvOabGxnf.jpg&quot; alt=&quot;理财.jpg&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="其他" scheme="https://crazyrico.com/categories/%E5%85%B6%E4%BB%96/"/>
    
      <category term="理财" scheme="https://crazyrico.com/categories/%E5%85%B6%E4%BB%96/%E7%90%86%E8%B4%A2/"/>
    
    
      <category term="理财" scheme="https://crazyrico.com/tags/%E7%90%86%E8%B4%A2/"/>
    
  </entry>
  
  <entry>
    <title>Visual Studio Code 图床工具插件你值得拥有</title>
    <link href="https://crazyrico.com/posts/2019/03/14/a7270864.html"/>
    <id>https://crazyrico.com/posts/2019/03/14/a7270864.html</id>
    <published>2019-03-14T13:05:58.000Z</published>
    <updated>2019-10-16T08:06:47.661Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://static.nsoft.vip/20190307194339.jpg" alt="20190307194339.jpg"></p><a id="more"></a><h2 id="vscode简介"><a href="#vscode简介" class="headerlink" title="vscode简介"></a>vscode简介</h2><p>Visual Studio Code（以下简称vscode）微软发布的一款开源免费跨平台的轻量且强大的代码编辑器，支持Windows，OS X和Linux。内置JavaScript、TypeScript和Node.js支持，而且拥有丰富的插件生态系统，可通过安装插件来支持C++、C#、Python、Java、PHP等其他语言。不得不说vscode是一款良心之作。</p><p>相信很多程序员同学已经在工作中使用这个工具了，博主也是一样在工作中做些前端界面开发、静态博客书写都用vscode，完善的插件生态支持，乃神器也~~</p><p>vscode官网下载地址： <a href="https://code.visualstudio.com/" target="_blank" rel="noopener">https://code.visualstudio.com/</a> 根据自己的系统版本选择下载相应的安装包，具体安装这里不做过多介绍，也挺简单，今天主要介绍它的一款图床插件:<a href="https://molunerfinn.com/PicGo/" target="_blank" rel="noopener">PicGo</a></p><h2 id="PicGo介绍"><a href="#PicGo介绍" class="headerlink" title="PicGo介绍"></a>PicGo介绍</h2><p>PicGo基于electron-vue开发,支持macOS,Windows,Linux 支持插件系统，让PicGo更强大 Github项目地址：<a href="https://github.com/Molunerfinn/PicGo" target="_blank" rel="noopener">https://github.com/Molunerfinn/PicGo</a><br>PicGo目前支持了</p><ul><li>微博图床 v1.0</li><li>七牛图床 v1.0</li><li>腾讯云COS v4\v5版本 v1.1 &amp; v1.5.0</li><li>又拍云 v1.2.0</li><li>GitHub v1.5.0</li><li>SM.MS v1.5.1</li><li>阿里云OSS v1.6.0</li><li>Imgur v1.6.0<br>PicGo本身可以作为一款应用安装在我们的电脑上，上传图片获取外链，我们可以选择将图片上传至微博云、七牛云等，配置简单使用方便。</li></ul><h2 id="vs-picgo插件"><a href="#vs-picgo插件" class="headerlink" title="vs-picgo插件"></a>vs-picgo插件</h2><p>有了PicGo图片上传获取外链已经很方便了，如何更优雅的使用vscode书写markdown, 大神<a href="https://github.com/Spades-S" target="_blank" rel="noopener">@Spades-S</a>基于PicGo开发的:<a href="https://github.com/Spades-S/vs-picgo" target="_blank" rel="noopener">https://github.com/Spades-S/vs-picgo</a> A vscode plugin for PicGo 当你用过一次，你真的会爱上她O(∩_∩)O哈哈~ 看下面它的项目介绍：</p><p>在 VSCode 里使用 picgo，实现快速上传图片到远端图床并直接将 URL 写进 Markdown 文件里，极大提升 Markdown 贴图效率与体验。支持 <a href="https://github.com/Molunerfinn/PicGo" target="_blank" rel="noopener">PicGo</a> 原生自带的 8 种图床。</p><ul><li>截图上传</li></ul><p><img src="https://raw.githubusercontent.com/Molunerfinn/test/master/picgo/vs-picgo-clipboard.gif" alt=""></p><ul><li>文件管理器选择上传</li></ul><p><img src="https://raw.githubusercontent.com/Molunerfinn/test/master/picgo/vs-picgo-explorer.gif" alt=""></p><ul><li>输入文件路径上传</li></ul><p><img src="https://raw.githubusercontent.com/Molunerfinn/test/master/picgo/vs-picgo-inputbox.gif" alt=""></p><h2 id="vscode中安装vs-picgo插件"><a href="#vscode中安装vs-picgo插件" class="headerlink" title="vscode中安装vs-picgo插件"></a>vscode中安装vs-picgo插件</h2><p>当然根据上面的github项目介绍，你应该完全可以配置并使用这个工具，极大的提示贴图的效率与体验了，但是本着文章完整性的原则，这里将插件的安装使用配置做个说明：</p><p>1、打开vscode 点击左侧插件(Extensions)菜单,点击搜索 picgo 回车，点击install安装并重新加载，我这边已经安装过了，如下：</p><p><img src="http://static.nsoft.vip/20190314220710.png" alt="20190314220710.png"></p><p>2、安装完成后，其实你已经可以在.md文件中优雅的贴图了，默认vs-picgo上传至smms图床上。<br>KeyMap</p><p>You can change all the keymaps below as you wish.</p><p>Uploading an image from clipboard<br>Windows/Unix: Ctrl + Alt + u<br>OsX: Cmd + Opt + u</p><p>Uploading images from explorer<br>Windows/Unix: Ctrl + Alt + e<br>OsX: Cmd + Opt + e</p><p>Uploading an image from input box<br>Windows/Unix: Ctrl + Alt + o<br>OsX: Cmd + Opt + 0</p><p>3、配置七牛图床，在<a href="https://www.qiniu.com/" target="_blank" rel="noopener">七牛官网</a>注册获取：accessKey、secretKey，不过多介绍，官方有说明文档，这里主要记录下vscode usersetting.</p><p><img src="http://static.nsoft.vip/20190314221833.png" alt="20190314221833.png"></p><p>4、选择usersettng –&gt; Files –&gt; Edit in setting.json<br><img src="http://static.nsoft.vip/20190314221952.png" alt="20190314221952.png"></p><p>5、将默认的picgo修改为qiniu配置并保存，这样上传的图片就提交至七牛图床了<br><img src="http://static.nsoft.vip/20190314222230.png" alt="20190314222230.png"></p><p>更多的图床支持，上面vs-picgo项目中均有说明，so 嗨，妈妈再也不用担心我的贴图<del>~</del></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line"> <span class="string">"picgo"</span>: {</span><br><span class="line"> <span class="string">"path"</span>: <span class="string">"path to your external configure file"</span> // default value is <span class="string">""</span>, <span class="built_in">which</span> means use <span class="string">"picBed"</span> info below. External configure file should be a JSON file containing all the <span class="string">"picBed"</span> info below.</span><br><span class="line"> },</span><br><span class="line"> <span class="string">"picBed"</span>: {</span><br><span class="line"> <span class="string">"current"</span>: <span class="string">"smms"</span>,  // current image hosting, default value is <span class="string">"smms"</span></span><br><span class="line"> <span class="string">"weibo"</span>:{           // weibo image hosting</span><br><span class="line"> <span class="string">"chooseCookie"</span>: <span class="literal">true</span> | <span class="literal">false</span>,</span><br><span class="line"> <span class="string">"username"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"password"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"quality"</span>: <span class="string">"thumbnail"</span> | <span class="string">"mw690"</span> | <span class="string">"large"</span>,</span><br><span class="line"> <span class="string">"cookie"</span>: <span class="string">""</span></span><br><span class="line"> },</span><br><span class="line"> <span class="string">"qiniu"</span>: {          // qiniu image hosting</span><br><span class="line"> <span class="string">"accessKey"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"secretKey"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"bucket"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"url"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"area"</span>: <span class="string">""</span>,       // <span class="string">"z0"</span> -&gt; 华东, <span class="string">"z1"</span> -&gt; 华北, <span class="string">"z2"</span> -&gt; 华南, <span class="string">"na0"</span> -&gt; 北美, <span class="string">"as0"</span> -&gt; 东南亚</span><br><span class="line"> <span class="string">"options"</span>: <span class="string">""</span> // prefix of url</span><br><span class="line"> <span class="string">"path"</span>:<span class="string">""</span> // postfix of path</span><br><span class="line"> },</span><br><span class="line"> <span class="string">"upyun"</span>: {          // upyun image hosting</span><br><span class="line"> <span class="string">"bucket"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"operator"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"password"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"options"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"path"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"url"</span>: <span class="string">""</span></span><br><span class="line"> },</span><br><span class="line"> <span class="string">"tcyun"</span>: {          // tcyun image hosting</span><br><span class="line"> <span class="string">"secretId"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"secretKey"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"bucket"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"appId"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"area"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"path"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"customUrl"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"version"</span>: <span class="string">"v5"</span> | <span class="string">"v4"</span></span><br><span class="line"> },</span><br><span class="line"> <span class="string">"github"</span>: {         // github image hosting</span><br><span class="line"> <span class="string">"repo"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"token"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"path"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"customUrl"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"branch"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"username"</span>: <span class="string">""</span></span><br><span class="line"> },</span><br><span class="line"> <span class="string">"aliyun"</span>: {         // aliyun image hosting</span><br><span class="line"> <span class="string">"accessKeyId"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"accessKeySecret"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"bucket"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"area"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"path"</span>: <span class="string">""</span>,</span><br><span class="line"> <span class="string">"customUrl"</span>: <span class="string">""</span></span><br><span class="line"> }</span><br><span class="line"> }</span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://static.nsoft.vip/20190307194339.jpg&quot; alt=&quot;20190307194339.jpg&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="其他" scheme="https://crazyrico.com/categories/%E5%85%B6%E4%BB%96/"/>
    
      <category term="工具" scheme="https://crazyrico.com/categories/%E5%85%B6%E4%BB%96/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="其他" scheme="https://crazyrico.com/tags/%E5%85%B6%E4%BB%96/"/>
    
      <category term="工具" scheme="https://crazyrico.com/tags/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="PicGo" scheme="https://crazyrico.com/tags/PicGo/"/>
    
  </entry>
  
  <entry>
    <title>centos7安装mariadb集群</title>
    <link href="https://crazyrico.com/posts/2019/03/07/3bca66de.html"/>
    <id>https://crazyrico.com/posts/2019/03/07/3bca66de.html</id>
    <published>2019-03-07T05:30:58.000Z</published>
    <updated>2019-10-16T08:06:47.655Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://static.nsoft.vip/1740939793.jpg" alt="1740939793.jpg"></p><a id="more"></a><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>1、准备三台Centos7虚拟机环境<br><img src="http://static.nsoft.vip/20190307182121.png" alt="20190307182121.png"></p><p>机器列表<br>192.168.48.211<br>192.168.48.212<br>192.168.48.213</p><p>2、设置主机名（设置三台虚拟机主机名分别为node1，node2，node3）</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /etc/hosts</span></span><br><span class="line">192.168.48.211  node1</span><br><span class="line">192.168.48.212  node2</span><br><span class="line">192.168.48.213  node3</span><br></pre></td></tr></tbody></table></figure><p>3、关闭SELINUX</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setenforce 0</span></span><br><span class="line"><span class="comment"># sed -i 's,^SELINUX=enforcing,SELINUX=disabled,g' /etc/selinux/config</span></span><br></pre></td></tr></tbody></table></figure><p>4、关闭防火墙</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service</span><br><span class="line">systemctl <span class="built_in">disable</span> firewalld.service</span><br></pre></td></tr></tbody></table></figure><p>5、使用以下命令快速添加YUM源</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tee /etc/yum.repos.d/mariadb.repo &lt;&lt;-'EOF'</span></span><br><span class="line">[mariadb]</span><br><span class="line">name = MariaDB</span><br><span class="line">baseurl = http://yum.mariadb.org/10.1/centos7-amd64</span><br><span class="line">gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB</span><br><span class="line">gpgcheck=1</span><br><span class="line">EOF</span><br></pre></td></tr></tbody></table></figure><p>6、由于Mariadb服务器是在国外，速度较慢，可以使用国内镜像源替代，以USTC镜像源为例</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sed -i 's#yum\.mariadb\.org#mirrors.ustc.edu.cn/mariadb/yum#' /etc/yum.repos.d/mariadb.repo</span></span><br></pre></td></tr></tbody></table></figure><p>7、刷新YUM缓存</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum makecache</span></span><br></pre></td></tr></tbody></table></figure><p>8、查看Mariadb相关的安装包，注意软件包版本和对应的YUM源名字</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum list MariaDB* galera</span></span><br></pre></td></tr></tbody></table></figure><p><img src="http://static.nsoft.vip/20190307182935.png" alt="20190307182935.png"></p><h2 id="部署MariaDB-Galera集群"><a href="#部署MariaDB-Galera集群" class="headerlink" title="部署MariaDB Galera集群"></a>部署MariaDB Galera集群</h2><p>执行yum安装命令(执行节点：node1, node2, node3)</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install -y MariaDB-server MariaDB-client galera</span></span><br></pre></td></tr></tbody></table></figure><p>待安装完成，启动数据库，并设置root账号权限密码(执行节点：node1, node2, node3)</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl start mariadb</span></span><br><span class="line"><span class="comment"># mysql -uroot -e "grant all privileges on *.* to 'root'@'localhost' identified by 'root';flush privileges;"</span></span><br></pre></td></tr></tbody></table></figure><p>也可使用如下方法设置数据库密码，测试情况使用 root  % root</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/bin/mysql_secure_installation</span></span><br></pre></td></tr></tbody></table></figure><p>设置完成之后关闭数据库</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl stop mariadb</span></span><br></pre></td></tr></tbody></table></figure><p>配置node1:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/my.cnf.d/server.cnf | grep -v '#'</span></span><br><span class="line"></span><br><span class="line">[server]</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line">[galera]</span><br><span class="line"></span><br><span class="line">wsrep_on=ON</span><br><span class="line">wsrep_provider=/usr/lib64/galera/libgalera_smm.so</span><br><span class="line">wsrep_cluster_address=<span class="string">"gcomm://192.168.48.211,192.168.48.212,192.168.48.213"</span></span><br><span class="line">wsrep_node_name = node1</span><br><span class="line">binlog_format=row</span><br><span class="line">default_storage_engine=InnoDB</span><br><span class="line">innodb_autoinc_lock_mode=2</span><br><span class="line"><span class="built_in">bind</span>-address=0.0.0.0</span><br><span class="line"></span><br><span class="line">wsrep_cluster_name=<span class="string">"MariaDB_Cluster"</span></span><br><span class="line">wsrep_node_address=192.168.48.211</span><br><span class="line">wsrep_sst_method=rsync</span><br><span class="line"></span><br><span class="line">wsrep_slave_threads=1</span><br><span class="line">innodb_flush_log_at_trx_commit=2</span><br><span class="line">innodb_buffer_pool_size=1024M</span><br><span class="line">wsrep_sst_auth=root:root</span><br><span class="line"></span><br><span class="line">[embedded]</span><br><span class="line"></span><br><span class="line">[mariadb]</span><br><span class="line"></span><br><span class="line">[mariadb-10.1]</span><br></pre></td></tr></tbody></table></figure><p>分别配置node2，node3，修改点为当前节点名称，当前节点ip地址:</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat /etc/my.cnf.d/server.cnf | grep -v '#'</span></span><br><span class="line"></span><br><span class="line">[server]</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line">[galera]</span><br><span class="line"></span><br><span class="line">wsrep_on=ON</span><br><span class="line">wsrep_provider=/usr/lib64/galera/libgalera_smm.so</span><br><span class="line">wsrep_cluster_address=<span class="string">"gcomm://192.168.48.211,192.168.48.212,192.168.48.213"</span></span><br><span class="line">wsrep_node_name = node2</span><br><span class="line">binlog_format=row</span><br><span class="line">default_storage_engine=InnoDB</span><br><span class="line">innodb_autoinc_lock_mode=2</span><br><span class="line"><span class="built_in">bind</span>-address=0.0.0.0</span><br><span class="line"></span><br><span class="line">wsrep_cluster_name=<span class="string">"MariaDB_Cluster"</span></span><br><span class="line">wsrep_node_address=192.168.48.212</span><br><span class="line">wsrep_sst_method=rsync</span><br><span class="line"></span><br><span class="line">wsrep_slave_threads=1</span><br><span class="line">innodb_flush_log_at_trx_commit=2</span><br><span class="line">innodb_buffer_pool_size=1024M</span><br><span class="line">wsrep_sst_auth=root:root</span><br><span class="line"></span><br><span class="line">[embedded]</span><br><span class="line"></span><br><span class="line">[mariadb]</span><br><span class="line"></span><br><span class="line">[mariadb-10.1]</span><br></pre></td></tr></tbody></table></figure><p><img src="http://static.nsoft.vip/20190307184819.png" alt="20190307184819.png"></p><p>在node1上执行如下命令，启动一个集群</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /usr/sbin/mysqld --wsrep-new-cluster --user=root &amp;</span></span><br></pre></td></tr></tbody></table></figure><p>查看集群状态</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql -uroot -proot</span></span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show  status like <span class="string">"wsrep_cluster_size"</span>;</span><br><span class="line">+--------------------+-------+</span><br><span class="line">| Variable_name      | Value |</span><br><span class="line">+--------------------+-------+</span><br><span class="line">| wsrep_cluster_size | 1     |</span><br><span class="line">+--------------------+-------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br></pre></td></tr></tbody></table></figure><p>在node2,node3节点上直接执行如下命令</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start mariadb</span><br></pre></td></tr></tbody></table></figure><p>再次查看集群状态，可以看到2,3节点已成功加入集群</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show  status like <span class="string">"wsrep_cluster_size"</span>;</span><br><span class="line">+--------------------+-------+</span><br><span class="line">| Variable_name      | Value |</span><br><span class="line">+--------------------+-------+</span><br><span class="line">| wsrep_cluster_size | 3     |</span><br><span class="line">+--------------------+-------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.01 sec)</span><br></pre></td></tr></tbody></table></figure><h2 id="集群数据同步测试"><a href="#集群数据同步测试" class="headerlink" title="集群数据同步测试"></a>集群数据同步测试</h2><p>在集群中任一一台主机执行如下命令</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; create database marspie;</span><br><span class="line">Query OK, 1 row affected (0.28 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; use marspie;</span><br><span class="line">Database changed</span><br><span class="line">MariaDB [marspie]&gt; create table user(id int primary key,name varchar(64));</span><br><span class="line">Query OK, 0 rows affected (0.16 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [marspie]&gt; show tables;</span><br><span class="line">+-------------------+</span><br><span class="line">| Tables_in_marspie |</span><br><span class="line">+-------------------+</span><br><span class="line">| user              |</span><br><span class="line">+-------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [marspie]&gt; insert into user values(1,<span class="string">'alex'</span>);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [marspie]&gt;</span><br></pre></td></tr></tbody></table></figure><p>查看另外两台主机，我们可以发现数据已经同步了</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| marspie            |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| <span class="built_in">test</span>               |</span><br><span class="line">+--------------------+</span><br><span class="line">6 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; use marspie;</span><br><span class="line">Reading table information <span class="keyword">for</span> completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MariaDB [marspie]&gt; show tables;</span><br><span class="line">+-------------------+</span><br><span class="line">| Tables_in_marspie |</span><br><span class="line">+-------------------+</span><br><span class="line">| user              |</span><br><span class="line">+-------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [marspie]&gt; select * from user;</span><br><span class="line">+----+------+</span><br><span class="line">| id | name |</span><br><span class="line">+----+------+</span><br><span class="line">|  1 | alex |</span><br><span class="line">+----+------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [marspie]&gt; insert into user values(2,<span class="string">'kiven'</span>);</span><br><span class="line">Query OK, 1 row affected (0.21 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [marspie]&gt;</span><br></pre></td></tr></tbody></table></figure><h2 id="常见问题解析"><a href="#常见问题解析" class="headerlink" title="常见问题解析"></a>常见问题解析</h2><p>1、在生产环境中必须打开防火墙，如果只开放了 4567 和 针对指定ip开放3306 端口，会导致加入集群失败，需要开放<br>3306, 4444, 4567, 4568 四个端口才可以正常启动。</p><p>2、直接kill点创建集群节点，会导致此节点无法启动<br><img src="http://static.nsoft.vip/20190307191741.png" alt="20190307191741.png"></p><ul><li>第一个启动的节点，在集群关闭数据库时需最后一个停止，再次启动集群是才可正常启动。</li><li>若第一个启动的节点被kill, 停止所有节点，再次启动第一个节点还是会启动失败，这时需进入mysql数据目录删除galera缓存文件，方可启动集群<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># cd /var/lib/mysql/</span></span><br><span class="line">[root@node1 mysql]<span class="comment"># rm -rf grastate.dat gvwstate.dat galera.cache </span></span><br><span class="line">[root@node1 mysql]<span class="comment"># /usr/sbin/mysqld --wsrep-new-cluster --user=root</span></span><br></pre></td></tr></tbody></table></figure></li></ul><p>后续如还有坑再补充！</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://static.nsoft.vip/1740939793.jpg&quot; alt=&quot;1740939793.jpg&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="高性能架构" scheme="https://crazyrico.com/categories/%E9%AB%98%E6%80%A7%E8%83%BD%E6%9E%B6%E6%9E%84/"/>
    
      <category term="MariaDB" scheme="https://crazyrico.com/categories/%E9%AB%98%E6%80%A7%E8%83%BD%E6%9E%B6%E6%9E%84/MariaDB/"/>
    
    
      <category term="centos7" scheme="https://crazyrico.com/tags/centos7/"/>
    
      <category term="MariaDB" scheme="https://crazyrico.com/tags/MariaDB/"/>
    
      <category term="mariadb" scheme="https://crazyrico.com/tags/mariadb/"/>
    
  </entry>
  
  <entry>
    <title>RabbitMQ详解</title>
    <link href="https://crazyrico.com/posts/2019/01/09/d6e5ae0b.html"/>
    <id>https://crazyrico.com/posts/2019/01/09/d6e5ae0b.html</id>
    <published>2019-01-09T05:33:02.000Z</published>
    <updated>2019-10-16T08:06:47.674Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://static.nsoft.vip/19-1-9/43486364.jpg" alt=""></p><a id="more"></a><h1 id="初识RabbitMQ"><a href="#初识RabbitMQ" class="headerlink" title="初识RabbitMQ"></a>初识RabbitMQ</h1><p>RabbitMQ是一个开源的消息代理和队列服务器，用来通过普通协议在完全不同的应用之间共享数据，RabbitMQ是使用Erlang语言编写的，并且RabbitMQ是基于AMQP协议的。</p><ul><li>目前很多互联网大厂都在使用RabbitMQ</li><li>RabbitMQ底层使用Erlang语言编写</li><li>开源、性能优秀、稳定性保障</li><li>与SpringAMQP完美整合、API丰富</li><li>集群模式丰富，表达式配置，HA模式，镜像队列模式</li><li>保证数据不丢失的前提做到高可用性，高可靠性</li><li>AMQP全称：Advanced Message Queuing Protocol(高级消息队列协议)</li></ul><h1 id="AMQP协议模型"><a href="#AMQP协议模型" class="headerlink" title="AMQP协议模型"></a>AMQP协议模型</h1><p><img src="http://static.nsoft.vip/19-1-14/59803987.jpg" alt=""></p><h1 id="AMQP核心概论"><a href="#AMQP核心概论" class="headerlink" title="AMQP核心概论"></a>AMQP核心概论</h1><p><strong>Virtual host</strong>: 虚拟地址，用于进行逻辑隔离，最上层的消息路由。一个Virtual Host里面可以有若干个Exchange和Queue，同时一个Virtual Host里面不能有相同名称的Exchange和Queue</p><p><strong>Exchange</strong>: 交换机，接收消息，根据路由键转发消息到绑定的队列</p><p><strong>Binding</strong>: Exchange和Queue之间的虚拟连接，binding中可以包含routing key</p><p><strong>Routing key</strong>: 一个路由规则，虚拟机可用它来确定如何路由一个特定消息</p><p><strong>Queue</strong>: 也称为Message Queue，消息队列，保存消息并将它们转发给消费者</p><h1 id="RabbitMQ消息流转"><a href="#RabbitMQ消息流转" class="headerlink" title="RabbitMQ消息流转"></a>RabbitMQ消息流转</h1><p><img src="http://static.nsoft.vip/19-1-15/6605.jpg" alt=""></p><h1 id="RabbitMQ整合SpringBoot2-x"><a href="#RabbitMQ整合SpringBoot2-x" class="headerlink" title="RabbitMQ整合SpringBoot2.x"></a>RabbitMQ整合SpringBoot2.x</h1><p>SpringBoot与RabbitMQ集成非常简单，不需要任何额外设置只需要两步即可：</p><h2 id="引入相关依赖"><a href="#引入相关依赖" class="headerlink" title="引入相关依赖"></a>引入相关依赖</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></tbody></table></figure><h2 id="配置application-properties"><a href="#配置application-properties" class="headerlink" title="配置application.properties"></a>配置application.properties</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rabbitmq服务地址</span></span><br><span class="line">spring.rabbitmq.addresses=192.168.8.193:5672</span><br><span class="line"><span class="comment"># rabbitmq用户名密码</span></span><br><span class="line">spring.rabbitmq.username=admin</span><br><span class="line">spring.rabbitmq.password=admin</span><br><span class="line"><span class="comment"># 虚拟地址</span></span><br><span class="line">spring.rabbitmq.virtual-host=/</span><br><span class="line"><span class="comment"># 超时设置</span></span><br><span class="line">spring.rabbitmq.connection-timeout=15000</span><br></pre></td></tr></tbody></table></figure><h2 id="代码配置"><a href="#代码配置" class="headerlink" title="代码配置"></a>代码配置</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">package com.marspie.config;</span><br><span class="line"></span><br><span class="line">import org.springframework.amqp.core.*;</span><br><span class="line">import org.springframework.amqp.rabbit.connection.CachingConnectionFactory;</span><br><span class="line">import org.springframework.amqp.rabbit.connection.ConnectionFactory;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Copyright (c) 2019, The Marspie Open Source Project</span><br><span class="line"> * 配置方法一： application.properties</span><br><span class="line"> * 配置方法二: 代码配置ConnectionFactory</span><br><span class="line"> * @author alex</span><br><span class="line"> * @date 2019/1/11 11 32</span><br><span class="line"> * @email yaonew@126.com</span><br><span class="line"> * @blog http://nsoft.vip</span><br><span class="line"> * Licensed under the Apache License, Version 2.0 (the <span class="string">"License"</span>);</span><br><span class="line"> * you may not use this file except <span class="keyword">in</span> compliance with the License.</span><br><span class="line"> * You may obtain a copy of the License at</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="line"> * &lt;p&gt;</span><br><span class="line"> * Unless required by applicable law or agreed to <span class="keyword">in</span> writing, software</span><br><span class="line"> * distributed under the License is distributed on an <span class="string">"AS IS"</span> BASIS,</span><br><span class="line"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="line"> * See the License <span class="keyword">for</span> the specific language governing permissions and</span><br><span class="line"> * limitations under the License.</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">public class RabbitMqConfig {</span><br><span class="line"></span><br><span class="line">/*    @Bean</span><br><span class="line">    public ConnectionFactory <span class="function"><span class="title">connectionFactory</span></span>() {</span><br><span class="line">        CachingConnectionFactory connectionFactory = new CachingConnectionFactory();</span><br><span class="line">        connectionFactory.setAddresses(<span class="string">"192.168.48.51:5672"</span>);</span><br><span class="line">        connectionFactory.setUsername(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setPassword(<span class="string">"admin"</span>);</span><br><span class="line">        connectionFactory.setVirtualHost(<span class="string">"/"</span>);</span><br><span class="line">        connectionFactory.setPublisherConfirms(<span class="literal">true</span>);//消息确认</span><br><span class="line">        connectionFactory.setPublisherReturns(<span class="literal">true</span>);</span><br><span class="line">        <span class="built_in">return</span> connectionFactory;</span><br><span class="line">    }*/</span><br><span class="line"></span><br><span class="line">    //topic</span><br><span class="line">    public static final String TOPIC_QUEUE1 = <span class="string">"topic.queue1"</span>;</span><br><span class="line">    public static final String TOPIC_QUEUE2 = <span class="string">"topic.queue2"</span>;</span><br><span class="line">    public static final String TOPIC_EXCHANGE = <span class="string">"topic.exchange"</span>;</span><br><span class="line">    // routingKey</span><br><span class="line">    public static final String TOPIC_ROUTING_KEY1 = <span class="string">"order.message"</span>;</span><br><span class="line">    public static final String TOPIC_ROUTING_KEY2 = <span class="string">"order.#"</span>;</span><br><span class="line"></span><br><span class="line">    //fanout</span><br><span class="line">    public static final String FANOUT_QUEUE1 = <span class="string">"fanout.queue1"</span>;</span><br><span class="line">    public static final String FANOUT_QUEUE2 = <span class="string">"fanout.queue2"</span>;</span><br><span class="line">    public static final String FANOUT_EXCHANGE = <span class="string">"fanout.exchange"</span>;</span><br><span class="line"></span><br><span class="line">    //redirect模式</span><br><span class="line">    public static final String DIRECT_QUEUE1 = <span class="string">"direct.queue1"</span>;</span><br><span class="line">    public static final String DIRECT_EXCHANGE = <span class="string">"direct.exchange"</span>;</span><br><span class="line">    public static final String DIRECT_QUEUE2 =<span class="string">"direct.queue2"</span> ;</span><br><span class="line">    // routingKey</span><br><span class="line">    public static final String DIRECT_ROUTING_KEY = <span class="string">"direct.order"</span>;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Topic模式</span><br><span class="line">     * 将路由键和某模式进行匹配。此时队列需要绑定要一个模式上。符号“<span class="comment">#”匹配一个或多个词，符号“*”匹配不多不少一个词。</span></span><br><span class="line">     * 因此“order.<span class="comment">#”能够匹配到“order.irs.corporate”，但是“order.*” 只会匹配到“order.irs”。</span></span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public Queue <span class="function"><span class="title">topicQueue1</span></span>() {</span><br><span class="line">        <span class="built_in">return</span> new Queue(TOPIC_QUEUE1);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Queue <span class="function"><span class="title">topicQueue2</span></span>() {</span><br><span class="line">        <span class="built_in">return</span> new Queue(TOPIC_QUEUE2);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public TopicExchange <span class="function"><span class="title">topicExchange</span></span>() {</span><br><span class="line">        <span class="built_in">return</span> new TopicExchange(TOPIC_EXCHANGE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Binding <span class="function"><span class="title">topicBinding1</span></span>() {</span><br><span class="line">        <span class="built_in">return</span> BindingBuilder.bind(topicQueue1()).to(topicExchange()).with(TOPIC_ROUTING_KEY1);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Binding <span class="function"><span class="title">topicBinding2</span></span>() {</span><br><span class="line">        <span class="built_in">return</span> BindingBuilder.bind(topicQueue2()).to(topicExchange()).with(TOPIC_ROUTING_KEY2);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Fanout模式</span><br><span class="line">     * Fanout 就是我们熟悉的广播模式或者订阅模式，给Fanout交换机发送消息，绑定了这个交换机的所有队列都收到这个消息。</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public Queue <span class="function"><span class="title">fanoutQueue1</span></span>() {</span><br><span class="line">        <span class="built_in">return</span> new Queue(FANOUT_QUEUE1);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Queue <span class="function"><span class="title">fanoutQueue2</span></span>() {</span><br><span class="line">        <span class="built_in">return</span> new Queue(FANOUT_QUEUE2);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public FanoutExchange <span class="function"><span class="title">fanoutExchange</span></span>() {</span><br><span class="line">        <span class="built_in">return</span> new FanoutExchange(FANOUT_EXCHANGE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Binding <span class="function"><span class="title">fanoutBinding1</span></span>() {</span><br><span class="line">        <span class="built_in">return</span> BindingBuilder.bind(fanoutQueue1()).to(fanoutExchange());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Binding <span class="function"><span class="title">fanoutBinding2</span></span>() {</span><br><span class="line">        <span class="built_in">return</span> BindingBuilder.bind(fanoutQueue2()).to(fanoutExchange());</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * direct模式</span><br><span class="line">     * 消息中的路由键（routing key）如果和 Binding 中的 binding key 一致， 交换器就将消息发到对应的队列中。路由键与队列名完全匹配.</span><br><span class="line">     * 这是一个完整的匹配。如果一个队列绑定到该交换机上要求路由键 “<span class="built_in">test</span>”，则只有被标记为“<span class="built_in">test</span>”的消息才被转发，不会转发test.aaa，也不会转发dog.bbb，只会转发<span class="built_in">test</span>。</span><br><span class="line">     * @<span class="built_in">return</span></span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public Queue <span class="function"><span class="title">directQueue1</span></span>() {</span><br><span class="line">        <span class="built_in">return</span> new Queue(DIRECT_QUEUE1);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public DirectExchange <span class="function"><span class="title">directExchange</span></span>() {</span><br><span class="line">        <span class="built_in">return</span> new DirectExchange(DIRECT_EXCHANGE);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Binding <span class="function"><span class="title">directBinding1</span></span>() {</span><br><span class="line">        <span class="built_in">return</span> BindingBuilder.bind(directQueue1()).to(directExchange()).with(DIRECT_ROUTING_KEY);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Topic模式"><a href="#Topic模式" class="headerlink" title="Topic模式"></a>Topic模式</h3><p>将路由键和某模式进行匹配。此时队列需要绑定要一个模式上。符号“#”匹配一个或多个词，符号“*”匹配不多不少一个词。 因此“order.#”能够匹配到“order.irs.corporate”，但是“order.*” 只会匹配到“order.irs”。</p><p>-生产者 </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class TopicSender {</span><br><span class="line">    @Autowired</span><br><span class="line">    private AmqpTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    public void send(Order order) {</span><br><span class="line">        this.rabbitTemplate.convertAndSend(RabbitMqConfig.TOPIC_EXCHANGE,<span class="string">"order.message"</span>, order);</span><br><span class="line">        this.rabbitTemplate.convertAndSend(RabbitMqConfig.TOPIC_EXCHANGE,<span class="string">"order.ha"</span>, order);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>-消费者</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class TopicReceiver {</span><br><span class="line">    // queues是指要监听的队列的名字</span><br><span class="line">    @RabbitListener(queues = RabbitMqConfig.TOPIC_QUEUE1)</span><br><span class="line">    public void receiveTopic1(Order order) {</span><br><span class="line">        System.out.println(<span class="string">"【receiveTopic1监听到消息】"</span> + order);</span><br><span class="line">    }</span><br><span class="line">    @RabbitListener(queues = RabbitMqConfig.TOPIC_QUEUE2)</span><br><span class="line">    public void receiveTopic2(Order order) {</span><br><span class="line">        System.out.println(<span class="string">"【receiveTopic2监听到消息】"</span> + order);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="Fanout模式"><a href="#Fanout模式" class="headerlink" title="Fanout模式"></a>Fanout模式</h3><p>Fanout 就是我们熟悉的广播模式或者订阅模式，给Fanout交换机发送消息，绑定了这个交换机的所有队列都收到这个消息。<br>-生产者 </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class FanoutSender {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AmqpTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    public void send(Order order) {</span><br><span class="line">        this.rabbitTemplate.convertAndSend(RabbitMqConfig.FANOUT_EXCHANGE, <span class="string">""</span>, order);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>-消费者</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class FanoutReceiver {</span><br><span class="line"></span><br><span class="line">    // queues是指要监听的队列的名字</span><br><span class="line">    @RabbitListener(queues = RabbitMqConfig.FANOUT_QUEUE1)</span><br><span class="line">    public void receiveTopic1(Order order) {</span><br><span class="line">        System.out.println(<span class="string">"【receiveFanout1监听到消息】"</span> + order);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @RabbitListener(queues = RabbitMqConfig.FANOUT_QUEUE2)</span><br><span class="line">    public void receiveTopic2(Order order) {</span><br><span class="line">        System.out.println(<span class="string">"【receiveFanout2监听到消息】"</span> + order);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h3 id="direct模式"><a href="#direct模式" class="headerlink" title="direct模式"></a>direct模式</h3><p>消息中的路由键（routing key）如果和 Binding 中的 binding key 一致， 交换器就将消息发到对应的队列中。路由键与队列名完全匹配.这是一个完整的匹配。如果一个队列绑定到该交换机上要求路由键 “test”，则只有被标记为“test”的消息才被转发，不会转发test.aaa，也不会转发dog.bbb，只会转发test。<br>-生产者 </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class DirectSender {</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    public void send(Order order) {</span><br><span class="line">        this.rabbitTemplate.convertAndSend(RabbitMqConfig.DIRECT_EXCHANGE, <span class="string">"direct.order"</span>, order);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>-消费者</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class DirectReceiver {</span><br><span class="line">    // queues是指要监听的队列的名字</span><br><span class="line">    @RabbitListener(queues = RabbitMqConfig.DIRECT_QUEUE1)</span><br><span class="line">    public void receiveDirect1(Order order) {</span><br><span class="line">        System.out.println(<span class="string">"【receiveDirect1监听到消息】"</span> + order);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    @RabbitListener(queues = RabbitMqConfig.DIRECT_QUEUE1)</span><br><span class="line">    public void receiveDirect2(Order order) {</span><br><span class="line">        System.out.println(<span class="string">"【receiveDirect2监听到消息】"</span> + order);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p><a href="https://github.com/yaonew/spring-boot" target="_blank" rel="noopener">GitHub源码</a><br><a href="https://gitee.com/yaonew/spring-boot" target="_blank" rel="noopener">码云源码</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://static.nsoft.vip/19-1-9/43486364.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="高性能架构" scheme="https://crazyrico.com/categories/%E9%AB%98%E6%80%A7%E8%83%BD%E6%9E%B6%E6%9E%84/"/>
    
      <category term="RabbitMQ" scheme="https://crazyrico.com/categories/%E9%AB%98%E6%80%A7%E8%83%BD%E6%9E%B6%E6%9E%84/RabbitMQ/"/>
    
    
      <category term="RabbitMQ" scheme="https://crazyrico.com/tags/RabbitMQ/"/>
    
      <category term="SpringBoot" scheme="https://crazyrico.com/tags/SpringBoot/"/>
    
  </entry>
  
  <entry>
    <title>2018年度账单</title>
    <link href="https://crazyrico.com/posts/2018/12/30/8b3704c2.html"/>
    <id>https://crazyrico.com/posts/2018/12/30/8b3704c2.html</id>
    <published>2018-12-30T11:21:07.000Z</published>
    <updated>2019-10-16T08:06:47.653Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://static.nsoft.vip/18-12-30-2345982.jpg" alt=""></p><a id="more"></a><p>好吧2018年年度账单出炉，扯点没用的，放松一下心情，拒绝沉重，保持轻松总结一下过去的2018, 下面扯蛋开始。。。</p><h2 id="18概要"><a href="#18概要" class="headerlink" title="18概要"></a>18概要</h2><p>2018年注定是繁忙的一年，也是值得纪念的一年，成功晋升为一名专业奶爸，成功晋升为一名资深房奴，成功… 好吧我一直走在成功的路上。</p><h2 id="18年经济"><a href="#18年经济" class="headerlink" title="18年经济"></a>18年经济</h2><p>2018年大家都知道发生了贸易战，作为贸易战的牺牲者，净资产亏损15%~20%左右（好吧其实没多少钱，基金一直处于亏损状态），然后这一年也深刻的意识到买房致富不是说说，现在回想17年本打算换房（然而由于我懒的费心）。这边的经济损失大概是目前资产的一倍还多吧。</p><p>最终在18年10月左右狠下心来，贱卖（其实也谈不上贱卖，比17年还便宜几万出手了）我们现有的小房子换了套大房子（其实也不大，小三房90多平而已），不过此时的房价已经比17年涨八九千每平，达到了2万七八，更糟糕的是银行房贷利率在基准利率的基础上上调了25%，从房贷优惠9折到优惠95折再到上调10%到上调15%最终再到上调至25%仅仅只花了1年左右的时间，我们很幸运的拿到了25%。直接房价加总利息累计多花费一百多万，所以买房真的可以致富，奉劝各位想买房的一定是越早买越好。<br><img src="http://static.nsoft.vip/18-12-30-1298759.jpg" alt=""></p><h2 id="18年家庭"><a href="#18年家庭" class="headerlink" title="18年家庭"></a>18年家庭</h2><p>2018年1月份我们的小嘟宝贝出生了，从此我们从2口之家变成了3口之家，当然更多的时间是陪伴这位新成员，刚开始这个折磨人的小乖乖不肯喝母乳，要通过乳盾给他喂奶（这期间也折磨我们好久），出院后第一次体检黄疸被迫住院照蓝光，三天后出院回来小家伙的嗓子都哑了（应该是在医院哭的，好心疼），黄疸需要多晒太阳，可是一连的阴雨天压根见不着太阳，小家伙一直处于黄疸指标的边缘，生怕他又被强制住院治疗。期间吃了茵栀黄，影响了他的消化系统，好长一段时间每天都拉挺多次。后来又是咳嗽，一直揪心着。</p><p>还好慢慢的小家伙一天天长大，慢慢会爬了，会坐了，会站，看着他一天天长大，内心充满了喜悦，其实爸爸都是心比较大，这要感谢我的老婆大人时刻关注宝宝每个成长阶段的注意事项，小家伙已经快一周岁了，感觉好欣慰，家庭的温馨，给小家伙一个良好的成长环境，是我一生的事业。</p><h2 id="18年事业"><a href="#18年事业" class="headerlink" title="18年事业"></a>18年事业</h2><p>2018年其实没有太大的变化，还是在原来的公司，一名标准的技术码农，然而也迷茫过，思考过，未来做什么，未来我想成为什么样的人。相信很多跟我一样的朋友很多，路在脚下吧，我还将继续探索…<br><img src="http://static.nsoft.vip/18-11-28/48083627.jpg" alt=""></p><h2 id="展望2019"><a href="#展望2019" class="headerlink" title="展望2019"></a>展望2019</h2><p>啰啰嗦嗦的说了一堆。纯粹就瞎扯吧，对于19年的目标</p><p>1、 生活方面<br>1.1 看更多的书（不局限于技术方面）<br>1.2 装修房子</p><p>2、 事业方面<br>2.1 提升业务技能<br>2.2 提升技术技能<br>2.3 完成一个秘密的小目标</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://static.nsoft.vip/18-12-30-2345982.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="其他" scheme="https://crazyrico.com/categories/%E5%85%B6%E4%BB%96/"/>
    
      <category term="随笔" scheme="https://crazyrico.com/categories/%E5%85%B6%E4%BB%96/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="其他" scheme="https://crazyrico.com/tags/%E5%85%B6%E4%BB%96/"/>
    
  </entry>
  
  <entry>
    <title>Docker之旅-Docker图形化管理和监控(二)</title>
    <link href="https://crazyrico.com/posts/2018/12/20/d5d001e7.html"/>
    <id>https://crazyrico.com/posts/2018/12/20/d5d001e7.html</id>
    <published>2018-12-20T01:42:50.000Z</published>
    <updated>2019-10-16T08:06:47.670Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://static.nsoft.vip/18-12-5/24521079.jpg" alt=""></p><a id="more"></a><h2 id="DockerUI"><a href="#DockerUI" class="headerlink" title="DockerUI"></a>DockerUI</h2><p>DockerUI是一个开源的基于Docker API的web应用程序，提供等同Docker命令行的大部分功能，支持container管理，image管理, networks 管理。它最值得称道的是它华丽的设计和用来运行和管理docker的简洁的操作界面。<br>获取<br>首先拉去dockerUI镜像，现在dockerUI镜像</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull uifd/ui-for-docker</span><br></pre></td></tr></tbody></table></figure><p>查看本地镜像</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ docker images</span><br><span class="line">REPOSITORY            TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hellowpy              latest              d1a8a6e4b2c4        28 hours ago        131MB</span><br><span class="line">yaonew/hellowpy       v1                  d1a8a6e4b2c4        28 hours ago        131MB</span><br><span class="line">redis                 latest              ce25c7293564        12 days ago         95MB</span><br><span class="line">nginx                 latest              568c4670fa80        4 weeks ago         109MB</span><br><span class="line">python                2.7-slim            0dc3d8d47241        5 weeks ago         120MB</span><br><span class="line">docker-compose_demo   latest              985f3637ded4        8 weeks ago         635MB</span><br><span class="line">maven                 3.5-jdk-8           985f3637ded4        8 weeks ago         635MB</span><br><span class="line">mysql/mysql-server    5.7                 76ac6291d3cf        2 months ago        234MB</span><br><span class="line">hello-world           latest              4ab4c602aa5e        3 months ago        1.84kB</span><br><span class="line">uifd/ui-for-docker    latest              965940f98fa5        2 years ago         8.1MB</span><br></pre></td></tr></tbody></table></figure><p>启动容器</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -it -d --name docker-web -p 9000:9000 -v /var/run/docker.sock:/var/run/docker.sock docker.io/uifd/ui-for-docker</span><br></pre></td></tr></tbody></table></figure><p>接着就可以在浏览器访问DockerUI管理界面了。启动了 DockerUI容器之后，就可以用它来执行启动、暂停、终止、删除以及DockerUI提供的其它操作Docker容器的命令。在浏览器里面输入 <a href="http://ip-address:9000，默认情况下登录不需要认证，但是可以配置我们的" target="_blank" rel="noopener">http://ip-address:9000，默认情况下登录不需要认证，但是可以配置我们的</a> web 服务器来要求登录认证<br><img src="http://static.nsoft.vip/18-12-26/23387040.jpg" alt=""><br><img src="http://static.nsoft.vip/18-12-26/72479348.jpg" alt=""><br><img src="http://static.nsoft.vip/18-12-26/3065833.jpg" alt=""><br>DockerUI优点：<br>1）支持container批量操作；<br>2）支持image管理（虽然比较薄弱）</p><p>DockerUI缺点：<br>不支持多主机。</p><h2 id="Shipyard入门"><a href="#Shipyard入门" class="headerlink" title="Shipyard入门"></a>Shipyard入门</h2><p><strong>比较遗憾目前Shipyard作者已停止维护，不过目前我们还是可以使用</strong><br>是一个集成管理docker容器、镜像、Registries的系统,它可以简化对横跨多个主机的Docker容器集群进行管理. 通过Web用户界面，你可以大致浏览相关信息，比如你的容器在使用多少处理器和内存资源、在运行哪些容器，还可以检查所有集群上的事件日志。<br>其特性主要包括：<br>1）支持节点动态集群，可扩展节点的规模（swarm、etcd方案）<br>2）支持镜像管理、容器管理、节点管理等功能<br>3）可视化的容器管理和监控管理<br>4）在线容console终端</p><h3 id="安装主节点-管理端"><a href="#安装主节点-管理端" class="headerlink" title="安装主节点(管理端)"></a>安装主节点(管理端)</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ curl -s https://raw.githubusercontent.com/shipyard/shipyard-project.com/master/site/themes/shipyard/static/deploy | bash -s</span><br><span class="line">Deploying Shipyard</span><br><span class="line"> -&gt; Starting Database</span><br><span class="line"> -&gt; Starting Discovery</span><br><span class="line"> -&gt; Starting Cert Volume</span><br><span class="line"> -&gt; Starting Proxy</span><br><span class="line"> -&gt; Starting Swarm Manager</span><br><span class="line"> -&gt; Starting Swarm Agent</span><br><span class="line"> -&gt; Starting Controller</span><br><span class="line">......</span><br><span class="line">Digest: sha256:5f065362680fa4565dd150c8da3edd09b79a7a3010d3ceef20093c2a879187e0</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> shipyard/shipyard:latest</span><br><span class="line">Waiting <span class="keyword">for</span> Shipyard on 192.168.48.244:8080</span><br><span class="line"></span><br><span class="line">Shipyard available at http://192.168.48.244:8080</span><br><span class="line">Username: admin Password: shipyard</span><br></pre></td></tr></tbody></table></figure><p>登陆拉取镜像，容器启动完成。</p><h3 id="登陆"><a href="#登陆" class="headerlink" title="登陆"></a>登陆</h3><p>通过默认用户密码登陆系统<br><img src="http://static.nsoft.vip/18-12-28/46437989.jpg" alt=""></p><h3 id="容器管理"><a href="#容器管理" class="headerlink" title="容器管理"></a>容器管理</h3><p>从容器列表看shipyard还是能支持swarm的<br><img src="http://static.nsoft.vip/18-12-28/60897773.jpg" alt=""><br>容器的部署，填空题好费劲<br><img src="http://static.nsoft.vip/18-12-28/17896281.jpg" alt=""></p><h3 id="容器详情"><a href="#容器详情" class="headerlink" title="容器详情"></a>容器详情</h3><p><img src="http://static.nsoft.vip/18-12-28/32259239.jpg" alt=""></p><h3 id="镜像管理"><a href="#镜像管理" class="headerlink" title="镜像管理"></a>镜像管理</h3><p><img src="http://static.nsoft.vip/18-12-28/24284176.jpg" alt=""></p><h3 id="安裝节点"><a href="#安裝节点" class="headerlink" title="安裝节点"></a>安裝节点</h3><p>在节点主机上执行如下命令，添加</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -sSL https://raw.githubusercontent.com/shipyard/shipyard-project.com/master/site/themes/shipyard/static/deploy | ACTION=node DISCOVERY=etcd://192.168.48.244:4001 bash -s</span><br></pre></td></tr></tbody></table></figure><p>执行完如上命令，我在shipyard图形化管理-&gt;节点管理中 并未显示添加的节点，不知道什么原因。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>通过如上的使用测试，所以还凑合用吧，作者有心无力已停更，所以这个虽然能用，但是如果Docker后续更新了啥这个可能就没法支持了。</p><p><a href="https://github.com/yaonew/docker-training/tree/master/docker-shipyard" target="_blank" rel="noopener">shipyard-deploy</a></p><h2 id="cAdvisor入门"><a href="#cAdvisor入门" class="headerlink" title="cAdvisor入门"></a>cAdvisor入门</h2><p>cAdvisor 是 google 开发的容器监控工具，我们来看看 cAdvisor 功能。</p><p>运行 cAdvisor 容器</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ docker run \</span><br><span class="line">  --volume=/:/rootfs:ro \</span><br><span class="line">  --volume=/var/run:/var/run:rw \</span><br><span class="line">  --volume=/sys:/sys:ro \</span><br><span class="line">  --volume=/var/lib/docker/:/var/lib/docker:ro \</span><br><span class="line">  --publish=8080:8080 \</span><br><span class="line">  --detach=<span class="literal">true</span> \</span><br><span class="line">  --name=cadvisor \</span><br><span class="line">  google/cadvisor:latest</span><br></pre></td></tr></tbody></table></figure><p>cAdvisor 会显示当前 host 的资源使用情况，包括 CPU、内存、网络、文件系统等。<br>打开速度有点慢<br><img src="http://static.nsoft.vip/18-12-28/48754836.jpg" alt=""><br>点击docker Containers查看运行中的容器列表<br><img src="http://static.nsoft.vip/18-12-28/54849351.jpg" alt=""><br><img src="http://static.nsoft.vip/18-12-28/4125356.jpg" alt=""><br>点击容器连接，可以对当前容器详情进行监控<br><img src="http://static.nsoft.vip/18-12-28/43595564.jpg" alt=""><br><img src="http://static.nsoft.vip/18-12-28/59387056.jpg" alt=""><br>cAdvisor 提供的操作界面略显简陋，而且需要在不同页面之间跳转，打开页面速度稍慢，并且只能监控一个 host，它的一大亮点是它可以将监控到的数据导出给第三方工具如Prometheus，后续继续研究。</p><h2 id="Portainer"><a href="#Portainer" class="headerlink" title="Portainer"></a>Portainer</h2><p>Portainer是一个开源、轻量级Docker管理用户界面，基于Docker API，提供状态显示面板、应用模板快速部署、容器镜像网络数据卷的基本操作（包括上传下载镜像，创建容器等操作）、事件日志显示、容器控制台操作、Swarm集群和服务等集中管理和操作、登录用户管理和控制等功能。功能十分全面，基本能满足中小型企业对容器管理的全部需求。</p><h3 id="单机管理"><a href="#单机管理" class="headerlink" title="单机管理"></a>单机管理</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume create portainer_data</span><br><span class="line">$ docker run -d -p 9000:9000 --name portainer-test -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer</span><br></pre></td></tr></tbody></table></figure><p>执行完成浏览器访问，第一次访问设置管理员密码并登陆<br><img src="http://static.nsoft.vip/18-12-28/80544833.jpg" alt=""><br>选择本地local<br><img src="http://static.nsoft.vip/18-12-28/42469317.jpg" alt=""><br>确定登陆系统后可以对本地主机上的docker容器、镜像、网络进行管理<br><img src="http://static.nsoft.vip/18-12-28/40088382.jpg" alt=""><br>本地主机docker维护<br><img src="http://static.nsoft.vip/18-12-28/42543395.jpg" alt=""></p><h3 id="集群管理"><a href="#集群管理" class="headerlink" title="集群管理"></a>集群管理</h3><p>基于之前我们创建的<a href="https://nsoft.vip/2018/12/05/181205-Docker%E4%B9%8B%E6%97%85-Docker%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%AE%A1%E7%90%86%E5%92%8C%E7%9B%91%E6%8E%A7/" target="_blank" rel="noopener">swarm集群</a>，我们可以很方便的将Portainer指挥艇部署在swarm集群上,并对集群进行管理，为避免之前单机测试挂载目录对下面示例的影响（导致新建的portainer无法登陆），我们先删除上面创建的挂载</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker volume rm portainer_data</span><br></pre></td></tr></tbody></table></figure><p>通过stack创建服务，下载官方yaml文件，并执行</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -L https://downloads.portainer.io/portainer-agent-stack.yml -o portainer-agent-stack.yml</span><br><span class="line">$ docker stack deploy --compose-file=portainer-agent-stack.yml portainer</span><br></pre></td></tr></tbody></table></figure><p>浏览器访问宿主机，如上第一次设置管理员密码并登陆<br><img src="http://static.nsoft.vip/18-12-28/43785463.jpg" alt=""></p><p>对swarm集群主机stack,service,containers进行管理<br><img src="http://static.nsoft.vip/18-12-28/24793369.jpg" alt=""><br><img src="http://static.nsoft.vip/18-12-28/40396286.jpg" alt=""><br><img src="http://static.nsoft.vip/18-12-28/75464079.jpg" alt=""></p><p>swarm详情<br><img src="http://static.nsoft.vip/18-12-28/11767215.jpg" alt=""><br><img src="http://static.nsoft.vip/18-12-28/46750005.jpg" alt=""></p><p>以上实例以ubuntu18.04主机为例测试，window等其他平台安装使用参见<a href="https://www.portainer.io/installation/" target="_blank" rel="noopener">官网文档</a><br>官方演示网址：<a href="http://demo.portainer.io" target="_blank" rel="noopener">http://demo.portainer.io</a> 账号admin 密码 tryportainer</p><p><a href="https://github.com/yaonew/docker-training" target="_blank" rel="noopener">GitHub源码</a></p><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://www.portainer.io/" target="_blank" rel="noopener">https://www.portainer.io/</a><br><a href="http://dockone.io/article/1686" target="_blank" rel="noopener">http://dockone.io/article/1686</a><br><a href="https://portainer.readthedocs.io/" target="_blank" rel="noopener">https://portainer.readthedocs.io/</a><br><a href="https://www.fengerzh.com/portainer/" target="_blank" rel="noopener">https://www.fengerzh.com/portainer/</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://static.nsoft.vip/18-12-5/24521079.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="微服务" scheme="https://crazyrico.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="docker" scheme="https://crazyrico.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/docker/"/>
    
    
      <category term="微服务" scheme="https://crazyrico.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="docker" scheme="https://crazyrico.com/tags/docker/"/>
    
      <category term="DockerUI" scheme="https://crazyrico.com/tags/DockerUI/"/>
    
      <category term="Shipyard" scheme="https://crazyrico.com/tags/Shipyard/"/>
    
      <category term="cAdvisor" scheme="https://crazyrico.com/tags/cAdvisor/"/>
    
      <category term="Portainer" scheme="https://crazyrico.com/tags/Portainer/"/>
    
  </entry>
  
  <entry>
    <title>Docker之旅-Docker图形化管理和监控(一)</title>
    <link href="https://crazyrico.com/posts/2018/12/05/7ae19a85.html"/>
    <id>https://crazyrico.com/posts/2018/12/05/7ae19a85.html</id>
    <published>2018-12-05T01:42:50.000Z</published>
    <updated>2019-10-16T08:06:47.678Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://static.nsoft.vip/18-12-5/24521079.jpg" alt=""></p><a id="more"></a><h2 id="Docker管理之官方三剑客"><a href="#Docker管理之官方三剑客" class="headerlink" title="Docker管理之官方三剑客"></a>Docker管理之官方三剑客</h2><h3 id="Docker-Machine"><a href="#Docker-Machine" class="headerlink" title="Docker Machine"></a>Docker Machine</h3><p>Docker Machine 是 Docker 官方提供的一个工具，它可以帮助我们在远程的机器上安装 Docker，或者在虚拟机 host 上直接安装虚拟机并在虚拟机中安装 Docker。我们还可以通过 docker-machine 命令来管理这些虚拟机和 Docker。</p><ul><li>以前你需要登录主机，按照主机及操作系统特有的安装以及配置步骤安装Docker，使其能运行Docker容器。</li><li>现在DockerMachine的产生简化了这一过程，让你可以使用一条命令在你的计算机，公有云平台以及私有数据中心创建及管理Docker主机。</li></ul><h4 id="安装Docker-Machine"><a href="#安装Docker-Machine" class="headerlink" title="安装Docker Machine"></a>安装Docker Machine</h4><p>在macOS和Windows上，Machine会随着<a href="https://docs.docker.com/docker-for-mac/install/" target="_blank" rel="noopener">Docker for Mac</a>, <a href="https://docs.docker.com/docker-for-windows/install/" target="_blank" rel="noopener">Docker for Windows</a>, 或 <a href="https://docs.docker.com/toolbox/overview/" target="_blank" rel="noopener">Docker Toolbox</a>一起安装.</p><h5 id="独立安装Docker-Machine"><a href="#独立安装Docker-Machine" class="headerlink" title="独立安装Docker Machine"></a>独立安装Docker Machine</h5><p>这里以ubuntu 18.04为例，其他系统安装参见官方文档<a href="https://docs.docker.com/machine/overview/" target="_blank" rel="noopener">Docker Machine</a></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># base=https://github.com/docker/machine/releases/download/v0.16.0 &amp;&amp;</span></span><br><span class="line">  curl -L <span class="variable">$base</span>/docker-machine-$(uname -s)-$(uname -m) &gt;/tmp/docker-machine &amp;&amp;</span><br><span class="line">  sudo install /tmp/docker-machine /usr/<span class="built_in">local</span>/bin/docker-machine</span><br></pre></td></tr></tbody></table></figure><p>查看 Machine version：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker-machine version</span></span><br><span class="line">docker-machine version 0.16.0, build 702c267f</span><br></pre></td></tr></tbody></table></figure><h5 id="在远程主机上安装-Docker"><a href="#在远程主机上安装-Docker" class="headerlink" title="在远程主机上安装 Docker"></a>在远程主机上安装 Docker</h5><p>在使用 docker-machine 进行远程安装前我们需要做一些前提准备工作：</p><h6 id="在目标主机上启用root或创建具有sudo权限的普通用户"><a href="#在目标主机上启用root或创建具有sudo权限的普通用户" class="headerlink" title="在目标主机上启用root或创建具有sudo权限的普通用户"></a>在目标主机上启用root或创建具有sudo权限的普通用户</h6><p>启用root ssh 登陆</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#允许root ssh登录</span></span><br><span class="line">$ sudo -i</span><br><span class="line">$ sed -i -e <span class="string">"s/PermitRootLogin without-password/PermitRootLogin yes/g"</span> /etc/ssh/sshd_config</span><br><span class="line"><span class="comment">#重启SSH</span></span><br><span class="line">$ service ssh restart</span><br><span class="line"><span class="comment">#按提示设置root用户密码</span></span><br><span class="line">$ passwd root</span><br></pre></td></tr></tbody></table></figure><p>或者创建一个具有sudo权限的普通用户,这里以创建一个用户为例</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo adduser worker1</span><br><span class="line">$ sudo usermod -a -G sudo worker1</span><br></pre></td></tr></tbody></table></figure><h6 id="配置用户ssh免密登录"><a href="#配置用户ssh免密登录" class="headerlink" title="配置用户ssh免密登录"></a>配置用户ssh免密登录</h6><p>启用visiblepw</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo visudo</span><br><span class="line"><span class="comment">#在文件前添加</span></span><br><span class="line">Defaults   visiblepw</span><br><span class="line"><span class="comment">#按Ctrl+O保存 Ctrl+X退出</span></span><br></pre></td></tr></tbody></table></figure><p>编辑nopasswdsudo</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/sudoers.d/nopasswdsudo</span><br><span class="line">在文件中添加</span><br><span class="line">worker1 ALL=(ALL) NOPASSWD : ALL</span><br></pre></td></tr></tbody></table></figure><h6 id="把本地用户的-ssh-public-key-添加到目标主机上"><a href="#把本地用户的-ssh-public-key-添加到目标主机上" class="headerlink" title="把本地用户的 ssh public key 添加到目标主机上"></a>把本地用户的 ssh public key 添加到目标主机上</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-copy-id -i ~/.ssh/id_rsa.pub worker1@192.168.48.202</span><br><span class="line"><span class="comment"># 若用户下未生成过key,使用如下命令生成后再执行上条命令</span></span><br><span class="line">$  ssh-keygen</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Created directory <span class="string">'/root/.ssh'</span>.</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:xW6kJVWFItg6Lirdi7G1Jte8+lD3FaA/7BSedCICKt0 root@ubuntu</span><br><span class="line">The key<span class="string">'s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">|    .  o  o..o.  |</span></span><br><span class="line"><span class="string">| . o .. o+...    |</span></span><br><span class="line"><span class="string">|. o E ..+.O.o    |</span></span><br><span class="line"><span class="string">| .    o. &amp; = .   |</span></span><br><span class="line"><span class="string">|     ...S X .    |</span></span><br><span class="line"><span class="string">|    .... = o     |</span></span><br><span class="line"><span class="string">| ..oo+    o      |</span></span><br><span class="line"><span class="string">|. +=+oo          |</span></span><br><span class="line"><span class="string">| .o+++o.         |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br></pre></td></tr></tbody></table></figure><h6 id="在本地主机执行安装命令"><a href="#在本地主机执行安装命令" class="headerlink" title="在本地主机执行安装命令"></a>在本地主机执行安装命令</h6><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine create -d generic \</span><br><span class="line">    --generic-ip-address=192.168.48.202 \</span><br><span class="line">    --generic-ssh-user=worker1 \</span><br><span class="line">    --generic-ssh-key ~/.ssh/id_rsa \</span><br><span class="line">    machine-worker1</span><br><span class="line">Running pre-create checks...</span><br><span class="line">Creating machine...</span><br><span class="line">(machine-worker1) Importing SSH key...</span><br><span class="line">Waiting <span class="keyword">for</span> machine to be running, this may take a few minutes...</span><br><span class="line">Detecting operating system of created instance...</span><br><span class="line">Waiting <span class="keyword">for</span> SSH to be available...</span><br><span class="line">Detecting the provisioner...</span><br><span class="line">Provisioning with ubuntu(systemd)...</span><br><span class="line">Installing Docker...</span><br><span class="line">Copying certs to the <span class="built_in">local</span> machine directory...</span><br><span class="line">Copying certs to the remote machine...</span><br><span class="line">Setting Docker configuration on the remote daemon...</span><br><span class="line">Checking connection to Docker...</span><br><span class="line">Docker is up and running!</span><br><span class="line">To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker-machine env machine-worker1</span><br></pre></td></tr></tbody></table></figure><p>create 命令创建虚拟主机并安装 Docker<br>-d –driver 的简写形式，主要用来指定使用什么驱动程序来创建目标主机<br>另外支持的驱动详见:<a href="https://docs.docker.com/machine/drivers/" target="_blank" rel="noopener">Machine drivers</a><br>本例中使用 generic 下面以 –generic 开头的三个参数主要是指定操作的目标主机和使用的账户<br>machine-worker1 参数是虚拟机的名称</p><p>检查安装结果</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine ls</span><br><span class="line">NAME              ACTIVE   DRIVER    STATE     URL                         SWARM   DOCKER     ERRORS</span><br><span class="line">machine-worker1   -        generic   Running   tcp://192.168.48.202:2376           v18.09.0</span><br></pre></td></tr></tbody></table></figure><p>使用本地的客户端连接远程的服务器</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">eval</span> $( docker-machine env machine-worker1)</span><br></pre></td></tr></tbody></table></figure><p>这样就可以愉快的在本地管理远端的docker了<br>另外docker-machine支持的命令如下：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Commands:</span><br><span class="line">  active                Print <span class="built_in">which</span> machine is active</span><br><span class="line">  config                Print the connection config <span class="keyword">for</span> machine</span><br><span class="line">  create                Create a machine</span><br><span class="line">  env                   Display the commands to <span class="built_in">set</span> up the environment <span class="keyword">for</span> the Docker client</span><br><span class="line">  inspect               Inspect information about a machine</span><br><span class="line">  ip                    Get the IP address of a machine</span><br><span class="line">  <span class="built_in">kill</span>                  Kill a machine</span><br><span class="line">  ls                    List machines</span><br><span class="line">  provision             Re-provision existing machines</span><br><span class="line">  regenerate-certs      Regenerate TLS Certificates <span class="keyword">for</span> a machine</span><br><span class="line">  restart               Restart a machine</span><br><span class="line">  rm                    Remove a machine</span><br><span class="line">  ssh                   Log into or run a <span class="built_in">command</span> on a machine with SSH.</span><br><span class="line">  scp                   Copy files between machines</span><br><span class="line">  mount                 Mount or unmount a directory from a machine with SSHFS.</span><br><span class="line">  start                 Start a machine</span><br><span class="line">  status                Get the status of a machine</span><br><span class="line">  stop                  Stop a machine</span><br><span class="line">  upgrade               Upgrade a machine to the latest version of Docker</span><br><span class="line">  url                   Get the URL of a machine</span><br><span class="line">  version               Show the Docker Machine version or a machine docker version</span><br><span class="line">  <span class="built_in">help</span>                  Shows a list of commands or <span class="built_in">help</span> <span class="keyword">for</span> one <span class="built_in">command</span></span><br></pre></td></tr></tbody></table></figure><p> 对于远程管理来说，SSH 的支持是必不可少的！Docker Machine 当然也尽职尽责的完成了任务：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine ssh machine-worker1</span><br></pre></td></tr></tbody></table></figure><p>执行上面的命令，瞬间穿越至目标主机，双击666</p><h3 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h3><p>Docker Compose 是 Docker 官方编排（Orchestration）项目之一，负责快速在集群中部署分布式应用。<br>实际项目中我们不可能就一个docker容器走天下，正常都是要多个容器合作完成任务，如果我们一个一个容器去启动，势必很麻烦头大，docker-compose 可以解决我们的问题，下面简单实例以springboot服务+mysql数据库服务<br>项目结构如下，</p><ul><li>demo 是我们的springboot web工程</li><li>mysql目录，可以加一下针对mysql的配置</li><li>docker-compose.yaml 猪脚，描述如何构建整个服务<br><img src="http://static.nsoft.vip/18-12-21/53100783.jpg" alt=""></li></ul><h4 id="docker-compose-yaml-配置文件"><a href="#docker-compose-yaml-配置文件" class="headerlink" title="docker-compose.yaml 配置文件"></a>docker-compose.yaml 配置文件</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">'3'</span></span><br><span class="line">services:</span><br><span class="line">  mysql:</span><br><span class="line">   container_name: demo-mysql</span><br><span class="line">   image: mysql/mysql-server:5.7</span><br><span class="line">   volumes:  </span><br><span class="line">      - ./mysql/data:/var/lib/mysql</span><br><span class="line">   environment:</span><br><span class="line">    MYSQL_DATABASE: demo</span><br><span class="line">    MYSQL_ROOT_PASSWORD: root</span><br><span class="line">    MYSQL_ROOT_HOST: <span class="string">'%'</span></span><br><span class="line">   ports:</span><br><span class="line">   - <span class="string">"3306:3306"</span></span><br><span class="line">   restart: always</span><br><span class="line">    </span><br><span class="line">  demo:</span><br><span class="line">    restart: always</span><br><span class="line">    build: ./demo</span><br><span class="line">    working_dir: /demo</span><br><span class="line">    volumes:</span><br><span class="line">      - /etc/localtime:/etc/localtime:ro</span><br><span class="line">      - ./demo:/demo</span><br><span class="line">      - ~/.m2:/root/.m2</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">"8080:8080"</span></span><br><span class="line">    depends_on:</span><br><span class="line">      - mysql</span><br><span class="line">    <span class="built_in">command</span>: mvn clean spring-boot:run -Dspring-boot.run.profiles=docker</span><br></pre></td></tr></tbody></table></figure><ul><li>version: ‘3’： 表示使用第三代语法来构建 docker-compose.yaml 文件。</li><li>services: 用来表示 compose 需要启动的服务，我们可以看出此文件中有2个服务分别为：mysql、demo。</li><li>container_name: 容器名称</li><li>environment: 此节点下的信息会当作环境变量传入容器，此示例中 mysql 服务配置了数据库、密码和权限信息。</li><li>ports: 表示对外开放的端口</li><li>restart: always 表示如果服务启动不成功会一直尝试。</li><li>volumes: 加载本地目录下的配置文件到容器目标地址下</li><li>depends_on：可以配置依赖服务，表示需要先启动 depends_on 下面的服务后，再启动本服务。</li><li>command: mvn clean spring-boot:run -Dspring-boot.run.profiles=docker: 表示以这个命令来启动项目，-Dspring-boot.run.profiles=docker表示使用 application-docker.properties文件配置信息进行启动。</li></ul><h4 id="Spring-Boot-项目配置"><a href="#Spring-Boot-项目配置" class="headerlink" title="Spring Boot 项目配置"></a>Spring Boot 项目配置</h4><p>在demo 目录下也就是和pom.xm文件同级添加Dockerfile文件，文件内容如下：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FROM maven:3.5-jdk-8</span><br></pre></td></tr></tbody></table></figure><p>只要这一句，依赖于基础镜像maven3.5和jdk1.8。<br>因为在docker-compose.yaml文件设置了项目启动命令，这里不需要再添加启动命令</p><p>application-docker.properties 添加针对于docker的配置：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</span><br><span class="line">spring.datasource.url=jdbc:mysql://mysql:3306/demo?useUnicode=<span class="literal">true</span>&amp;characterEncoding=utf8&amp;serverTimezone=GMT%2B8</span><br><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=root</span><br></pre></td></tr></tbody></table></figure><h4 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h4><p>以下命令在docker-compose.yaml 同级目录执行<br>启动服务： </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up --build</span><br></pre></td></tr></tbody></table></figure><p><img src="http://static.nsoft.vip/18-12-21/43057608.jpg" alt=""><br>停止服务: </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down</span><br></pre></td></tr></tbody></table></figure><p><img src="http://static.nsoft.vip/18-12-21/55843374.jpg" alt=""><br>查看项目中目前的所有容器</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose ps</span><br></pre></td></tr></tbody></table></figure><p><img src="http://static.nsoft.vip/18-12-21/76050008.jpg" alt=""><br>就是这么简单。</p><p><a href="https://github.com/yaonew/docker-training/tree/master/docker-compose" target="_blank" rel="noopener">项目GitHub源码</a></p><h3 id="Docker-Swarm"><a href="#Docker-Swarm" class="headerlink" title="Docker Swarm"></a>Docker Swarm</h3><p>Swarm是Docker官方提供的一款集群管理工具，其主要作用是把若干台Docker主机抽象为一个整体，并且通过一个入口统一管理这些Docker主机上的各种Docker资源。Swarm和Kubernetes比较类似，但是更加轻，具有的功能也较kubernetes更少一些。Docker Swarm 和 Docker Compose 一样，都是 Docker 官方容器编排项目，但不同的是，Docker Compose 是一个在单个服务器或主机上创建多个容器的工具，而 Docker Swarm 则可以在多个服务器或主机上创建容器集群服务，对于微服务的部署，显然 Docker Swarm 会更加适合。</p><h4 id="Docker-Swarm的获取"><a href="#Docker-Swarm的获取" class="headerlink" title="Docker Swarm的获取"></a>Docker Swarm的获取</h4><p>从Docker(1.12版本以后) swarm 已整体集成在Docker Engine中，这里我们只讨论新版本中docker swarm的使用</p><h4 id="创建一个Swarm的集群"><a href="#创建一个Swarm的集群" class="headerlink" title="创建一个Swarm的集群"></a>创建一个Swarm的集群</h4><p>详细参数参见官方文档<a href="https://docs.docker.com/engine/reference/commandline/swarm_init/#options" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/swarm_init/#options</a>，</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm init [OPTIONS]</span><br></pre></td></tr></tbody></table></figure><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ docker swarm init --listen-addr 0.0.0.0:2377 --advertise-addr 192.168.48.244</span><br><span class="line">Swarm initialized: current node (unegtfborf8ldmn41h89rttzf) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following <span class="built_in">command</span>:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-2j9t0uf0a442hks10f4l4bp9fz01j5wkr81twl3mgjyl6fuvva-5i1itkmhe4tehzbqhas4wztns 192.168.48.244:2377</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run <span class="string">'docker swarm join-token manager'</span> and follow the instructions.</span><br></pre></td></tr></tbody></table></figure><p>–listen-addr 指出的是这个集群暴露给外界调用的HTTPAPI的socket地址<br>–advertise-addr 标志配置了管理节点的 IP 地址。如果你的机器只有一张网卡，可以省略。</p><h4 id="Swarm的集群管理"><a href="#Swarm的集群管理" class="headerlink" title="Swarm的集群管理"></a>Swarm的集群管理</h4><h5 id="向Swarm的集群中添加节点"><a href="#向Swarm的集群中添加节点" class="headerlink" title="向Swarm的集群中添加节点"></a>向Swarm的集群中添加节点</h5><p>分别在第二台、第三台主机上执行以上生成的 docker swarm join –token命令</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 输出添加一个worker节点命令</span></span><br><span class="line">$ docker swarm join-token worker</span><br><span class="line">To add a worker to this swarm, run the following <span class="built_in">command</span>:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-2j9t0uf0a442hks10f4l4bp9fz01j5wkr81twl3mgjyl6fuvva-5i1itkmhe4tehzbqhas4wztns 192.168.48.244:2377</span><br><span class="line"><span class="comment"># 输出添加一个manager节点命令</span></span><br><span class="line">$ docker swarm join-token manager</span><br><span class="line">To add a manager to this swarm, run the following <span class="built_in">command</span>:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1-2j9t0uf0a442hks10f4l4bp9fz01j5wkr81twl3mgjyl6fuvva-0f54w8ra5ldg27b8yjwe4kg9r 192.168.48.244:2377</span><br></pre></td></tr></tbody></table></figure><p>为了不用登陆到每台主机中去执行docker swarm join –token命令，这样太麻烦，我们可以结合上面的docker-machine 命令使用，通过docker-machine create添加两台远程主机</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine ls</span><br><span class="line">NAME              ACTIVE   DRIVER    STATE     URL                         SWARM   DOCKER     ERRORS</span><br><span class="line">machine-worker1   -        generic   Running   tcp://192.168.48.202:2376           v18.09.0   </span><br><span class="line">machine-worker2   -        generic   Running   tcp://192.168.48.203:2376           v18.09.0</span><br></pre></td></tr></tbody></table></figure><p>分别将machine-worker1，machine-worker2 作为一个节点添加到swarm集群，执行如下命令</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$  docker-machine ssh machine-worker1 <span class="string">"sudo docker swarm join --token SWMTKN-1-2j9t0uf0a442hks10f4l4bp9fz01j5wkr81twl3mgjyl6fuvva-5i1itkmhe4tehzbqhas4wztns 192.168.48.244:2377"</span></span><br><span class="line">This node joined a swarm as a worker.</span><br><span class="line">$  docker-machine ssh machine-worker2 <span class="string">"sudo docker swarm join --token SWMTKN-1-2j9t0uf0a442hks10f4l4bp9fz01j5wkr81twl3mgjyl6fuvva-5i1itkmhe4tehzbqhas4wztns 192.168.48.244:2377"</span></span><br><span class="line">This node joined a swarm as a worker.</span><br></pre></td></tr></tbody></table></figure><p>无需登录远程主机，这样两个节点就添加进swarm集群了，查看下当前swarm集群中的节点</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$  docker node ls</span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class="line">53bbepypujpr5qi5zzspre7el *   master              Ready               Active              Leader              18.09.0</span><br><span class="line">bifyoaqegffgcmooulu749co5     worker1             Ready               Active                                  18.09.0</span><br><span class="line">d94ktuzewdxl9nkszbibilj24     worker2             Ready               Active                                  18.09.0</span><br></pre></td></tr></tbody></table></figure><p>这样我们就得到了一个由三个节点组成的小集群，manager本身也自动作为worker一员加入集群</p><h5 id="节点更新"><a href="#节点更新" class="headerlink" title="节点更新"></a>节点更新</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker node update --availability drain worker2</span><br><span class="line">worker2</span><br></pre></td></tr></tbody></table></figure><p>可以手动将某个节点的可用性设置为Drain或者active，比如这里将名为worker2的节点设置为drain了之后，可以看到在docker node ls 中出现的新信息</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ docker node ls</span><br><span class="line">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS      ENGINE VERSION</span><br><span class="line">53bbepypujpr5qi5zzspre7el *   master              Ready               Active              Leader              18.09.0</span><br><span class="line">bifyoaqegffgcmooulu749co5     worker1             Ready               Active                                  18.09.0</span><br><span class="line">d94ktuzewdxl9nkszbibilj24     worker2             Ready               Drain                                   18.09.0</span><br></pre></td></tr></tbody></table></figure><h5 id="删除节点"><a href="#删除节点" class="headerlink" title="删除节点"></a>删除节点</h5><p>执行命令 docker swarm leave –force<br>这里我们将worker2节点从swarm 集群中移除：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine ssh machine-worker2 <span class="string">"sudo docker swarm leave --force"</span> </span><br><span class="line">Node left the swarm.</span><br></pre></td></tr></tbody></table></figure><h4 id="构建服务"><a href="#构建服务" class="headerlink" title="构建服务"></a>构建服务</h4><p>在swarm集群中，管理节点是集群中唯一可以执行命令的机器，或授权其他机器作为manager加入群集,worker只是在那里提供服务能力，并且没有权力告诉任何其他机器它能做什么和不能做什么，为了构建下面的集群服务，我们再次执行上面的添加节点操作把worker2节点添加进集群。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ docker-machine ssh machine-worker2 <span class="string">"sudo docker swarm join --token SWMTKN-1-2j9t0uf0a442hks10f4l4bp9fz01j5wkr81twl3mgjyl6fuvva-5i1itkmhe4tehzbqhas4wztns 192.168.48.244:2377"</span></span><br><span class="line">This node joined a swarm as a worker.</span><br></pre></td></tr></tbody></table></figure><p>在管理节点执行构建服务命令：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ docker service create -p 4000:80 --replicas 5 --name helloswarm yaonew/hellowpy:v1</span><br><span class="line">image yaonew/hellowpy:v1 could not be accessed on a registry to record</span><br><span class="line">its digest. Each node will access yaonew/hellowpy:v1 independently,</span><br><span class="line">possibly leading to different nodes running different</span><br><span class="line">versions of the image.</span><br><span class="line"></span><br><span class="line">h926sud2306kg0lirv0dcydwy</span><br><span class="line">overall progress: 5 out of 5 tasks </span><br><span class="line">1/5: running   [==================================================&gt;] </span><br><span class="line">2/5: running   [==================================================&gt;] </span><br><span class="line">3/5: running   [==================================================&gt;] </span><br><span class="line">4/5: running   [==================================================&gt;] </span><br><span class="line">5/5: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged</span><br></pre></td></tr></tbody></table></figure><p>docker service create 命令创建服务<br>-p 端口映射，将容器80端口映射到宿主机4000端口上<br>–name 标志将服务命名为helloswarm<br>–replicas 标志指定了期望状态为 5 个运行示例<br>yaonew/hellowpy:v1 镜像 这里使用了自己构建的镜像</p><h5 id="查看服务列表"><a href="#查看服务列表" class="headerlink" title="查看服务列表"></a>查看服务列表</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker service ls</span><br><span class="line">ID                  NAME                MODE                REPLICAS            IMAGE                PORTS</span><br><span class="line">h926sud2306k        helloswarm          replicated          5/5                 yaonew/hellowpy:v1</span><br></pre></td></tr></tbody></table></figure><h5 id="查看服务详情"><a href="#查看服务详情" class="headerlink" title="查看服务详情"></a>查看服务详情</h5><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ docker service ps helloswarm </span><br><span class="line">ID                  NAME                IMAGE                NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS</span><br><span class="line">kderyu36u33v        helloswarm.1        yaonew/hellowpy:v1   worker2             Running             Running 15 minutes ago                       </span><br><span class="line">quly9g70410v        helloswarm.2        yaonew/hellowpy:v1   master              Running             Running 15 minutes ago                       </span><br><span class="line">frzcgbjkogia        helloswarm.3        yaonew/hellowpy:v1   worker2             Running             Running 15 minutes ago                       </span><br><span class="line">jr7xux73fpmo        helloswarm.4        yaonew/hellowpy:v1   master              Running             Running 15 minutes ago                       </span><br><span class="line">xpqar72dplms        helloswarm.5        yaonew/hellowpy:v1   worker1             Running             Running 15 minutes ago   </span><br><span class="line">``` </span><br><span class="line">可以看到swarm集群根据算法将期望运行的5个实例分别运行在master、worker1、worker2上，通过浏览器访问http://192.168.48.244:4000 可以看出swarm自动为我们做了负载均衡，每个请求，以循环方式选择5个实例中的一个来响应。</span><br><span class="line"></span><br><span class="line"><span class="comment">##### 伸缩服务</span></span><br><span class="line">``` bash</span><br><span class="line">$ docker service scale helloswarm=10</span><br></pre></td></tr></tbody></table></figure><p>通过以上命令可以迅速将helloswarm服务提升至10个实例，之前已经启动的5个实例不受影响，将新构建5个实例，查看服务详情。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ docker service ps helloswarm </span><br><span class="line">ID                  NAME                IMAGE                NODE                DESIRED STATE       CURRENT STATE            ERROR               PORTS</span><br><span class="line">vhyxlovgvjdj        helloswarm.1        yaonew/hellowpy:v1   worker1             Running             Running 9 minutes ago                        </span><br><span class="line">my8fv4gf5pxg        helloswarm.2        yaonew/hellowpy:v1   worker2             Running             Running 9 minutes ago                        </span><br><span class="line">x8p9nuqpmz0p        helloswarm.3        yaonew/hellowpy:v1   master              Running             Running 9 minutes ago                        </span><br><span class="line">zlx5o9m7jyyf        helloswarm.4        yaonew/hellowpy:v1   worker1             Running             Running 9 minutes ago                        </span><br><span class="line">4rbcagnwqn4t        helloswarm.5        yaonew/hellowpy:v1   worker2             Running             Running 9 minutes ago                        </span><br><span class="line">tv4x55ihaq7q        helloswarm.6        yaonew/hellowpy:v1   master              Running             Running 24 seconds ago                       </span><br><span class="line">wvr1dys8psg0        helloswarm.7        yaonew/hellowpy:v1   master              Running             Running 22 seconds ago                       </span><br><span class="line">u7uz9lq8l2cd        helloswarm.8        yaonew/hellowpy:v1   master              Running             Running 23 seconds ago                       </span><br><span class="line">xyt77whcy911        helloswarm.9        yaonew/hellowpy:v1   worker2             Running             Running 30 seconds ago                       </span><br><span class="line">ldi0b1atvzz2        helloswarm.10       yaonew/hellowpy:v1   worker1             Running             Running 30 seconds ago</span><br></pre></td></tr></tbody></table></figure><h4 id="删除swarm上的服务"><a href="#删除swarm上的服务" class="headerlink" title="删除swarm上的服务"></a>删除swarm上的服务</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker service rm helloswarm</span><br></pre></td></tr></tbody></table></figure><h4 id="通过YAML文件构建服务"><a href="#通过YAML文件构建服务" class="headerlink" title="通过YAML文件构建服务"></a>通过YAML文件构建服务</h4><p>YAML文件，用于定义Docker容器在生产中的行为方式，yaonew/hellowpy:v1 我们自己的镜像，请确保已推送到远程仓库，下面新建docker-compose.yml文件</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">version: <span class="string">"3"</span></span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    <span class="comment"># replace username/repo:tag with your name and image details</span></span><br><span class="line">    image: yaonew/hellowpy:v1</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: 5</span><br><span class="line">      resources:</span><br><span class="line">        limits:</span><br><span class="line">          cpus: <span class="string">"0.1"</span></span><br><span class="line">          memory: 50M</span><br><span class="line">      restart_policy:</span><br><span class="line">        condition: on-failure</span><br><span class="line">    ports:</span><br><span class="line">      - <span class="string">"4000:80"</span></span><br><span class="line">    networks:</span><br><span class="line">      - webnet</span><br><span class="line">networks:</span><br><span class="line">  webnet:</span><br></pre></td></tr></tbody></table></figure><p>这个docker-compose.yml文件告诉Docker执行以下操作：<br>从注册中心中提取镜像。<br>以此镜像运行5个实例作为一个服务，服务名为web，限制每个实例使用最多10％的CPU（所有核心）和50MB的RAM。<br>如果如果容器出错，立即重启。<br>将主机上的端口4000映射到Web的端口80。<br>指示Web容器通过称为webnet的负载平衡网络共享端口80。<br>默认使用Webnet网络（负载平衡网络）。</p><p>通过yaml文件省去了在命令行添加太多参数的烦恼，运行服务</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ docker stack deploy -c docker-compose.yml helloswarm</span><br><span class="line">Creating network helloswarm_webnet</span><br><span class="line">Creating service helloswarm_web</span><br></pre></td></tr></tbody></table></figure><p>这里创建了一个网络名称为：helloswarm_webnet 创建了一个服务名称：helloswarm_web<br>查看服务详情</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker service ps helloswarm_web </span><br><span class="line">ID                  NAME                IMAGE                NODE                DESIRED STATE       CURRENT STATE                    ERROR               PORTS</span><br><span class="line">v3tzalw6trzg        helloswarm_web.1      yaonew/hellowpy:v1   worker2             Running             Starting 8 seconds ago                               </span><br><span class="line">xa37injkdiov        helloswarm_web.2      yaonew/hellowpy:v1   master              Running             Starting 4 seconds ago                               </span><br><span class="line">y81yo07gzsl7        helloswarm_web.3      yaonew/hellowpy:v1   worker1             Running             Running less than a second ago                       </span><br><span class="line">2ujbxosbiu2z        helloswarm_web.4      yaonew/hellowpy:v1   worker2             Running             Starting 8 seconds ago                               </span><br><span class="line">1fa0jsr09v5i        helloswarm_web.5      yaonew/hellowpy:v1   master              Running             Starting 4 seconds ago</span><br></pre></td></tr></tbody></table></figure><p>查看容器信息</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 各主机查看启动容器id</span></span><br><span class="line">$ docker container ls -q</span><br><span class="line"><span class="comment"># 查看所有容器</span></span><br><span class="line">$ docker ps -a</span><br></pre></td></tr></tbody></table></figure><p>扩展应用<br>我们可以通过更改docker-compose.yml文件，并重新运行docker stack deploy命令来扩展应用程序：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker stack deploy -c docker-compose.yml helloswarm</span><br><span class="line">Updating service helloswarm_web (id: xa3th1y6lwz45ca3c0dpgu872)</span><br><span class="line">image yaonew/hellowpy:v1 could not be accessed on a registry to record</span><br><span class="line">its digest. Each node will access yaonew/hellowpy:v1 independently,</span><br><span class="line">possibly leading to different nodes running different</span><br><span class="line">versions of the image.</span><br></pre></td></tr></tbody></table></figure><p>Docker执行就地更新，无需杀死任何容器。<br>现在，重新运行docker container ls -q以查看已重新配置的已部署实例。 如果增加实例数量，则会启动更多任务，从而启动更多容器。</p><p>清理退出</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker stack rm helloswarm </span><br><span class="line">Removing service helloswarm_web</span><br><span class="line">Removing network helloswarm_webnet</span><br></pre></td></tr></tbody></table></figure><p><a href="https://github.com/yaonew/docker-training/tree/master/docker-swarm" target="_blank" rel="noopener">项目GitHub源码</a></p><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://docs.docker.com/machine/overview/" target="_blank" rel="noopener">https://docs.docker.com/machine/overview/</a><br><a href="http://blog.51cto.com/hashlinux/1772507" target="_blank" rel="noopener">http://blog.51cto.com/hashlinux/1772507</a><br><a href="https://www.cnblogs.com/sparkdev/p/7044950.html" target="_blank" rel="noopener">https://www.cnblogs.com/sparkdev/p/7044950.html</a><br><a href="https://docs.docker.com/compose/overview/" target="_blank" rel="noopener">https://docs.docker.com/compose/overview/</a><br><a href="https://docs.docker.com/engine/reference/commandline/swarm/" target="_blank" rel="noopener">https://docs.docker.com/engine/reference/commandline/swarm/</a><br><a href="https://www.cnblogs.com/franknihao/p/8490416.html" target="_blank" rel="noopener">https://www.cnblogs.com/franknihao/p/8490416.html</a><br><a href="https://blog.csdn.net/u011936655/article/details/81147315" target="_blank" rel="noopener">https://blog.csdn.net/u011936655/article/details/81147315</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://static.nsoft.vip/18-12-5/24521079.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="微服务" scheme="https://crazyrico.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="docker" scheme="https://crazyrico.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/docker/"/>
    
    
      <category term="微服务" scheme="https://crazyrico.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="docker" scheme="https://crazyrico.com/tags/docker/"/>
    
      <category term="Shipyard" scheme="https://crazyrico.com/tags/Shipyard/"/>
    
      <category term="cAdvisor" scheme="https://crazyrico.com/tags/cAdvisor/"/>
    
      <category term="Portainer" scheme="https://crazyrico.com/tags/Portainer/"/>
    
  </entry>
  
  <entry>
    <title>Git常用命令备忘录</title>
    <link href="https://crazyrico.com/posts/2018/11/29/56ad66f2.html"/>
    <id>https://crazyrico.com/posts/2018/11/29/56ad66f2.html</id>
    <published>2018-11-29T05:33:02.000Z</published>
    <updated>2019-10-16T08:06:47.650Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://static.nsoft.vip/18-12-5/95855229.jpg" alt=""></p><a id="more"></a><h2 id="备忘教程"><a href="#备忘教程" class="headerlink" title="备忘教程"></a>备忘教程</h2><p><a href="https://learngitbranching.js.org/" title="学习Git教程" target="_blank" rel="noopener">learngitbranching.js.org</a>. </p><h2 id="克隆远程仓库项目"><a href="#克隆远程仓库项目" class="headerlink" title="克隆远程仓库项目"></a>克隆远程仓库项目</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://gitee.com/marspie/git-training.git</span><br></pre></td></tr></tbody></table></figure><h2 id="修改提交"><a href="#修改提交" class="headerlink" title="修改提交"></a>修改提交</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> git-training</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">"test"</span> &gt;&gt; a.txt</span><br><span class="line">$ git add .</span><br><span class="line">$ git commit -m <span class="string">"test commit"</span></span><br><span class="line">$ git push -u origin master</span><br><span class="line">Enumerating objects: 4, <span class="keyword">done</span>.</span><br><span class="line">Counting objects: 100% (4/4), <span class="keyword">done</span>.</span><br><span class="line">Delta compression using up to 4 threads</span><br><span class="line">Compressing objects: 100% (2/2), <span class="keyword">done</span>.</span><br><span class="line">Writing objects: 100% (3/3), 274 bytes | 137.00 KiB/s, <span class="keyword">done</span>.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: Powered by Gitee.com</span><br><span class="line">To https://gitee.com/marspie/git-training.git</span><br><span class="line">   83f8711..f49cd75  master -&gt; master</span><br><span class="line">Branch <span class="string">'master'</span> <span class="built_in">set</span> up to track remote branch <span class="string">'master'</span> from <span class="string">'origin'</span>.</span><br></pre></td></tr></tbody></table></figure><h2 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h2><h3 id="查看当前分支信息"><a href="#查看当前分支信息" class="headerlink" title="查看当前分支信息"></a>查看当前分支信息</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ git branch</span><br><span class="line">* master</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Your branch is up to date with <span class="string">'origin/master'</span>.</span><br><span class="line"></span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></tbody></table></figure><h3 id="创建远程分支"><a href="#创建远程分支" class="headerlink" title="创建远程分支"></a>创建远程分支</h3><p>1、新建本地分支</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -b dev</span><br><span class="line">Switched to a new branch <span class="string">'dev'</span></span><br><span class="line"></span><br><span class="line">$ git branch</span><br><span class="line">* dev</span><br><span class="line">  master</span><br></pre></td></tr></tbody></table></figure><p>星号(*)表示当前所在分支。现在的状态是成功创建的新的分支并且已经切换到新分支上。</p><p>2、把新建的本地分支push到远程服务器，远程分支与本地分支同名（当然可以随意起名）</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin dev:dev</span><br><span class="line">Total 0 (delta 0), reused 0 (delta 0)</span><br><span class="line">remote: Powered by Gitee.com</span><br><span class="line">To https://gitee.com/marspie/git-training.git</span><br><span class="line"> * [new branch]      dev -&gt; dev</span><br></pre></td></tr></tbody></table></figure><p>3、查看所有分支</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -a</span><br></pre></td></tr></tbody></table></figure><p>4、切换分支</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br></pre></td></tr></tbody></table></figure><h3 id="删除远程分支"><a href="#删除远程分支" class="headerlink" title="删除远程分支"></a>删除远程分支</h3><p>1、推送一个空分支到远程分支，其实就相当于删除远程分支：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin :dev</span><br></pre></td></tr></tbody></table></figure><p>2、也可以使用</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin --delete dev</span><br><span class="line">remote: Powered by Gitee.com</span><br><span class="line">To https://gitee.com/marspie/git-training.git</span><br><span class="line"> - [deleted]         dev</span><br></pre></td></tr></tbody></table></figure><h3 id="删除本地分支"><a href="#删除本地分支" class="headerlink" title="删除本地分支"></a>删除本地分支</h3><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git branch -d dev</span><br><span class="line">Deleted branch dev (was f49cd75).</span><br></pre></td></tr></tbody></table></figure><h3 id="分支合并"><a href="#分支合并" class="headerlink" title="分支合并"></a>分支合并</h3><p>dev分支的工作成果合并到master分支上</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git merge dev</span><br><span class="line">Updating f49cd75..b7c3423</span><br><span class="line">Fast-forward</span><br><span class="line"> dev.txt | Bin 0 -&gt; 12 bytes</span><br><span class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 dev.txt</span><br></pre></td></tr></tbody></table></figure><h2 id="Git回退"><a href="#Git回退" class="headerlink" title="Git回退"></a>Git回退</h2><p>查看 git 日志</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> -3</span><br><span class="line">commit b9efa3bb30dfe635e40f42ec6a45ada0e06b4712 (HEAD -&gt; dev2)</span><br><span class="line">Author: yaonew &lt;yaonew@126.com&gt;</span><br><span class="line">Date:   Thu Nov 29 14:33:25 2018 +0800</span><br><span class="line"></span><br><span class="line">    dev2 modify</span><br><span class="line"></span><br><span class="line">commit a262f949bbd3fe881e6c5ecdc5c0bb2735b0d8c7 (origin/dev2)</span><br><span class="line">Author: yaonew &lt;yaonew@126.com&gt;</span><br><span class="line">Date:   Thu Nov 29 14:31:01 2018 +0800</span><br><span class="line"></span><br><span class="line">    dev2 commit</span><br><span class="line"></span><br><span class="line">commit b7c342333b482ea3f3b9c3b0231d26fd322ec326 (origin/dev, dev)</span><br><span class="line">Author: yaonew &lt;yaonew@126.com&gt;</span><br><span class="line">Date:   Thu Nov 29 14:19:07 2018 +0800</span><br><span class="line"></span><br><span class="line">    dev branch</span><br></pre></td></tr></tbody></table></figure><p>回退到指定版本</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard a262f949bbd3fe881e6c5ecdc5</span><br></pre></td></tr></tbody></table></figure><p>强制提交</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push -f origin dev2</span><br></pre></td></tr></tbody></table></figure><p>参考<br><a href="https://blog.csdn.net/yeputi1015/article/details/80571204" target="_blank" rel="noopener">https://blog.csdn.net/yeputi1015/article/details/80571204</a><br><a href="https://www.cnblogs.com/wancy86/p/5848024.html" target="_blank" rel="noopener">https://www.cnblogs.com/wancy86/p/5848024.html</a><br><a href="https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/001375840038939c291467cc7c747b1810aab2fb8863508000" target="_blank" rel="noopener">https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/001375840038939c291467cc7c747b1810aab2fb8863508000</a><br><a href="https://www.cnblogs.com/wangmingshun/p/5425150.html" target="_blank" rel="noopener">https://www.cnblogs.com/wangmingshun/p/5425150.html</a></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://static.nsoft.vip/18-12-5/95855229.jpg&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="协作" scheme="https://crazyrico.com/categories/%E5%8D%8F%E4%BD%9C/"/>
    
      <category term="git" scheme="https://crazyrico.com/categories/%E5%8D%8F%E4%BD%9C/git/"/>
    
    
      <category term="git" scheme="https://crazyrico.com/tags/git/"/>
    
      <category term="命令" scheme="https://crazyrico.com/tags/%E5%91%BD%E4%BB%A4/"/>
    
  </entry>
  
  <entry>
    <title>一台电脑多个github账号设置</title>
    <link href="https://crazyrico.com/posts/2018/07/21/5709f0c4.html"/>
    <id>https://crazyrico.com/posts/2018/07/21/5709f0c4.html</id>
    <published>2018-07-21T14:16:37.000Z</published>
    <updated>2019-10-16T08:06:47.644Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://static.nsoft.vip/18-7-23/47063187.jpg" alt=""><br>如何在一台电脑上使用多个github账号，由于之前已经配置过一个github账号，最近又注册了了一个账号，显然现在多账号的问题出现在自己面前，于是就扒了下多账号的设置。希望对遇到同样问题的你有一点帮助。</p><a id="more"></a><h3 id="生成多个SSH-Key"><a href="#生成多个SSH-Key" class="headerlink" title="生成多个SSH Key"></a>生成多个SSH Key</h3><p>进入用户家目录Windows 使用Git Bash, Linux 打开terminal. 各系统对应的目录位置如下：<br>Windows目录: C:\Users\用户名.ssh<br>Linux\Mac目录：~/.ssh  </p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C email</span><br></pre></td></tr></tbody></table></figure><p>输入如上命令，email 替换成需要生成key的邮箱回车，由于是多账号，我们需要修改默认的id_rsa 文件的名称，这里我们加上后缀，标实不同的github账号，输入密码部分可以留空或输入，若输入密码后续git push到远程仓库时均需输入此处设置的密码,方便起见我们使用ssh-agent（详见下文），回车若看到如下图所示，表示生成ssh key 成功了，重复如上操作生成多个ssh key。<br><img src="http://static.nsoft.vip/18-7-23/41537601.jpg" alt=""><br>进入用户家目录下的.ssh文件目录下，可以看到我们生成的多组key, id_rsa id_rsa.pub分别对应私钥与公钥<br><img src="http://static.nsoft.vip/18-7-23/55749639.jpg" alt=""></p><h3 id="配置Config文件"><a href="#配置Config文件" class="headerlink" title="配置Config文件"></a>配置Config文件</h3><p>为了让git知道我们用哪个账号提交，这里需要配置config文件，在当前家目录 .ssh文件夹下新建config文件，配置如下内容：</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 配置github1</span><br><span class="line">Host yaonew.com                 # 自定义的host简称</span><br><span class="line">    HostName github.com         # 主机名可用ip也可以是域名</span><br><span class="line">    IdentityFile C:\\Users\\peeka\\.ssh\\id_rsa_yaonew   # 证书文件路径</span><br><span class="line"># 认证方式 可以设为 publickey,password publickey,keyboard-interactive</span><br><span class="line">    PreferredAuthentications publickey </span><br><span class="line">    User git                    # 登录用户名</span><br><span class="line"></span><br><span class="line"># 配置github2</span><br><span class="line">Host marspie.com </span><br><span class="line">    HostName github.com</span><br><span class="line">    IdentityFile C:\\Users\\peeka\\.ssh\\id_rsa_marspie</span><br><span class="line">    PreferredAuthentications publickey</span><br><span class="line">    User git</span><br></pre></td></tr></tbody></table></figure><p>配置完以上信息后，git clone的链接应修改为如下:</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 原始clone 地址</span><br><span class="line">git@github.com:yaonew/test1.git</span><br><span class="line">git@github.com:marspie/test2.git</span><br><span class="line"></span><br><span class="line"># 新clone地址</span><br><span class="line">git@yaonew.com:yaonew/test1.git</span><br><span class="line">git@marspie.com:marspie/test2.git</span><br></pre></td></tr></tbody></table></figure><h3 id="登陆Github添加公钥"><a href="#登陆Github添加公钥" class="headerlink" title="登陆Github添加公钥"></a>登陆Github添加公钥</h3><p>分别登陆两个github账号，进入Settings –&gt; SSH and GPG keys，拷贝~/.ssh 下.pub公钥文件内容添加至github<br><img src="http://static.nsoft.vip/18-7-23/16798650.jpg" alt=""><br><img src="http://static.nsoft.vip/18-7-23/80424136.jpg" alt=""></p><h3 id="SSH连接测试"><a href="#SSH连接测试" class="headerlink" title="SSH连接测试"></a>SSH连接测试</h3><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br><span class="line">ssh -T git@marspie.com</span><br></pre></td></tr></tbody></table></figure><p><img src="http://static.nsoft.vip/18-7-23/80089082.jpg" alt=""><br>当看到如上信息时测试成功，同时远端github的钥匙已变成绿色<br><img src="http://static.nsoft.vip/18-7-23/28875863.jpg" alt=""></p><h3 id="本地git设置"><a href="#本地git设置" class="headerlink" title="本地git设置"></a>本地git设置</h3><p>这样设置过就OK了吗，显然不行，由于之前使用过一个github账号，并设置了全局git账号，这里需要移除</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 原有全局账号设置</span><br><span class="line">git config --golbal user.name "name"</span><br><span class="line">git config --golbal user.email "xxx@qq.com"</span><br><span class="line"></span><br><span class="line">#全局配置账户、邮箱已经移除</span><br><span class="line">git config --global --unset user.name</span><br><span class="line">git config --global --unset user.email</span><br><span class="line"></span><br><span class="line">#查看全局用户名、全局邮箱</span><br><span class="line">git config --global user.name</span><br><span class="line">git config --global user.email</span><br></pre></td></tr></tbody></table></figure><p>然后在具体的工程目录下设置用户及邮箱</p><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config user.name yaonew</span><br><span class="line">git config user.email yaonew@126.com</span><br></pre></td></tr></tbody></table></figure><p>分别做相应账号工程下做相应修改并提及<br><img src="http://static.nsoft.vip/18-7-23/39513143.jpg" alt=""><br><img src="http://static.nsoft.vip/18-7-23/56876011.jpg" alt=""></p><h3 id="ssh-agent"><a href="#ssh-agent" class="headerlink" title="ssh-agent"></a>ssh-agent</h3><p>因为我们生成ssh key设置了密码，每次git push 认证时都需要输入密码，显然这不是我们希望的，ssh-agent是一个密钥管理器，运行ssh-agent以后，使用<a href="http://man.linuxde.net/ssh-add" title="ssh-add命令" target="_blank" rel="noopener">ssh-add</a>将私钥交给ssh-agent保管，其他程序需要身份验证的时候可以将验证申请交给ssh-agent来完成整个认证过程。</p><h4 id="打开-ssh-agent"><a href="#打开-ssh-agent" class="headerlink" title="打开 ssh-agent"></a>打开 ssh-agent</h4><figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># github官方的bash</span><br><span class="line">ssh-agent -s</span><br><span class="line"># 其它，比如msysgit</span><br><span class="line">eval $(ssh-agent -s)</span><br></pre></td></tr></tbody></table></figure><h4 id="添加私钥"><a href="#添加私钥" class="headerlink" title="添加私钥"></a>添加私钥</h4><p>添加秘钥时输入密码后续的认证就交由ssh-agent了，直接提交丝般顺滑 ^_^</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-add ~/.ssh/id_rsa_yaonew</span><br><span class="line">ssh-add ~/.ssh/id_rsa_marspie</span><br></pre></td></tr></tbody></table></figure><p><img src="http://static.nsoft.vip/18-7-24/94460676.jpg" alt=""></p><p>愉快的多账号之旅开始了。。。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://static.nsoft.vip/18-7-23/47063187.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;如何在一台电脑上使用多个github账号，由于之前已经配置过一个github账号，最近又注册了了一个账号，显然现在多账号的问题出现在自己面前，于是就扒了下多账号的设置。希望对遇到同样问题的你有一点帮助。&lt;/p&gt;
    
    </summary>
    
      <category term="协作" scheme="https://crazyrico.com/categories/%E5%8D%8F%E4%BD%9C/"/>
    
      <category term="git" scheme="https://crazyrico.com/categories/%E5%8D%8F%E4%BD%9C/git/"/>
    
    
      <category term="Git" scheme="https://crazyrico.com/tags/Git/"/>
    
      <category term="Linux" scheme="https://crazyrico.com/tags/Linux/"/>
    
      <category term="github" scheme="https://crazyrico.com/tags/github/"/>
    
  </entry>
  
  <entry>
    <title>微服务从入门到放弃之概述</title>
    <link href="https://crazyrico.com/posts/2017/10/12/72d9617b.html"/>
    <id>https://crazyrico.com/posts/2017/10/12/72d9617b.html</id>
    <published>2017-10-12T06:32:52.000Z</published>
    <updated>2019-10-16T08:06:47.641Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>微服务真的很火，很新，很潮，很多人说到微服务都能侃侃而谈，各种新鲜的名词、概念、框架止不住地蹦出来，但是：什么时候应当实行微服务呢？实行微服务应当要注意些什么呢？，首先我们了解下新生的微服务架构与传统架构有哪些区别。<br><img src="http://static.nsoft.vip/18-11-28/15585315.jpg" alt="QQ截图20171023151415.png"></p><a id="more"></a><h2 id="传统架构"><a href="#传统架构" class="headerlink" title="传统架构"></a>传统架构</h2><h3 id="单体架构"><a href="#单体架构" class="headerlink" title="单体架构"></a>单体架构</h3><p>Web应用发展早期，大部分Web工程将所有的功能模块打包到一起后放到Web容器中运行，很多企业的Jave应用程序打包成war,ear 它们的主要特点：</p><ol><li>一个程序包包含了应用所有功能， 通常称之为单体应用。</li><li>架构单体应用的架构风格， 我们称之为单体架构， 这是一种比较传统的架构风格。</li></ol><p><img src="http://static.nsoft.vip/18-11-28/51749077.jpg" alt="单体架构.png"></p><h4 id="单体架构缺点"><a href="#单体架构缺点" class="headerlink" title="单体架构缺点"></a>单体架构缺点</h4><ul><li>复杂性逐渐变高 - 由于业务的不断修改深入，系统变得越来越庞大，复杂度越来越高。</li><li>技术债务逐渐上升 - 参与项目的人员流动，水平不同，人员往往会埋坑，问题没有得到解决，坑越来越多。</li><li>部署速度逐渐变慢 - 业务模块增多，代码量不断增多，部署启动速度相应的越来越慢。</li><li>阻碍技术创新 - 技术在发展，历史的架构选型注定了系统形态，新的模块需求依然需要使用老旧的技术。</li><li>无法按需伸缩（出现IO或CPU瓶颈时需要兼顾或妥协）</li></ul><h2 id="微服务架构"><a href="#微服务架构" class="headerlink" title="微服务架构"></a>微服务架构</h2><h3 id="微服务是什么"><a href="#微服务是什么" class="headerlink" title="微服务是什么"></a>微服务是什么</h3><p>lMartin Fowler：简而言之，微服务架构风格这种开发方法，是以开发一组小型服务的方式来开发一个独立的应用系统的。其中每个小型服务都运行在自己的进程中，并经常采用HTTP资源API这样轻量的机制来相互通信。这些服务围绕业务功能进行构建，并能通过全自动的部署机制来进行独立部署。这些微服务可以使用不同的语言来编写，并且可以使用不同的数据存储技术。对这些微服务我们仅做最低限度的集中管理。<br>来自：<a href="http://www.martinfowler.com/articles/microservices.html" target="_blank" rel="noopener">http://www.martinfowler.com/articles/microservices.html</a></p><p><img src="http://static.nsoft.vip/18-11-28/11550801.jpg" alt="微服务架构.png"></p><h3 id="微服务解决了什么"><a href="#微服务解决了什么" class="headerlink" title="微服务解决了什么"></a>微服务解决了什么</h3><h3 id="微服务特性"><a href="#微服务特性" class="headerlink" title="微服务特性"></a>微服务特性</h3><ol><li>每个微服务可独立运行在自己的进程里；</li><li>一系列独立运行的微服务共同构建起了整个系统；</li><li>每个服务为独立的业务开发，一个微服务一般完成某个特定的功能，比如：订单管理、用户管理等；</li><li>微服务之间通过一些轻量的通信机制进行通信，例如通过REST API或者RPC的方式进行调用。</li></ol><h3 id="微服务的优点"><a href="#微服务的优点" class="headerlink" title="微服务的优点"></a>微服务的优点</h3><ul><li>启动较快</li><li>局部修改容易部署</li><li>技术栈不受限</li><li>按需伸缩</li><li>DevOps </li></ul><h3 id="微服务带来的挑战"><a href="#微服务带来的挑战" class="headerlink" title="微服务带来的挑战"></a>微服务带来的挑战</h3><ul><li>边界清晰 - 软件架构开发中如何合理的划分边界，边界清晰和技术限制之间做出权衡</li><li>运维要求较高 - 服务之间相互依赖运维需要清晰的知道服务之间的依赖关系</li><li>分布式的复杂性 - 分布式系统固有的复杂性，网络问题，完整的监控，如何保持一致性，事务保障，高可用性等等 </li><li>接口调整成本高 - 一个服务接口的调整可能涉及到多服务需要同时调整</li><li>重复劳动 - 一个个微服务既然名曰”服务”，就得五脏俱全，就得螺蛳壳里做道场, 麻雀虽小五脏全该有的基础功能数据库的访问，工具类使用，IO处理，网络，各个服务里面都得处理。</li></ul><h3 id="微服务设计原则"><a href="#微服务设计原则" class="headerlink" title="微服务设计原则"></a>微服务设计原则</h3><ul><li>单一职责原则-[Single Responsible Principle] ，即每个服务只做一件事，并把这件事做好；</li><li>服务自治原则- 每个微服务需要有自己独立的开发、测试、部署、运维。</li><li>轻量级通信原则 -  通讯协议需要跨平台，跨语言，不要绑定技术栈。</li><li>接口明确原则 - 一个微服务接口的修改可能相关联的微服务也需要跟着修改，这时需要提前规划好，避免接口修改</li></ul><h2 id="总论"><a href="#总论" class="headerlink" title="总论"></a>总论</h2><p>总的来说，从传统架构到SOA再到微服务架构，微服务带来了很多全新的东西，可以解决传统架构的一些问题，但同时对系统的架构技术也提出的更高的要求，实现微服务也需要一定的前提条件，，我们不能一味的认为微服务架构好。微服务这种分开当家当然潇洒，但要知道自己当家也有自己的累。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;微服务真的很火，很新，很潮，很多人说到微服务都能侃侃而谈，各种新鲜的名词、概念、框架止不住地蹦出来，但是：什么时候应当实行微服务呢？实行微服务应当要注意些什么呢？，首先我们了解下新生的微服务架构与传统架构有哪些区别。&lt;br&gt;&lt;img src=&quot;http://static.nsoft.vip/18-11-28/15585315.jpg&quot; alt=&quot;QQ截图20171023151415.png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="微服务" scheme="https://crazyrico.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
    
      <category term="微服务" scheme="https://crazyrico.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>Docker之旅-使用阿里云Docker镜像库加速</title>
    <link href="https://crazyrico.com/posts/2017/09/15/5f246816.html"/>
    <id>https://crazyrico.com/posts/2017/09/15/5f246816.html</id>
    <published>2017-09-15T06:30:52.000Z</published>
    <updated>2019-10-16T08:06:47.638Z</updated>
    
    <content type="html"><![CDATA[<h2 id="使用阿里云Docker镜像库加速"><a href="#使用阿里云Docker镜像库加速" class="headerlink" title="使用阿里云Docker镜像库加速"></a>使用阿里云Docker镜像库加速</h2><p>官方的docker hub 访问实在太慢，国内使用阿里云<a href="https://dev.aliyun.com/search.html" target="_blank" rel="noopener">Docker镜像库</a>,可以大大加快镜像的下载速度，访问Docker镜像库开通了阿里云开发者帐号，进入管理中心，获取您的专属加速器地址。<br><img src="http://static.nsoft.vip/18-11-28/94459845.jpg" alt="阿里云开发者平台.png"></p><a id="more"></a><p>根据操作文档，选择对应您的操作系统，目前提供了Ubuntu、CentOS、Window、Mac系统的操作说明:</p><h2 id="一、Ubuntu"><a href="#一、Ubuntu" class="headerlink" title="一、Ubuntu"></a>一、Ubuntu</h2><h3 id="安装／升级你的Docker客户端"><a href="#安装／升级你的Docker客户端" class="headerlink" title="安装／升级你的Docker客户端"></a>安装／升级你的Docker客户端</h3><p>推荐安装1.10.0以上版本的Docker客户端。<br>或执行以下命令：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span><br></pre></td></tr></tbody></table></figure><h3 id="使用Docker加速器"><a href="#使用Docker加速器" class="headerlink" title="使用Docker加速器"></a>使用Docker加速器</h3><p>针对Docker客户端版本大于1.10的用户，可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">{</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://z8b39a7q.mirror.aliyuncs.com"</span>]</span><br><span class="line">}</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></tbody></table></figure><h2 id="二、CentOS"><a href="#二、CentOS" class="headerlink" title="二、CentOS"></a>二、CentOS</h2><h3 id="安装／升级你的Docker客户端-1"><a href="#安装／升级你的Docker客户端-1" class="headerlink" title="安装／升级你的Docker客户端"></a>安装／升级你的Docker客户端</h3><p>推荐安装1.10.0以上版本的Docker客户端。<br>您可以通过阿里云的镜像仓库下载：<a href="http://mirrors.aliyun.com/help/docker-ce?spm=a2c1q.8351553.0.0.26abf789oI02QT" target="_blank" rel="noopener">docker-ce</a><br>或执行以下命令：</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span><br><span class="line">``` </span><br><span class="line"><span class="comment">### 如何使用Docker加速器</span></span><br><span class="line">针对Docker客户端版本大于1.10的用户</span><br><span class="line">您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器：</span><br><span class="line">``` bash</span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">'EOF'</span></span><br><span class="line">{</span><br><span class="line">  <span class="string">"registry-mirrors"</span>: [<span class="string">"https://z8b39a7q.mirror.aliyuncs.com"</span>]</span><br><span class="line">}</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="comment">## 三、Window</span></span><br><span class="line"><span class="comment">### 安装／升级你的Docker客户端</span></span><br><span class="line">    1. 对于Windows 10以下的用户 推荐使用 Docker Toolbox</span><br><span class="line">        Toolbox的介绍和帮助：mirrors.aliyun.com/<span class="built_in">help</span>/docker-toolbox</span><br><span class="line">        Windows系统的安装文件目录：http://mirrors.aliyun.com/docker-toolbox/windows/docker-toolbox/</span><br><span class="line">    2. 对于Windows 10以上的用户 推荐使用 Docker <span class="keyword">for</span> Windows</span><br><span class="line">        Windows系统的安装文件目录：http://mirrors.aliyun.com/docker-toolbox/windows/docker-for-windows/</span><br><span class="line"><span class="comment">### 如何使用Docker加速器</span></span><br><span class="line">1. 创建一台安装有Docker环境的Linux虚拟机，指定机器名称为default，同时配置Docker加速器地址。</span><br><span class="line">``` bash</span><br><span class="line">docker-machine create --engine-registry-mirror=https://z8b39a7q.mirror.aliyuncs.com -d virtualbox default</span><br><span class="line">``` </span><br><span class="line">2. 查看机器的环境配置，并配置到本地，并通过Docker客户端访问Docker服务。</span><br><span class="line">``` bash</span><br><span class="line">docker-machine env default</span><br><span class="line"><span class="built_in">eval</span> <span class="string">"<span class="variable">$(docker-machine env default)</span>"</span></span><br><span class="line">docker info</span><br></pre></td></tr></tbody></table></figure><h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><ol><li><p>Docker for Windows 和 Docker Toolbox是不兼容，如果同时安装两者的话，需要使用hyperv的参数启动。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-machine create --engine-registry-mirror=https://z8b39a7q.mirror.aliyuncs.com -d hyperv default</span><br></pre></td></tr></tbody></table></figure></li><li><p>Docker for Windows 有两种运行模式，一种运行Windows相关容器，一种运行传统的Linux容器。同一时间只能选择一种模式运行。</p></li></ol><h2 id="四、Mac"><a href="#四、Mac" class="headerlink" title="四、Mac"></a>四、Mac</h2><h3 id="安装／升级你的Docker客户端-2"><a href="#安装／升级你的Docker客户端-2" class="headerlink" title="安装／升级你的Docker客户端"></a>安装／升级你的Docker客户端</h3><pre><code>1. 对于10.10.3以下的用户 推荐使用 Docker Toolbox    Toolbox的介绍和帮助：mirrors.aliyun.com/help/docker-toolbox    Mac系统的安装文件目录：http://mirrors.aliyun.com/docker-toolbox/mac/docker-toolbox/2. 对于10.10.3以上的用户 推荐使用 Docker for Mac    Mac系统的安装文件目录：http://mirrors.aliyun.com/docker-toolbox/mac/docker-for-mac/</code></pre><h3 id="如何使用Docker加速器"><a href="#如何使用Docker加速器" class="headerlink" title="如何使用Docker加速器"></a>如何使用Docker加速器</h3><ol><li>创建一台安装有Docker环境的Linux虚拟机，指定机器名称为default，同时配置Docker加速器地址。<pre><code class="bash">docker-machine create --engine-registry-mirror=https://z8b39a7q.mirror.aliyuncs.com -d virtualbox default</code></pre></li><li>查看机器的环境配置，并配置到本地，并通过Docker客户端访问Docker服务。<pre><code class="bash">docker-machine env default<span class="built_in">eval</span> <span class="string">"<span class="variable">$(docker-machine env default)</span>"</span>docker info</code></pre></li></ol><p><strong>设置完成，接着我们再试下pull一个镜像，是不是有种飞起来的赶脚O(∩_∩)O~</strong></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;使用阿里云Docker镜像库加速&quot;&gt;&lt;a href=&quot;#使用阿里云Docker镜像库加速&quot; class=&quot;headerlink&quot; title=&quot;使用阿里云Docker镜像库加速&quot;&gt;&lt;/a&gt;使用阿里云Docker镜像库加速&lt;/h2&gt;&lt;p&gt;官方的docker hub 访问实在太慢，国内使用阿里云&lt;a href=&quot;https://dev.aliyun.com/search.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Docker镜像库&lt;/a&gt;,可以大大加快镜像的下载速度，访问Docker镜像库开通了阿里云开发者帐号，进入管理中心，获取您的专属加速器地址。&lt;br&gt;&lt;img src=&quot;http://static.nsoft.vip/18-11-28/94459845.jpg&quot; alt=&quot;阿里云开发者平台.png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="微服务" scheme="https://crazyrico.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="docker" scheme="https://crazyrico.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/docker/"/>
    
    
      <category term="微服务" scheme="https://crazyrico.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="docker" scheme="https://crazyrico.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker之旅-Docker互联</title>
    <link href="https://crazyrico.com/posts/2017/09/11/e9e07340.html"/>
    <id>https://crazyrico.com/posts/2017/09/11/e9e07340.html</id>
    <published>2017-09-11T06:29:43.000Z</published>
    <updated>2019-10-16T08:06:47.635Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Docker的互联方式"><a href="#Docker的互联方式" class="headerlink" title="Docker的互联方式"></a>Docker的互联方式</h2><ul><li>基于Volume的互联</li><li>基于Link的互联</li><li>基于网络的互联</li></ul><a id="more"></a><h2 id="基于Volume的互联"><a href="#基于Volume的互联" class="headerlink" title="基于Volume的互联"></a>基于Volume的互联</h2><p>在docker run 启动一个容器的时候，我们可以通过设置 -v 参数将宿主机目录映射到容器目录，这样容器对映射路径下数据的修改即使在容器被删除的情况下，数据还能够保留。<br><img src="http://static.nsoft.vip/18-11-28/50640757.jpg" alt="run_docker_with_v.png"><br>进入learn目录，在此目录下创建 一个文件夹<br><img src="http://static.nsoft.vip/18-11-28/35404330.jpg" alt="run_docker_with_v2.png"><br>查看容器详情，在Mounts 节点我们可以看到/learn 目录对应的宿主机目录，进入：/var/lib/docker/volumes/858c12a2fed04733b27256ae57a1f76455e9f0030182ad405bf5fd5aa049c54d/_data<br>docker inspect 4bc0f1e4a005<br><img src="http://static.nsoft.vip/18-11-28/5039599.jpg" alt="run_docker_with_v3.png"><br>查看宿主机的目录，我们可以发现我们在容器中创建的 testvolume 文件夹目录<br><img src="http://static.nsoft.vip/18-11-28/84724374.jpg" alt="run_docker_with_v4.png"><br>可以多个容器中的Volume指向宿主机的同一个目录，实现基于文件的的共享访问<br><img src="http://static.nsoft.vip/18-11-28/26996813.jpg" alt="run_docker_with_v5.png"><br><img src="http://static.nsoft.vip/18-11-28/61031998.jpg" alt="run_docker_with_v6.png"><br>基于容器数据的的单主机互联<br><img src="http://static.nsoft.vip/18-11-28/7551785.jpg" alt="run_docker_with_v7.png"></p><h2 id="基于Link的互联"><a href="#基于Link的互联" class="headerlink" title="基于Link的互联"></a>基于Link的互联</h2><p>启用一个mysql docker 容器</p><pre><code class="bash">docker run --rm=<span class="literal">true</span> --name=marspiedb -e MYSQL_ROOT_PASSWORD=123456 mysql</code></pre><p><img src="http://static.nsoft.vip/18-11-28/46517357.jpg" alt="run_docker_link1.png"><br>查看我们创建的marspiedb 详细信息</p><pre><code class="bash"><span class="comment"># docker inspect marspiedb</span></code></pre><p><img src="http://static.nsoft.vip/18-11-28/49657221.jpg" alt="run_docker_link2.png"><br>Docker默认允许container互通，通过-icc=false关闭互通。一旦关闭了互通，只能通过-link name:alias命令连接指定container.<br><img src="http://static.nsoft.vip/18-11-28/48657048.jpg" alt="run_docker_link3.png"><br>– link redis:db的别名，会在/etc/hosts中生成对应的ip映射<br><img src="http://static.nsoft.vip/18-11-28/28455858.jpg" alt="run_docker_link4.png"><br>Link跨主机的互联,使用 Docker远程代理（Ambassador）模式，<a href="https://github.com/gliderlabs/connectable" target="_blank" rel="noopener">https://github.com/gliderlabs/connectable</a><br>socat是一个多功能的网络工具，名字来由是”Socket CAT”</p><h2 id="基于网络的互联"><a href="#基于网络的互联" class="headerlink" title="基于网络的互联"></a>基于网络的互联</h2><ol><li>最常用的方式端口映射，将docker端口映射到宿主机，直接通过宿主机IP：映射端口 访问<pre><code class="bash">docker run --rm=<span class="literal">true</span> --name=marspiedb -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql</code></pre></li><li>直接使用宿主机网络<pre><code class="bash">docker run --rm=<span class="literal">true</span> --net=host --name=marspiedb -e MYSQL_ROOT_PASSWORD=123456 mysql</code></pre></li><li>容器共用一个IP地址<pre><code class="bash">docker run --rm=<span class="literal">true</span> --name=marspiedb -e MYSQL_ROOT_PASSWORD=123456 mysqldocker run --rm=<span class="literal">true</span> --net=container:marspiedb java ip addr</code></pre><img src="http://static.nsoft.vip/18-11-28/73127528.jpg" alt="run_docker_net1.png"><br>同一个IP 使用localhost 就可以很愉快的访问(⊙o⊙)哦<br><img src="http://static.nsoft.vip/18-11-28/84566791.jpg" alt="run_docker_net2.png"></li></ol><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Docker的互联方式&quot;&gt;&lt;a href=&quot;#Docker的互联方式&quot; class=&quot;headerlink&quot; title=&quot;Docker的互联方式&quot;&gt;&lt;/a&gt;Docker的互联方式&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;基于Volume的互联&lt;/li&gt;
&lt;li&gt;基于Link的互联&lt;/li&gt;
&lt;li&gt;基于网络的互联&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
      <category term="微服务" scheme="https://crazyrico.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="docker" scheme="https://crazyrico.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/docker/"/>
    
    
      <category term="微服务" scheme="https://crazyrico.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="docker" scheme="https://crazyrico.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>Docker之旅-Docker镜像制作</title>
    <link href="https://crazyrico.com/posts/2017/07/25/ca2aee57.html"/>
    <id>https://crazyrico.com/posts/2017/07/25/ca2aee57.html</id>
    <published>2017-07-25T06:28:09.000Z</published>
    <updated>2019-10-16T08:06:47.628Z</updated>
    
    <content type="html"><![CDATA[<h2 id="制作自己的Docker镜像"><a href="#制作自己的Docker镜像" class="headerlink" title="制作自己的Docker镜像"></a>制作自己的Docker镜像</h2><p>制作自己的Docker镜像有两种方式</p><ol><li>将容器变成镜像</li><li>通过Buildfile语法制作镜像</li></ol><a id="more"></a><h3 id="将容器变成镜像"><a href="#将容器变成镜像" class="headerlink" title="将容器变成镜像"></a>将容器变成镜像</h3><p>首先我们先从docker镜像仓库拉取一个tomcat镜像，切换到root账号</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker search tomcat</span></span><br><span class="line">NAME                           DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">tomcat                         Apache Tomcat is an open <span class="built_in">source</span> implementa...   1419      [OK]       </span><br><span class="line">tomee                          Apache TomEE is an all-Apache Java EE cert...   38        [OK]       </span><br><span class="line">dordoka/tomcat                 Ubuntu 14.04, Oracle JDK 8 and Tomcat 8 ba...   37                   [OK]</span><br><span class="line">davidcaste/alpine-tomcat       Apache Tomcat 7/8 using Oracle Java 7/8 wi...   19                   [OK]</span><br><span class="line">consol/tomcat-7.0              Tomcat 7.0.57, 8080, <span class="string">"admin/admin"</span>              16                   [OK]</span><br><span class="line">cloudesire/tomcat              Tomcat server, 6/7/8                            15                   [OK]</span><br><span class="line">....</span><br></pre></td></tr></tbody></table></figure><p>这里会列出镜像仓库 中一堆的tomcat相关的镜像资源，下面我们拉取一个到本地。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker pull dordoka/tomcat</span></span><br><span class="line">//等待一段时间拉取完成</span><br><span class="line"><span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">dordoka/tomcat      latest              7d9888a99efb        7 months ago        780 MB</span><br></pre></td></tr></tbody></table></figure><p>启动容器</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker run -it -p 8080:8080 dordoka/tomcat</span></span><br><span class="line">//查看所有容器</span><br><span class="line"><span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                              NAMES</span><br><span class="line">9a987406fc9e        dordoka/tomcat      <span class="string">"/opt/tomcat/bin/c..."</span>   2 minutes ago       Up About a minute   8009/tcp, 0.0.0.0:8080-&gt;8080/tcp   flamboyant_darwin</span><br><span class="line">// 下面我们进入容器，做一些修改</span><br><span class="line"><span class="comment"># docker exec -it 9a987406fc9e /bin/bash</span></span><br><span class="line">root@9a987406fc9e:/opt/tomcat<span class="comment"># cd webapps</span></span><br><span class="line">root@9a987406fc9e:/opt/tomcat/webapps<span class="comment"># ls</span></span><br><span class="line">host-manager  manager</span><br><span class="line">// 接下来在webapps目录下创建一个ROOT目录，并在里面新建一个index.html页面</span><br><span class="line">root@9a987406fc9e:/opt/tomcat/webapps<span class="comment"># mkdir ROOT</span></span><br><span class="line">root@9a987406fc9e:/opt/tomcat/webapps<span class="comment"># cd ROOT/</span></span><br><span class="line">root@9a987406fc9e:/opt/tomcat/webapps/ROOT<span class="comment"># touch index.html</span></span><br><span class="line">// 在Html页面写些内容，比如 Hello World!</span><br><span class="line">root@9a987406fc9e:/opt/tomcat/webapps/ROOT<span class="comment"># vi index.html </span></span><br><span class="line">// 编辑完退出 container</span><br><span class="line">root@9a987406fc9e:/opt/tomcat/webapps/ROOT<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></tbody></table></figure><p>在宿主机上通过浏览器访问 <a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a> 就能看到我们对于容器的修改。<br><img src="http://static.nsoft.vip/18-11-28/63750209.jpg" alt="docker 容器的修改.png"></p><h3 id="将我们修改好的容器制作成镜像"><a href="#将我们修改好的容器制作成镜像" class="headerlink" title="将我们修改好的容器制作成镜像"></a>将我们修改好的容器制作成镜像</h3><p>通过docker commit <container> [repo:tag] 将容器制作成镜像</container></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker commit 9a987406fc9e marspie/tomcat:1.0</span></span><br><span class="line">sha256:8887c9ac97bc3f3fc5767bf714f058035f4f89cd24162a57844140d755a505a1</span><br><span class="line">//查看本地镜像，可以看到我们制作好的marspie/tomcat 1.0版</span><br><span class="line"><span class="comment"># docker images</span></span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">marspie/tomcat      1.0                 8887c9ac97bc        49 seconds ago      780 MB</span><br><span class="line">dordoka/tomcat      latest              7d9888a99efb        7 months ago        780 MB</span><br></pre></td></tr></tbody></table></figure><p>将容器制作成镜像的做法：</p><table><tbody><tr><th>优点</th><th>缺点</th></tr><tr><td>最方便，最快速</td><td>不规范，无法自动化</td></tr></tbody></table><h3 id="Buildfile-制作镜像"><a href="#Buildfile-制作镜像" class="headerlink" title="Buildfile 制作镜像"></a>Buildfile 制作镜像</h3><p>下面我们通过Buildfile文件来制作一个jdk1.8-tomcat8的镜像。</p><ol><li><p>首先我们从Oracle官网下载: <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">jdk-8u144-linux-x64.tar.gz</a></p></li><li><p>下载Tomcat8 Apache官网下载：<a href="http://tomcat.apache.org/download-80.cgi" target="_blank" rel="noopener">apache-tomcat-8.5.16.tar.gz</a></p></li><li><p>Buildfile 文件内容如下</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># VERSION 0.0.1</span></span><br><span class="line"><span class="comment"># ubuntu server </span></span><br><span class="line">FROM ubuntu</span><br><span class="line"><span class="comment"># 签名</span></span><br><span class="line">MAINTAINER MARSPIE <span class="string">"marspie@126.com"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把java与tomcat添加到容器中   </span></span><br><span class="line">ADD jdk-8u144-linux-x64.tar.gz /usr/<span class="built_in">local</span>/</span><br><span class="line">ADD apache-tomcat-8.5.16.tar.gz /usr/<span class="built_in">local</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置java与tomcat环境变量  </span></span><br><span class="line">ENV JAVA_HOME /usr/<span class="built_in">local</span>/jdk1.8.0_144</span><br><span class="line">ENV CLASSPATH <span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"></span><br><span class="line">ENV TOMCAT_HOME /usr/<span class="built_in">local</span>/apache-tomcat-8.5.16  </span><br><span class="line">ENV PATH <span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$TOMCAT_HOME</span>/lib:<span class="variable">$TOMCAT_HOME</span>/bin  </span><br><span class="line">  </span><br><span class="line"><span class="comment"># 容器运行时监听的端口  </span></span><br><span class="line">EXPOSE 8080  </span><br><span class="line">  </span><br><span class="line">ENTRYPOINT [<span class="string">"/usr/local/apache-tomcat-8.5.16/bin/catalina.sh"</span>, <span class="string">"run"</span>]</span><br><span class="line"><span class="comment">#CMD /usr/local/apache-tomcat-8.5.16/bin/catalina.sh run</span></span><br><span class="line">``` </span><br><span class="line">4. 将如上准备的3个文件至于同一目录下</span><br><span class="line">``` bash</span><br><span class="line">[root@bogon docker]<span class="comment"># ls -l</span></span><br><span class="line">total 190372</span><br><span class="line">-rwxrw-rw-. 1 alex alex   9417469 Jul 30 18:28 apache-tomcat-8.5.16.tar.gz</span><br><span class="line">-rw-------. 1 alex alex       654 Jul 30 19:09 Dockerfile</span><br><span class="line">-rwxrw-rw-. 1 alex alex 185515842 Jul 30 18:34 jdk-8u144-linux-x64.tar.gz</span><br></pre></td></tr></tbody></table></figure></li><li><p>使用如下命令制作镜像</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon docker]<span class="comment"># docker build -t marspie/ubuntu-tomcat8:0.0.2 .</span></span><br><span class="line">Sending build context to Docker daemon 194.9 MB</span><br><span class="line">Step 1/10 : FROM ubuntu</span><br><span class="line"> ---&gt; 14f60031763d</span><br><span class="line">Step 2/10 : MAINTAINER MARSPIE <span class="string">"marspie@126.com"</span></span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 9e2681f280b5</span><br><span class="line">Step 3/10 : ADD jdk-8u144-linux-x64.tar.gz /usr/<span class="built_in">local</span>/</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; e69764710ed4</span><br><span class="line">Step 4/10 : ADD apache-tomcat-8.5.16.tar.gz /usr/<span class="built_in">local</span>/</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 9cef7a3e804b</span><br><span class="line">Step 5/10 : ENV JAVA_HOME /usr/<span class="built_in">local</span>/jdk1.8.0_144</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 54b3e6339868</span><br><span class="line">Step 6/10 : ENV CLASSPATH <span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 463ccbe97778</span><br><span class="line">Step 7/10 : ENV TOMCAT_HOME /usr/<span class="built_in">local</span>/apache-tomcat-8.5.16</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 9455c2777e34</span><br><span class="line">Step 8/10 : ENV PATH <span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$TOMCAT_HOME</span>/lib:<span class="variable">$TOMCAT_HOME</span>/bin</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 5fc99c79cfe5</span><br><span class="line">Step 9/10 : EXPOSE 8080</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 63aa2690221f</span><br><span class="line">Step 10/10 : ENTRYPOINT /usr/<span class="built_in">local</span>/apache-tomcat-8.5.16/bin/catalina.sh run</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> ef7da9894470</span><br><span class="line"> ---&gt; 55eebdf6b21d</span><br><span class="line">Removing intermediate container ef7da9894470</span><br><span class="line">Successfully built 55eebdf6b21d</span><br></pre></td></tr></tbody></table></figure></li><li><p>运行下我们制作的tomcat镜像</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker run -it -p 8080:8080 55eebdf6b21d</span></span><br></pre></td></tr></tbody></table></figure></li><li><p>测试，通过宿主机浏览器访问：<a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a> 看到tomcat的欢迎页面，好了通过Dockerfile制作镜像成功了。</p></li></ol><h3 id="Docker-镜像的导入导出"><a href="#Docker-镜像的导入导出" class="headerlink" title="Docker 镜像的导入导出"></a>Docker 镜像的导入导出</h3><p>将镜像导出为文件</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker save -o marspie-ubuntu-tomcat8.0.02.tar marspie/ubuntu-tomcat8:0.0.2</span></span><br></pre></td></tr></tbody></table></figure><p>完成后通过 ls 命令即可看到文件<br><img src="http://static.nsoft.vip/18-11-28/69873981.jpg" alt="docker_images_save.png"></p><p>将我们打包导出的镜像包上传至另一台虚机<br><img src="http://static.nsoft.vip/18-11-28/10477511.jpg" alt="docker_images_up.png"><br>镜像导入</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker load -i marspie-ubuntu-tomcat8.0.02.tar</span></span><br></pre></td></tr></tbody></table></figure><p><img src="http://static.nsoft.vip/18-11-28/58244929.jpg" alt="docker_images_load.png"><br>这样我们又可以在这台虚机愉快的玩耍了O(∩_∩)O~</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;制作自己的Docker镜像&quot;&gt;&lt;a href=&quot;#制作自己的Docker镜像&quot; class=&quot;headerlink&quot; title=&quot;制作自己的Docker镜像&quot;&gt;&lt;/a&gt;制作自己的Docker镜像&lt;/h2&gt;&lt;p&gt;制作自己的Docker镜像有两种方式&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;将容器变成镜像&lt;/li&gt;
&lt;li&gt;通过Buildfile语法制作镜像&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
      <category term="微服务" scheme="https://crazyrico.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="docker" scheme="https://crazyrico.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/docker/"/>
    
    
      <category term="微服务" scheme="https://crazyrico.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
      <category term="docker" scheme="https://crazyrico.com/tags/docker/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu 16.04 LTS RabbitMQ 3.6.10 安装配置</title>
    <link href="https://crazyrico.com/posts/2017/06/21/5c9d4761.html"/>
    <id>https://crazyrico.com/posts/2017/06/21/5c9d4761.html</id>
    <published>2017-06-21T06:27:09.000Z</published>
    <updated>2019-10-16T08:06:47.665Z</updated>
    
    <content type="html"><![CDATA[<h2 id="RabbitMQ-安装配置"><a href="#RabbitMQ-安装配置" class="headerlink" title="RabbitMQ 安装配置"></a>RabbitMQ 安装配置</h2><p><img src="http://static.nsoft.vip/18-11-28/82919675.jpg" alt="RabbitMQ_.png"><br>RabbitMQ 已经经历了10 来个春夏秋冬，全球超过35000生产部署RabbitMQ，RabbitMQ是最受欢迎的开源消息队列，<br>正如官网的介绍：</p><p>RabbitMQ is the most widely deployed open source message broker</p><p>With more than 35,000 production deployments of RabbitMQ world-wide at small startups and large enterprises, RabbitMQ is the most popular open source message broker.</p><a id="more"></a><h2 id="RabbitMQ-安装"><a href="#RabbitMQ-安装" class="headerlink" title="RabbitMQ 安装"></a>RabbitMQ 安装</h2><ol><li><p>访问<a href="http://www.rabbitmq.com/download.html" target="_blank" rel="noopener">RabbitMQ官网</a> 下载对应系统版本，这里我们下载<a href="http://www.rabbitmq.com/releases/rabbitmq-server/v3.6.10/rabbitmq-server_3.6.10-1_all.deb" target="_blank" rel="noopener">Debian Ubuntu</a> 对应的版本。</p></li><li><p>将下载的rabbitmq-server_3.6.10-1_all.deb 安装包放于用户家目录下work目录。</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">alex@ubuntu:~$ <span class="built_in">cd</span> work/</span><br><span class="line">alex@ubuntu:~/work$ ls -l</span><br><span class="line">total 4772</span><br><span class="line">-rwxrw-rw- 1 alex alex 4885200 Jun 21 01:29 rabbitmq-server_3.6.10-1_all.deb</span><br><span class="line">alex@ubuntu:~/work$</span><br></pre></td></tr></tbody></table></figure></li><li><p>使用 dpkg 命令安装 rabbitmq<br>dpkg 参见：<a href="http://blog.csdn.net/kevinhg/article/details/5934462" target="_blank" rel="noopener">Ubuntu下deb包的安装方法</a></p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">alex@ubuntu:~/work$ sudo dpkg -i rabbitmq-server_3.6.10-1_all.deb </span><br><span class="line">[sudo] password <span class="keyword">for</span> alex: </span><br><span class="line">Selecting previously unselected package rabbitmq-server.</span><br><span class="line">(Reading database ... 208585 files and directories currently installed.)</span><br><span class="line">Preparing to unpack rabbitmq-server_3.6.10-1_all.deb ...</span><br><span class="line">Unpacking rabbitmq-server (3.6.10-1) ...</span><br><span class="line">dpkg: dependency problems prevent configuration of rabbitmq-server:</span><br><span class="line"> rabbitmq-server depends on erlang-nox (&gt;= 1:16.b.3) | esl-erlang; however:</span><br><span class="line">  Package erlang-nox is not installed.</span><br><span class="line">  Package esl-erlang is not installed.</span><br><span class="line"> rabbitmq-server depends on socat; however:</span><br><span class="line">  Package socat is not installed.</span><br><span class="line"></span><br><span class="line">dpkg: error processing package rabbitmq-server (--install):</span><br><span class="line"> dependency problems - leaving unconfigured</span><br><span class="line">Processing triggers <span class="keyword">for</span> man-db (2.7.5-1) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> systemd (229-4ubuntu10) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> ureadahead (0.100.0-19) ...</span><br><span class="line">Errors were encountered <span class="keyword">while</span> processing:</span><br><span class="line"> rabbitmq-server</span><br></pre></td></tr></tbody></table></figure></li></ol><p>如上rabbitmq-server依赖于erlang-nox，下面安装输入：sudo apt-get install erlang-nox<br>but 依然报错</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">alex@ubuntu:~/work$ sudo apt-get install erlang-nox</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree       </span><br><span class="line">Reading state information... Done</span><br><span class="line">You might want to run <span class="string">'apt-get -f install'</span> to correct these:</span><br><span class="line">The following packages have unmet dependencies:</span><br><span class="line"> erlang-nox : Depends: erlang-base but it is not going to be installed or</span><br><span class="line">                       erlang-base-hipe but it is not going to be installed</span><br><span class="line">              Depends: erlang-asn1 but it is not going to be installed</span><br><span class="line">              Depends: erlang-corba but it is not going to be installed</span><br><span class="line">              Depends: erlang-crypto but it is not going to be installed</span><br><span class="line">              Depends: erlang-diameter but it is not going to be installed</span><br><span class="line">              Depends: erlang-edoc but it is not going to be installed</span><br><span class="line">              Depends: erlang-eldap but it is not going to be installed</span><br><span class="line">              Depends: erlang-erl-docgen but it is not going to be installed</span><br><span class="line">              Depends: erlang-eunit but it is not going to be installed</span><br><span class="line">              Depends: erlang-ic but it is not going to be installed</span><br><span class="line">              Depends: erlang-inets but it is not going to be installed</span><br><span class="line">              Depends: erlang-mnesia but it is not going to be installed</span><br><span class="line">              Depends: erlang-odbc but it is not going to be installed</span><br><span class="line">              Depends: erlang-os-mon but it is not going to be installed</span><br><span class="line">              Depends: erlang-parsetools but it is not going to be installed</span><br><span class="line">              Depends: erlang-percept but it is not going to be installed</span><br><span class="line">              Depends: erlang-public-key but it is not going to be installed</span><br><span class="line">              Depends: erlang-runtime-tools but it is not going to be installed</span><br><span class="line">              Depends: erlang-snmp but it is not going to be installed</span><br><span class="line">              Depends: erlang-ssh but it is not going to be installed</span><br><span class="line">              Depends: erlang-ssl but it is not going to be installed</span><br><span class="line">              Depends: erlang-syntax-tools but it is not going to be installed</span><br><span class="line">              Depends: erlang-tools but it is not going to be installed</span><br><span class="line">              Depends: erlang-webtool but it is not going to be installed</span><br><span class="line">              Depends: erlang-xmerl but it is not going to be installed</span><br><span class="line"> rabbitmq-server : Depends: socat but it is not going to be installed</span><br><span class="line">E: Unmet dependencies. Try <span class="string">'apt-get -f install'</span> with no packages (or specify a solution).</span><br></pre></td></tr></tbody></table></figure><p>根据提示，执行 apt-get -f install<br>中途提示：Do you want to continue? [Y/n]  输入 Y </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">alex@ubuntu:~/work$ sudo apt-get -f install</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree       </span><br><span class="line">Reading state information... Done</span><br><span class="line">Correcting dependencies... Done</span><br><span class="line">The following additional packages will be installed:</span><br><span class="line">  erlang-asn1 erlang-base erlang-corba erlang-crypto erlang-diameter</span><br><span class="line">  erlang-edoc erlang-eldap erlang-erl-docgen erlang-eunit erlang-ic</span><br><span class="line">  erlang-inets erlang-mnesia erlang-nox erlang-odbc erlang-os-mon</span><br><span class="line">  erlang-parsetools erlang-percept erlang-public-key erlang-runtime-tools</span><br><span class="line">  erlang-snmp erlang-ssh erlang-ssl erlang-syntax-tools erlang-tools</span><br><span class="line">  erlang-webtool erlang-xmerl libodbc1 libsctp1 socat</span><br><span class="line">Suggested packages:</span><br><span class="line">  erlang erlang-manpages erlang-doc xsltproc fop erlang-ic-java</span><br><span class="line">  erlang-observer libmyodbc odbc-postgresql tdsodbc unixodbc-bin lksctp-tools</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  erlang-asn1 erlang-base erlang-corba erlang-crypto erlang-diameter</span><br><span class="line">  erlang-edoc erlang-eldap erlang-erl-docgen erlang-eunit erlang-ic</span><br><span class="line">  erlang-inets erlang-mnesia erlang-nox erlang-odbc erlang-os-mon</span><br><span class="line">  erlang-parsetools erlang-percept erlang-public-key erlang-runtime-tools</span><br><span class="line">  erlang-snmp erlang-ssh erlang-ssl erlang-syntax-tools erlang-tools</span><br><span class="line">  erlang-webtool erlang-xmerl libodbc1 libsctp1 socat</span><br><span class="line">0 upgraded, 29 newly installed, 0 to remove and 326 not upgraded.</span><br><span class="line">1 not fully installed or removed.</span><br><span class="line">Need to get 19.6 MB of archives.</span><br><span class="line">After this operation, 36.9 MB of additional disk space will be used.</span><br><span class="line">Do you want to <span class="built_in">continue</span>? [Y/n] Y</span><br><span class="line">....</span><br><span class="line">Adding system user `rabbitmq<span class="string">' (UID 124) ...</span></span><br><span class="line"><span class="string">Adding new user `rabbitmq'</span> (UID 124) with group `rabbitmq<span class="string">' ...</span></span><br><span class="line"><span class="string">Not creating home directory `/var/lib/rabbitmq'</span>.</span><br><span class="line">Setting up libsctp1:amd64 (1.0.16+dfsg-3) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> libc-bin (2.23-0ubuntu9) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> systemd (229-4ubuntu10) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> ureadahead (0.100.0-19) ...</span><br></pre></td></tr></tbody></table></figure><p>再次输入：sudo dpkg -i rabbitmq-server_3.6.10-1_all.deb </p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">alex@ubuntu:~/work$ sudo dpkg -i rabbitmq-server_3.6.10-1_all.deb </span><br><span class="line">(Reading database ... 210659 files and directories currently installed.)</span><br><span class="line">Preparing to unpack rabbitmq-server_3.6.10-1_all.deb ...</span><br><span class="line">Unpacking rabbitmq-server (3.6.10-1) over (3.6.10-1) ...</span><br><span class="line">Setting up rabbitmq-server (3.6.10-1) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> man-db (2.7.5-1) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> systemd (229-4ubuntu10) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> ureadahead (0.100.0-19) ...</span><br></pre></td></tr></tbody></table></figure><p>显然如上结果，表示 rabbitmq-server 安装完成，启动rabbitmq-server 服务</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 启动 rabbitmq-server</span><br><span class="line">alex@ubuntu:~/work$ sudo service rabbitmq-server start</span><br><span class="line">// 停止 rabbitmq-server</span><br><span class="line">alex@ubuntu:~/work$ sudo service rabbitmq-server stop</span><br><span class="line">// 重启 rabbitmq-server</span><br><span class="line">alex@ubuntu:~/work$ sudo service rabbitmq-server restart</span><br></pre></td></tr></tbody></table></figure><ol start="4"><li>若通过终端安装程序sudo apt-get install xxx时出错：<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install erlang-nox</span><br><span class="line">E: Could not get lock /var/lib/dpkg/lock - open (11: Resource temporarily unavailable)</span><br><span class="line">E: Unable to lock the administration directory (/var/lib/dpkg/), is another process using it</span><br></pre></td></tr></tbody></table></figure></li></ol><p>通过如下强制解锁,命令</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rm /var/lib/dpkg/lock</span><br></pre></td></tr></tbody></table></figure><p>再次输入安装命令，可能会会提示 “E: dpkg 被中断，您必须手工运行 sudo dpkg –configure -a 解决此问题”<br>按照提示执行：sudo dpkg –configure -a  </p><h2 id="RabbitMQ-管理插件-management-plugin"><a href="#RabbitMQ-管理插件-management-plugin" class="headerlink" title="RabbitMQ 管理插件 management plugin"></a>RabbitMQ 管理插件 management plugin</h2><p>RabbitMQ 默认已经集成了management plugin，通过命令enable即可</p><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /usr/lib/rabbitmq/bin/</span><br><span class="line">$ sudo rabbitmq-plugins <span class="built_in">enable</span> rabbitmq_management</span><br><span class="line">The following plugins have been enabled:</span><br><span class="line">  amqp_client</span><br><span class="line">  cowlib</span><br><span class="line">  cowboy</span><br><span class="line">  rabbitmq_web_dispatch</span><br><span class="line">  rabbitmq_management_agent</span><br><span class="line">  rabbitmq_management</span><br><span class="line"></span><br><span class="line">Applying plugin configuration to rabbit@ubuntu... started 6 plugins.</span><br><span class="line">.....</span><br></pre></td></tr></tbody></table></figure><p>当显示如上信息，打开浏览器访问：<a href="http://localhost:15672" target="_blank" rel="noopener">http://localhost:15672</a><br>输入默认用户名/密码：guest/guest 登陆Web管理页：<br><img src="http://static.nsoft.vip/18-11-28/79670555.jpg" alt="RabbitMQ_Web.png"></p><p>guest用户只能从localhost地址登录，如果要配置远程登录，必须创建用户</p><ol><li>通过Web管理页面添加用户并设置权限，点击用户进入授权页面，默认直接点击”set permission”即可</li><li>通过命令添加用户,并分配权限：<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rabbitmqctl add_user admin admin</span><br><span class="line">Creating user <span class="string">"admin"</span></span><br><span class="line">$ sudo rabbitmqctl set_user_tags admin administrator</span><br><span class="line">Setting tags <span class="keyword">for</span> user <span class="string">"admin"</span> to [administrator]</span><br><span class="line">$ sudo rabbitmqctl set_permissions -p / admin <span class="string">".*"</span> <span class="string">".*"</span> <span class="string">".*"</span></span><br><span class="line">Setting permissions <span class="keyword">for</span> user <span class="string">"admin"</span> <span class="keyword">in</span> vhost <span class="string">"/"</span></span><br></pre></td></tr></tbody></table></figure></li></ol><p>设置完成后，RabbitMQ就可以远程通过 <a href="http://rabbitmq_ip:15672" target="_blank" rel="noopener">http://rabbitmq_ip:15672</a> 访问了。</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;RabbitMQ-安装配置&quot;&gt;&lt;a href=&quot;#RabbitMQ-安装配置&quot; class=&quot;headerlink&quot; title=&quot;RabbitMQ 安装配置&quot;&gt;&lt;/a&gt;RabbitMQ 安装配置&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://static.nsoft.vip/18-11-28/82919675.jpg&quot; alt=&quot;RabbitMQ_.png&quot;&gt;&lt;br&gt;RabbitMQ 已经经历了10 来个春夏秋冬，全球超过35000生产部署RabbitMQ，RabbitMQ是最受欢迎的开源消息队列，&lt;br&gt;正如官网的介绍：&lt;/p&gt;
&lt;p&gt;RabbitMQ is the most widely deployed open source message broker&lt;/p&gt;
&lt;p&gt;With more than 35,000 production deployments of RabbitMQ world-wide at small startups and large enterprises, RabbitMQ is the most popular open source message broker.&lt;/p&gt;
    
    </summary>
    
      <category term="高性能架构" scheme="https://crazyrico.com/categories/%E9%AB%98%E6%80%A7%E8%83%BD%E6%9E%B6%E6%9E%84/"/>
    
      <category term="RabbitMQ" scheme="https://crazyrico.com/categories/%E9%AB%98%E6%80%A7%E8%83%BD%E6%9E%B6%E6%9E%84/RabbitMQ/"/>
    
    
      <category term="RabbitMQ" scheme="https://crazyrico.com/tags/RabbitMQ/"/>
    
  </entry>
  
  <entry>
    <title>Error: Module version mismatch. Expected 48, got 46.</title>
    <link href="https://crazyrico.com/posts/2017/06/05/5fe01822.html"/>
    <id>https://crazyrico.com/posts/2017/06/05/5fe01822.html</id>
    <published>2017-06-05T06:25:53.000Z</published>
    <updated>2019-10-16T08:06:47.625Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> 是一个简单地、轻量地、基于Node的一个静态博客框架。 <a href="http://jaredforsyth.com/hexo-admin/" target="_blank" rel="noopener">Hexo Admin Plugin</a> 是可以为Hexo提供后台管理的插件，今天安装了一下hexo-admin的修改版：<a href="https://xbotao.github.io/hexo-admin-qiniu/" target="_blank" rel="noopener">hexo-admin-qiniu</a><br>进入之前安装的blog目录</p><a id="more"></a><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save hexo-admin-qiniu</span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">$ hexo server -d</span><br><span class="line">Error: Module version mismatch. Expected 48, got 46.</span><br><span class="line">    at Error (native)</span><br><span class="line">    at Object.Module._extensions..node (module.js:597:18)</span><br><span class="line">    at Module.load (module.js:487:32)</span><br><span class="line">    at tryModuleLoad (module.js:446:12)</span><br><span class="line">    at Function.Module._load (module.js:438:3)</span><br><span class="line">    at Module.require (module.js:497:17)</span><br><span class="line">    at require (internal/module.js:20:19)</span><br><span class="line">    at Object.&lt;anonymous&gt; (/usr/<span class="built_in">local</span>/lib/node_modules/hexo-cli/node_modules/hexo-log/node_modules/bunyan/node_modules/dtrace-provider/dtrace-provider.js:17:23)</span><br><span class="line">    at Module._compile (module.js:570:32)</span><br><span class="line">    at Object.Module._extensions..js (module.js:579:10)</span><br><span class="line">    at Module.load (module.js:487:32)</span><br><span class="line">    at tryModuleLoad (module.js:446:12)</span><br><span class="line">    at Function.Module._load (module.js:438:3)</span><br><span class="line">    at Module.require (module.js:497:17)</span><br><span class="line">    at require (internal/module.js:20:19)</span><br><span class="line">    at Object.&lt;anonymous&gt; (/usr/<span class="built_in">local</span>/lib/node_modules/hexo-cli/node_modules/hexo-log/node_modules/bunyan/lib/bunyan.js:79:18)</span><br></pre></td></tr></tbody></table></figure><p>错误提示模块的版本不匹配，可能是因为hexo版本 与很多模块更新不匹配了,尝试删除所有模块，重新安装无果</p><pre><code class="bash">$ rm -rf node_modules$ npm install</code></pre><p>所以我们重新安装配置下Hexo,解决方法：执行以下代码：</p><pre><code class="bash">$ npm install hexo --no-optional$ npm install hexo-cli -gnpm WARN checkPermissions Missing write access to /usr/<span class="built_in">local</span>/lib/node_modules/hexo-cli/node_modules/bluebirdnpm WARN checkPermissions Missing write access to /usr/<span class="built_in">local</span>/lib/node_modules/hexo-cli/node_modules/chalk/node_modules/has-ansi/node_modules/ansi-regexnpm WARN checkPermissions Missing write access to /usr/<span class="built_in">local</span>/lib/node_modules/hexo-cli/node_modules/chalk/node_modules/strip-ansi/node_modules/ansi-regexnpm WARN checkPermissions Missing write access to /usr/<span class="built_in">local</span>/lib/node_modules/hexo-cli/node_modules/hexo-fs/node_modules/chokidar/node_modules/anymatch/node_modules/micromatch/node_modules/arr-diff/node_modules/arr-flatten....npm ERR! Darwin 16.6.0npm ERR! argv <span class="string">"/usr/local/bin/node"</span> <span class="string">"/usr/local/bin/npm"</span> <span class="string">"install"</span> <span class="string">"hexo-cli"</span> <span class="string">"-g"</span>npm ERR! node v6.10.1npm ERR! npm  v3.10.10npm ERR! path /usr/<span class="built_in">local</span>/lib/node_modules/hexo-cli/node_modules/bluebirdnpm ERR! code EACCESnpm ERR! errno -13npm ERR! syscall accessnpm ERR! Error: EACCES: permission denied, access <span class="string">'/usr/local/lib/node_modules/hexo-cli/node_modules/bluebird'</span>npm ERR!     at Error (native)npm ERR!  { Error: EACCES: permission denied, access <span class="string">'/usr/local/lib/node_modules/hexo-cli/node_modules/bluebird'</span>npm ERR!     at Error (native)npm ERR!   errno: -13,npm ERR!   code: <span class="string">'EACCES'</span>,npm ERR!   syscall: <span class="string">'access'</span>,npm ERR!   path: <span class="string">'/usr/local/lib/node_modules/hexo-cli/node_modules/bluebird'</span> }npm ERR! npm ERR! Please try running this <span class="built_in">command</span> again as root/Administrator.npm ERR! Please include the following file with any support request:npm ERR!     /Users/alex/Projects/blog/npm-debug.log</code></pre><p>分析错误由于权限问题，重新执行</p><pre><code class="bash">$ sudo npm install --unsafe-perm --verbose -g hexoPassword:....</code></pre><p>安装完成，执行启动hexo</p><pre><code class="bash">$ hexo server -dINFO  Start processingINFO  Hexo is running at http://localhost:4000/. Press Ctrl+C to stop.</code></pre><p>启动正常，浏览器访问：<a href="http://localhost:4000/admin" target="_blank" rel="noopener">http://localhost:4000/admin</a>  现在可以愉快的写博客了<br><img src="http://static.nsoft.vip/18-11-28/61834621.jpg" alt="image.png"></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt; 是一个简单地、轻量地、基于Node的一个静态博客框架。 &lt;a href=&quot;http://jaredforsyth.com/hexo-admin/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo Admin Plugin&lt;/a&gt; 是可以为Hexo提供后台管理的插件，今天安装了一下hexo-admin的修改版：&lt;a href=&quot;https://xbotao.github.io/hexo-admin-qiniu/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;hexo-admin-qiniu&lt;/a&gt;&lt;br&gt;进入之前安装的blog目录&lt;/p&gt;
    
    </summary>
    
      <category term="其他" scheme="https://crazyrico.com/categories/%E5%85%B6%E4%BB%96/"/>
    
      <category term="博客" scheme="https://crazyrico.com/categories/%E5%85%B6%E4%BB%96/%E5%8D%9A%E5%AE%A2/"/>
    
    
  </entry>
  
</feed>
